<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary SEO Meta Tags -->
    <title>Badr Ibrahim - Graphic Designer</title>
    <meta name="description" content="CV and contact information for Badr Ibrahim Mohammed (badr ibraheem mohameed), a professional graphic designer and software developer in Faiyum, Egypt. Email: badr.e.mohameed@gmail.com, Phone: +201069913150. | السيرة الذاتية ومعلومات التواصل للمصمم بدر ابراهيم محمد، مصمم جرافيك ومطور برامج في الفيوم.">
    <meta name="keywords" content="Badr Ibrahim, Badr Ibrahim Mohammed, Digital Experience Designer, Graphic Designer, Software Developer, Programmer, Portfolio, Faiyum, Egypt, bdr.e.mohameed, بدر ابراهيم, بدر ابراهيم محمد, مصمم جرافيك, مطور برامج, مبرمج, المصمم بدر, بدر مصمم الجرافيك, بدر مطور البرامج, بدر المبرمج, بدر ابراهيم المصمم, بدر ابراهيم مصمم جرافيك">
    <meta name="author" content="Badr Ibrahim Mohameed">
    <link rel="canonical" href="https://badre.site/" />
    <link rel="alternate" hreflang="en" href="https://badre.site/" />
    <link rel="alternate" hreflang="ar" href="https://badre.site/" />
    <link rel="alternate" hreflang="x-default" href="https://badre.site/" />

    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://badre.site/">
    <meta property="og:locale" content="en_US" />
    <meta property="og:locale:alternate" content="ar_EG" />
    <meta property="og:title" content="Badr Ibrahim - Software Developer & Graphic Designer Portfolio | Faiyum, Egypt">
    <meta property="og:description" content="Explore the portfolio of Badr Ibraheem, a creative software developer and graphic designer from Faiyum, Egypt with 3+ years of experience. Specializing in branding, 3D design, UI/UX, and modern web development.">
    <meta property="og:image" content="https://i.ibb.co/QFtzp7t3/1172-copy.jpg">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="https://badre.site/">
    <meta property="twitter:url" content="https://badre.site/">
    <meta name="twitter:title" content="Badr Ibraheem - Software Developer & Graphic Designer Portfolio | Faiyum, Egypt">
    <meta name="twitter:description" content="Explore the portfolio of Badr Ibraheem, a creative software developer and graphic designer from Faiyum, Egypt. Specializing in branding, 3D design, UI/UX, and modern web development.">
    <meta name="twitter:image" content="https://i.ibb.co/QFtzp7t3/1172-copy.jpg">

    <!-- Favicon -->
    <link rel="icon" href="https://i.ibb.co/mS3p8fV/favicon-B.png" type="image/png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- JSON-LD Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://badre.site/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://badre.site/?s={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Badr Ibraheem Mohameed",
      "alternateName": [
        "badr.e.mohameed",
        "badr ibrahim mohamed",
        "Badr Ibrahim Mohammed",
        "badr ibraheem mohameed",
        "Badr the graphic designer",
        "Badr the software developer",
        "Badr the programmer",
        "بدر ابراهيم محمد",
        "بدر ابراهيم",
        "المصمم بدر",
        "بدر مصمم الجرافيك",
        "بدر مطور البرامج",
        "بدر المبرمج",
        "بدر ابراهيم المصمم",
        "بدر ابراهيم مصمم الجرافيك"
      ],
      "url": "https://badre.site/",
      "image": "https://i.ibb.co/QFtzp7t3/1172-copy.jpg",
      "jobTitle": "Graphic Designer, Software Developer, and Digital Experience Designer",
      "description": "Creative graphic designer and software developer (programmer) from Faiyum, Egypt with over 3 years of experience. Specializing in creating unique visual identities and interactive websites.",
      "email": "mailto:badr.e.mohameed@gmail.com",
      "telephone": "+201069913150",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Faiyum",
        "addressCountry": "EG"
      },
      "sameAs": [
        "https://www.linkedin.com/in/bdremohameed",
        "https://github.com/bdremohameed",
        "https://x.com/bdr_e_mohameed",
        "https://www.facebook.com/bdr.e.mohmed",
        "https://www.instagram.com/bdr_e_mohamed"
      ]
    }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>

    <style>
        /* --- Smooth Theme Transition --- */
        *, *::before, *::after {
            transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out, border-color 0.4s ease-in-out;
        }

        :root {
            --background-dark: #0D0D0D;
            --text-primary: #EAEAEA;
            --text-secondary: #A0A000;
            --accent-gradient: linear-gradient(to right, #D4AF37, #FFD700);
            --accent-color: #D4AF37;
            --accent-color-rgb: 212, 175, 55;

            /* New Theme Variables (Dark Mode Default) */
            --bg-primary: #0D0D0D;
            --bg-overlay: rgba(13, 13, 13, 0.8);
            --text-primary-color: #EAEAEA;
            --text-secondary-color: #9CA3AF; /* Original gray for dark mode */
            --border-primary: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-hover-bg: rgba(255, 255, 255, 0.08);
            --glass-border-hover: rgba(212, 175, 55, 0.3);
            --text-on-accent: #FFFFFF;
            --shadow-sm: none;
            --shadow-md: 0 8px 20px rgba(0,0,0,0.2);
        }

        .light-mode {
            --bg-primary: #f3f4f6; /* gray-100 */
            --bg-overlay: rgba(243, 244, 246, 0.9);
            --text-primary-color: #111827; /* gray-900 */
            --text-secondary-color: #000000; /* Black */
            --border-primary: rgba(0, 0, 0, 0.08);
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-hover-bg: #ffffff;
            --glass-border-hover: rgba(0, 169, 157, 0.4); /* Azure Green */
            --text-on-accent: #FFFFFF;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --accent-gradient: linear-gradient(to right, #00A99D, #30D5C8); /* Azure Green Gradient */
            --accent-color: #00A99D; /* Azure Green */
            --accent-color-rgb: 0, 169, 157;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg-primary); 
            color: var(--text-primary-color);
            position: relative;
            overflow-x: hidden;
        }

        /* --- Maintenance Mode Styles --- */
        #maintenance-overlay {
            background-color: rgba(13, 13, 13, 0.5); /* Semi-transparent dark bg */
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }
        .light-mode #maintenance-overlay {
            background-color: rgba(243, 244, 246, 0.7); /* Semi-transparent light bg */
        }
        .maintenance-content {
            background: var(--glass-bg);
            border: 1px solid var(--border-primary);
            padding: 2.5rem;
            border-radius: 1.5rem;
            max-width: 500px;
            box-shadow: var(--shadow-md);
        }

        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            display: none; /* Hidden by default */
        }
        .light-mode #bg-canvas {
            display: block; /* Show in light mode */
        }

        /* Video Background Styles */
        .video-background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }
        .video-background-container video {
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            object-fit: cover;
        }
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-overlay);
            z-index: -1;
            transition: background-color 0.3s ease;
        }


        .glow {
            position: fixed;
            filter: blur(120px);
            z-index: -1;
            pointer-events: none;
        }
        #glow1 {
            top: -10%;
            left: -10%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1), transparent 70%);
            animation: pulse-glow 15s infinite alternate;
        }
        #glow2 {
            bottom: -20%;
            right: -20%;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(56, 189, 248, 0.08), transparent 70%);
            animation: pulse-glow-two 20s infinite alternate;
        }

        @keyframes pulse-glow {
            from { transform: scale(0.8); opacity: 0.7; }
            to { transform: scale(1.2); opacity: 1; }
        }
        @keyframes pulse-glow-two {
            from { transform: scale(1.2); opacity: 1; }
            to { transform: scale(0.8); opacity: 0.7; }
        }
        
        @keyframes pulse-shadow {
            0% { box-shadow: 0 0 25px rgba(var(--accent-color-rgb), 0.4); }
            50% { box-shadow: 0 0 40px rgba(var(--accent-color-rgb), 0.8); }
            100% { box-shadow: 0 0 25px rgba(var(--accent-color-rgb), 0.4); }
        }
        
        .gradient-text {
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        #mobile-menu {
            position: fixed;
            inset: 0;
            z-index: 90;
            background-color: var(--bg-overlay);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        #mobile-menu.active {
            opacity: 1;
            pointer-events: auto;
            visibility: visible;
        }
        #mobile-menu .mobile-menu-link {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        #mobile-menu.active .mobile-menu-link {
            opacity: 1;
            transform: translateY(0);
        }
        #mobile-menu.active .mobile-menu-link:nth-child(1) { transition-delay: 0.1s; }
        #mobile-menu.active .mobile-menu-link:nth-child(2) { transition-delay: 0.15s; }
        #mobile-menu.active .mobile-menu-link:nth-child(3) { transition-delay: 0.2s; }
        #mobile-menu.active .mobile-menu-link:nth-child(4) { transition-delay: 0.25s; }
        #mobile-menu.active .mobile-menu-link:nth-child(5) { transition-delay: 0.3s; }
        #mobile-menu.active .mobile-menu-link:nth-child(6) { transition-delay: 0.35s; }

        .project-card:hover .project-overlay {
            opacity: 1;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-sm);
            transition: background 0.4s ease, border 0.4s ease, box-shadow 0.4s ease;
        }
        .glass-card:hover {
             background: var(--glass-hover-bg);
             border-color: var(--glass-border-hover);
             box-shadow: var(--shadow-md);
        }

        /* Modernized Header Styling */
        .header-glass {
            background: rgba(13, 13, 13, 0.6); /* Slightly darker for better contrast */
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--border-primary);
        }
        .light-mode .header-glass {
             background: rgba(255, 255, 255, 0.8);
             border-color: #e5e7eb; /* gray-200 */
             box-shadow: var(--shadow-md);
        }

        .secondary-btn {
             color: var(--text-primary-color);
             font-weight: 600;
             border: 1px solid rgba(255,255,255,0.3);
             padding: 0.5rem 1rem;
             border-radius: 9999px;
             transition: all 0.3s ease;
        }
         .light-mode .secondary-btn {
            border-color: rgba(0,0,0,0.2);
         }
        .secondary-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
            border-color: var(--accent-color);
        }
        .light-mode .secondary-btn:hover {
            background: rgba(0,0,0,0.05);
            border-color: var(--accent-color);
        }
        
        .store-btn {
            color: var(--text-on-accent);
            font-weight: 700;
            border: 1px solid transparent;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            background-image: linear-gradient(to right, #8B5CF6, #A855F7);
        }
        .light-mode .store-btn {
             background-image: linear-gradient(to right, #7C3AED, #9333EA);
        }
        .store-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.5);
            filter: brightness(1.1);
        }

        .view-work-btn {
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary-color);
        }
        .view-work-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .light-mode .view-work-btn {
            background-color: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
        }
        .light-mode .view-work-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .social-btn {
             color: var(--text-primary-color);
             transition: all 0.3s ease;
             border-radius: 9999px;
             padding: 0.5rem;
        }
        .social-btn svg {
             width: 1.5rem; 
             height: 1.5rem;
        }
        .social-btn:hover {
            color: var(--accent-color);
            transform: scale(1.1) translateY(-2px);
            background-color: rgba(212, 175, 55, 0.1);
        }
        .light-mode .social-btn:hover {
            background-color: rgba(212, 175, 55, 0.1);
        }
       
        .timeline-item {
            position: relative;
            padding-left: 2.5rem;
            padding-bottom: 2rem;
            border-left: 2px solid rgba(255, 255, 255, 0.1);
        }
        .timeline-item:last-child {
            border-left: 2px solid transparent;
            padding-bottom: 0;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -9px;
            top: 0px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-color);
            border: 2px solid var(--background-dark);
        }
        
        .cta-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border-primary);
            border-radius: 9999px;
            color: var(--text-primary-color);
            transition: all 0.4s ease;
        }
        .light-mode .cta-btn {
            background: rgba(255, 255, 255, 0.6);
            color: var(--text-primary-color);
        }
        
        .cta-btn:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--accent-color);
            box-shadow: 0 0 25px rgba(var(--accent-color-rgb), 0.5);
        }
        
        .gsap-reveal {
            will-change: transform, opacity;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-primary);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: var(--text-primary-color);
            transition: all 0.3s ease;
        }
        .light-mode .form-input {
             background: rgba(0, 0, 0, 0.05);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(var(--accent-color-rgb), 0.3);
        }

        .submit-btn {
            background-image: var(--accent-gradient);
            color: var(--text-on-accent);
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
        }
        .submit-btn:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
            animation: pulse-shadow 2s infinite;
        }
        /* DELETED
        .submit-btn:hover svg {
            transform: translateX(4px);
        }
        */

        /* --- Modern Skill Card Styles --- */
        .skill-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 1rem;
        }
        .skill-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            background-color: var(--glass-hover-bg);
            border-color: var(--glass-border-hover);
        }
        .skill-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(var(--accent-color-rgb), 0.1);
            color: var(--accent-color);
            transition: all 0.3s ease;
        }
        .skill-card:hover .skill-icon {
            transform: scale(1.1) rotate(-5deg);
            box-shadow: 0 4px 10px rgba(var(--accent-color-rgb), 0.3);
        }
        .skill-icon svg {
            width: 28px;
            height: 28px;
        }
        .skill-details {
            flex-grow: 1;
        }
        .skill-name {
            font-weight: 700;
            color: var(--text-primary-color);
        }
        .skill-desc {
            font-size: 0.875rem;
            color: #9CA3AF; /* gray-400 */
        }
        .light-mode .skill-desc {
            color: #4B5563; /* gray-600 */
        }

        /* --- New Service Card Styles --- */
        .service-card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem; /* rounded-2xl */
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            z-index: 1;
        }
        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at var(--x) var(--y), rgba(212, 175, 55, 0.15), transparent 50%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
        }
        .service-card:hover::before {
            opacity: 1;
        }
        .service-card:hover {
            transform: translateY(-8px);
            border-color: var(--glass-border-hover);
            background: var(--glass-hover-bg);
            box-shadow: var(--shadow-md);
        }
        .light-mode .service-card {
            background: var(--glass-bg);
            border-color: #e5e7eb; /* gray-200 */
        }
        .light-mode .service-card:hover {
            background: #ffffff;
        }
        .light-mode .service-card::before {
            background: radial-gradient(circle at var(--x) var(--y), rgba(0, 169, 157, 0.08), transparent 60%);
        }
        .service-card .service-icon {
            margin-bottom: 1.5rem;
        }
        .service-card .service-number {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 3.5rem;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.05);
            line-height: 1;
            transition: color 0.4s ease;
            z-index: -1;
        }
        .service-card:hover .service-number {
            color: rgba(212, 175, 55, 0.15);
        }
        .light-mode .service-card .service-number {
            color: rgba(0, 0, 0, 0.05);
        }
        .light-mode .service-card:hover .service-number {
            color: rgba(0, 169, 157, 0.1);
        }


        #preloader {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-primary); /* Solid background for a cleaner start */
            transition: opacity 1s cubic-bezier(0.77, 0, 0.175, 1); /* Professional fade-out */
        }
        
        #preloader-logo {
            z-index: 101;
            transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1), opacity 0.8s ease-out, filter 0.8s ease-out;
            transform: scale(1);
        }
        
        #preloader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        #preloader.hidden #preloader-logo {
            transform: scale(0.5); /* Zooms out the logo */
            filter: blur(5px);   /* Blurs the logo as it disappears */
            opacity: 0;
        }
        
        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary-color);
            position: relative;
            overflow-x: hidden;
            background-image: url('https://i.ibb.co/QFtzp7t3/1172-copy.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-overlay);
            z-index: -1;
            transition: background-color 0.3s ease;
        }
        .content-hidden {
            opacity: 0;
        }

        #projects-slider-container {
            scroll-behavior: smooth;
            scrollbar-width: none; /* Firefox */
        }
        #projects-slider-container::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        .project-card {
            transform-origin: center center;
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            will-change: transform, opacity;
        }
        .slider-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 30;
            color: var(--text-primary-color);
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 1rem;
        }
        .slider-btn svg {
            width: 2rem; /* 32px */
            height: 2rem; /* 32px */
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }
        .light-mode .slider-btn svg {
             filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        .slider-btn:hover {
            color: var(--accent-color);
            transform: translateY(-50%) scale(1.15);
        }
        .slider-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
            transform: translateY(-50%) scale(1);
        }

        /* --- Testimonial Slider Styles --- */
        #testimonial-slider {
            position: relative;
            min-height: 220px; /* Adjust height to fit content */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .testimonial-card {
            position: absolute;
            width: 100%;
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
            pointer-events: none;
            text-align: center;
        }
        .testimonial-card.active {
            opacity: 1;
            pointer-events: auto;
            position: relative;
        }


        /* --- Modal Styles --- */
        .modal-hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #contact-modal, #login-modal, #project-modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #contact-modal > div:last-of-type,
        #login-modal > div:last-of-type,
        #project-modal > div:last-of-type,
        #settings-modal > div:last-of-type { /* The modal content */
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        #contact-modal:not(.modal-hidden) > div:last-of-type,
        #login-modal:not(.modal-hidden) > div:last-of-type,
        #project-modal:not(.modal-hidden) > div:last-of-type,
        #settings-modal:not(.modal-hidden) > div:last-of-type {
            transform: scale(1);
        }
        
        /* --- Project Add/Edit Modal Styles --- */
        .project-modal-content {
            background: linear-gradient(160deg, rgba(30, 30, 30, 0.7), rgba(15, 15, 15, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .light-mode .project-modal-content {
             background: var(--glass-bg);
        }
        .project-modal-content .form-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 0;
            padding: 0.75rem 0.25rem;
            color: var(--text-primary);
        }
        .light-mode .project-modal-content .form-input {
            color: var(--text-primary-color);
            border-bottom-color: rgba(0,0,0,0.2);
        }
        .project-modal-content .form-input:focus {
            outline: none;
            box-shadow: none;
            border-color: var(--accent-color);
        }
        .project-modal-content .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #9CA3AF; /* gray-400 */
            margin-bottom: 0.25rem;
            text-align: left;
        }
        .light-mode .project-modal-content .form-label {
            color: #374151; /* gray-700 */
        }
        .project-modal-content select.form-input {
            background-color: var(--background-dark);
        }

        /* --- Updated Login Modal Styles --- */
        .login-modal-content {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--border-primary);
            position: relative;
            overflow: hidden;
        }
        .login-modal-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(212, 175, 55, 0.3), transparent 30%);
            animation: rotate-glow 6s linear infinite;
        }
        @keyframes rotate-glow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #google-signin-btn {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .light-mode #google-signin-btn {
            background-color: rgba(0,0,0,0.05);
            border-color: rgba(0,0,0,0.1);
        }
        #google-signin-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(212, 175, 55, 0.5);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
        }
        .light-mode #google-signin-btn:hover {
            background-color: rgba(0,0,0,0.1);
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(0, 169, 157, 0.2);
        }

        /* --- Modern Theme Toggle --- */
        #theme-toggle-btn {
            position: relative;
            width: 24px;
            height: 24px;
        }
        #theme-toggle-btn svg {
            position: absolute;
            inset: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }
        .light-mode #theme-toggle-btn .sun-icon {
            transform: rotate(90deg) scale(0.5);
            opacity: 0;
        }
        .light-mode #theme-toggle-btn .moon-icon {
            transform: rotate(0deg) scale(1);
            opacity: 1;
        }
        #theme-toggle-btn .sun-icon {
            transform: rotate(0deg) scale(1);
            opacity: 1;
        }
        #theme-toggle-btn .moon-icon {
            transform: rotate(90deg) scale(0.5);
            opacity: 0;
        }

        /* --- Navigation Icon Styles --- */
        .nav-link {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
            color: var(--text-primary-color);
        }
        .nav-link:hover {
            color: var(--accent-color);
            background-color: rgba(212, 175, 55, 0.1);
        }
        .nav-link svg {
            transition: transform 0.3s ease;
        }
        .nav-link:hover svg {
            transform: scale(1.1) rotate(5deg);
        }
        .nav-link .tooltip {
            position: absolute;
            top: 120%;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            background-color: var(--bg-primary);
            color: var(--text-primary-color);
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            border: 1px solid var(--border-primary);
        }
        .nav-link:hover .tooltip {
            opacity: 1;
            transform: translateX(-50%) scale(1);
            top: 130%;
        }

        .nav-link.active {
            color: var(--accent-color);
            background-color: rgba(212, 175, 55, 0.1);
        }


        /* --- User Dropdown Menu --- */
        #user-dropdown {
            display: none;
            transform-origin: top right;
            animation: grow-down 0.2s ease-in-out;
        }
        #user-dropdown.show {
            display: block;
        }
        #user-menu-btn svg {
            transition: transform 0.3s ease;
        }
        #user-menu-btn.open svg {
            transform: rotate(180deg);
        }

        /* --- Language Switcher Styles --- */
        .language-switcher-btn {
            background: none;
            border: none;
            color: var(--text-primary-color);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        .language-switcher-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        #language-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            min-width: 160px;
            z-index: 60;
            transform-origin: top right;
            animation: grow-down 0.3s ease-in-out;
        }
        #language-dropdown.show {
            display: block;
        }
        #language-dropdown a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-primary-color);
            transition: background-color 0.3s ease;
            white-space: nowrap;
        }
        #language-dropdown a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .light-mode #language-dropdown a:hover {
             background-color: rgba(0, 0, 0, 0.05);
        }

        @keyframes grow-down {
            0% {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        /* --- RTL STYLES for Arabic --- */
        html[dir="rtl"] body {
            font-family: 'Cairo', sans-serif;
        }
        html[dir="rtl"] .header-glass .container,
        html[dir="rtl"] .header-glass .container .flex.items-center,
        html[dir="rtl"] nav {
            flex-direction: row-reverse;
        }
        html[dir="rtl"] .timeline-item {
            padding-left: 0;
            padding-right: 2.5rem;
            border-left: none;
            border-right: 2px solid rgba(255, 255, 255, 0.1);
            text-align: right;
        }
        html[dir="rtl"] .timeline-item::before {
            left: auto;
            right: -9px;
        }
        html[dir="rtl"] .md\:text-left {
            text-align: right !important;
        }
        html[dir="rtl"] #language-dropdown {
            right: auto;
            left: 0;
            transform-origin: top left;
        }
        html[dir="rtl"] .submit-btn svg {
            transform: translateX(-4px);
        }
        html[dir="rtl"] .submit-btn:hover svg {
            transform: translateX(-8px);
        }
        html[dir="rtl"] .list-disc {
            padding-right: 2.5rem;
        }
        
        /* --- Search Styles --- */
        #search-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 70;
            padding: 1rem;
            transform: translateY(-100%);
            transition: transform 0.3s ease-in-out;
        }
        #search-container.visible {
            transform: translateY(0);
        }

        /* --- Admin Controls --- */
        .admin-controls {
            display: none; /* Hidden by default */
            gap: 0.5rem;
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            z-index: 20;
        }
        body.logged-in .project-card .admin-controls {
            display: flex; /* Show when logged in */
        }
        #add-project-container {
            display: none; /* Hidden by default */
        }
        body.logged-in #add-project-container {
            display: block;
        }
        .admin-btn {
            background-color: rgba(13, 13, 13, 0.7);
            backdrop-filter: blur(10px);
            color: white;
            border-radius: 9999px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 1px solid var(--border-primary);
        }
        .admin-btn:hover {
             background-color: rgba(139, 92, 246, 0.8);
        }
        .admin-btn.delete:hover {
            background-color: rgba(239, 68, 68, 0.8);
        }

        /* --- Responsive Iframe for Video --- */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* --- Project Filtering Styles --- */
        .filter-btn {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-primary);
            color: var(--text-primary-color);
            transition: all 0.3s ease;
        }
        .light-mode .filter-btn {
            background-color: rgba(0,0,0,0.05);
        }
        .filter-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .light-mode .filter-btn:hover {
            background-color: rgba(0,0,0,0.1);
            border-color: rgba(0,0,0,0.2);
        }
        .filter-btn.active {
            background-image: var(--accent-gradient);
            color: var(--text-on-accent);
            font-weight: 700;
            border-color: transparent;
        }
        
        /* --- Project Status Badge Styles --- */
        .status-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            z-index: 10;
        }
        .status-Completed {
            background-color: #10B981; /* Green */
            color: #F0FDF4;
        }
        .status-InProgress {
            background-color: #3B82F6; /* Blue */
            color: #EFF6FF;
        }
        .status-Idea {
            background-color: #F59E0B; /* Amber */
            color: #FFFBEB;
        }
        
        /* --- Project Card Overlay Styles --- */
        .project-card-content {
            transform: translateY(calc(100% - 8.5rem)); /* Adjust this value to show more/less of the title */
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .group:hover .project-card-content {
            transform: translateY(0);
        }
        .project-card-details {
            opacity: 0;
            transition: opacity 0.4s ease-in-out 0.15s;
        }
        .group:hover .project-card-details {
            opacity: 1;
        }
        .project-gradient-overlay {
            background: linear-gradient(to top, rgba(13, 13, 13, 0.95) 10%, rgba(13, 13, 13, 0.7), transparent 60%);
        }
        .light-mode .project-gradient-overlay {
            background: linear-gradient(to top, #f3f4f6 20%, rgba(243, 244, 246, 0.8) 50%, transparent 80%);
        }
        .light-mode .project-card-content {
            color: var(--text-primary-color);
        }
        .light-mode .project-card-content .text-gray-300 {
            color: var(--text-secondary-color);
        }

        /* --- CV View Styles --- */
        #cv-view {
            position: fixed;
            inset: 0;
            background-color: rgba(13, 13, 13, 0.5);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        .light-mode #cv-view {
            background-color: rgba(243, 244, 246, 0.7);
        }
        #cv-view.visible {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        #cv-view .cv-container {
            background: var(--glass-bg);
            border: 1px solid var(--border-primary);
            border-radius: 1.5rem;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.4s ease;
        }
        #cv-view.visible .cv-container {
            transform: scale(1);
        }
        .cv-content-wrapper {
            overflow-y: auto;
            padding: 1rem;
        }
        @media (min-width: 768px) {
             .cv-content-wrapper {
                padding: 1.5rem 2.5rem 2.5rem 2.5rem;
            }
        }
        .cv-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2.5rem;
        }
        @media (min-width: 768px) {
            .cv-grid {
                grid-template-columns: 300px 1fr;
            }
        }
        .cv-sidebar {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: 1rem;
            padding: 2rem;
        }
        .light-mode .cv-sidebar {
             background-color: rgba(0, 0, 0, 0.03);
        }

        @media print {
            body *, #cv-view {
                visibility: hidden;
            }
            .cv-container, .cv-container * {
                visibility: visible;
            }
            #cv-view {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: auto;
                transform: translateY(0) !important;
                overflow: visible;
                background: none !important;
                backdrop-filter: none !important;
                padding: 0;
            }
            .cv-container {
                max-height: none;
                overflow: visible;
                display: block;
                border-radius: 0;
            }
            .cv-content-wrapper {
                overflow: visible;
                padding: 0;
            }
            .cv-header {
                display: none;
            }
            .cv-grid {
                grid-template-columns: 300px 1fr !important;
            }
            .glass-card, .cv-sidebar {
                 background: transparent !important;
                 box-shadow: none !important;
                 border: 1px solid #e5e7eb !important;
            }
            body {
                background: #fff !important;
                color: #000 !important;
            }
            h1, h2, h3, h4, p, span, a, li {
                color: #000 !important;
            }
            .gradient-text {
                background: none !important;
                -webkit-text-fill-color: #00A99D !important;
            }
        }


        /* --- Article Card Styles --- */
        .article-card {
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .article-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        .article-card-content {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        #articles-slider-container {
            scroll-behavior: smooth;
            scrollbar-width: none;
        }
        #articles-slider-container::-webkit-scrollbar {
            display: none;
        }
        .article-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 12rem; /* 192px */
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
        }
        .article-placeholder svg {
            width: 3rem;
            height: 3rem;
            color: rgba(212, 175, 55, 0.4);
        }
        .light-mode .article-placeholder svg {
            color: rgba(0, 169, 157, 0.4);
        }

        #article-detail-admin-controls {
            display: none;
        }
        body.logged-in #article-detail-admin-controls {
            display: flex;
        }


        /* --- Project View Gallery Styles --- */
        .gallery-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .gallery-main-image img {
            width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 0.75rem;
            background-color: rgba(0,0,0,0.2);
        }
        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 0.5rem;
            pointer-events: none;
        }
        .gallery-nav button {
            pointer-events: all;
            background-color: rgba(13, 13, 13, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border-primary);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .gallery-nav button:hover {
            background-color: var(--accent-color);
            transform: scale(1.1);
        }
        .gallery-thumbs {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }
        .gallery-thumb {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 0.375rem;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            opacity: 0.6;
            flex-shrink: 0;
        }
        .gallery-thumb:hover {
            opacity: 1;
            border-color: var(--accent-color);
        }
        .gallery-thumb.active {
            opacity: 1;
            border-color: var(--accent-color);
        }

        /* --- Image Lightbox --- */
        #image-lightbox.modal-hidden {
            pointer-events: none;
            opacity: 0;
        }
        #image-lightbox {
            transition: opacity 0.3s ease;
        }
        #image-lightbox img {
            transition: transform 0.3s ease;
            transform: scale(0.95);
        }
        #image-lightbox:not(.modal-hidden) img {
            transform: scale(1);
        }

        /* --- Project Stats & Like Button --- */
        .project-stats {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* 12px */
            color: #9CA3AF; /* text-gray-400 */
        }
        .light-mode .project-stats {
            color: #4B5563; /* gray-600 */
        }
        .project-stats svg {
            width: 1rem; /* 16px */
            height: 1rem; /* 16px */
        }

        .like-btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary-color);
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .light-mode .like-btn {
            background-color: rgba(0,0,0,0.05);
            border-color: rgba(0,0,0,0.1);
        }
        .like-btn svg {
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .like-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .like-btn:hover svg {
            transform: scale(1.2);
        }
        .light-mode .like-btn:hover {
             background-color: rgba(0,0,0,0.1);
             color: var(--text-primary-color);
        }
        .like-btn.liked {
            background-color: #ef4444; /* red-500 */
            color: white;
            border-color: transparent;
        }
        .like-btn.liked svg {
            fill: white;
        }

        /* --- Floating Action Button Scroll Logic --- */
        #contact-fab-btn {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }
        #contact-fab-btn.fab-visible {
            transform: scale(1);
            opacity: 1;
            pointer-events: auto;
        }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        .light-mode ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #FFD700; /* Lighter accent */
        }
        .light-mode #hero h2, .light-mode #hero p, .light-mode .prose {
             color: var(--text-secondary-color);
        }
        .light-mode .text-gray-300 { color: var(--text-secondary-color); }
        .light-mode .text-gray-400 { color: #374151; } /* gray-700 */
        .light-mode .text-gray-500 { color: #4B5563; } /* gray-600 */
        .light-mode .text-white { color: var(--text-primary-color); }
        .light-mode .prose-invert {
            --tw-prose-body: var(--text-secondary-color);
            --tw-prose-headings: var(--text-primary-color);
            --tw-prose-lead: #4b5563;
            --tw-prose-links: #111827;
            --tw-prose-bold: #111827;
            --tw-prose-counters: #6b7280;
            --tw-prose-bullets: #9ca3af;
            --tw-prose-hr: rgba(0,0,0,0.1);
            --tw-prose-quotes: #111827;
            --tw-prose-quote-borders: #e5e7eb;
            --tw-prose-captions: #6b7280;
            --tw-prose-code: #111827;
            --tw-prose-pre-code: #e5e7eb;
            --tw-prose-pre-bg: #1f2937;
            --tw-prose-th-borders: #d1d5db;
            --tw-prose-td-borders: #e5e7eb;
        }
        .light-mode .ring-white\/10 {
            --tw-ring-color: rgba(0,0,0,0.05);
        }
        .light-mode .bg-white\/10 {
            background-color: rgba(0,0,0,0.05);
        }
        .light-mode .text-violet-300, span.text-violet-300 {
            color: #00A99D; /* Azure Green */
        }
        .light-mode #about .bg-white\/10 {
            background-color: #e0f2f1; /* teal-50 */
            color: #00796b; /* teal-700 */
            font-weight: 600;
        }
        .light-mode .contact-info-panel {
             border-right: 1px solid var(--border-primary);
        }
        #contact-modal .glass-card {
            background: rgba(13, 13, 13, 0.4); /* Very transparent dark bg */
            backdrop-filter: blur(32px); /* Increased blur */
            -webkit-backdrop-filter: blur(32px);
        }
        .light-mode #contact-modal .glass-card {
            background: rgba(255, 255, 255, 0.6); /* Very transparent light bg */
        }
        .light-mode #testimonials .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
        }

        /* --- Interactive Timeline Styles --- */
        #timeline-track {
            padding: 1rem 0;
            position: relative;
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }
        #timeline-track::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border-primary);
            transform: translateY(-50%);
        }
        .timeline-event {
            position: relative;
            flex-shrink: 0;
            cursor: pointer;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .timeline-event:hover .timeline-event-dot {
            transform: scale(1.1);
        }
        .timeline-event-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--bg-primary);
            border: 3px solid var(--border-primary);
            margin: 0 auto 1rem auto;
            transition: all 0.3s ease;
        }
        .timeline-event.active .timeline-event-dot {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(var(--accent-color-rgb), 0.5);
        }
        .timeline-event-year {
            font-weight: 700;
            font-size: 1.125rem;
            transition: color 0.3s ease;
        }
        .timeline-event.active .timeline-event-year {
            color: var(--text-primary-color);
        }
        .timeline-details-content {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(0px);
            opacity: 1;
        }
        .timeline-details-content.exiting {
            opacity: 0;
            transform: translateY(15px);
        }

        /* --- CTA Bar --- */
        #cta {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 40;
        }
        #cta .glass-card {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom: none;
            max-width: 900px; 
            margin-left: auto;
            margin-right: auto;
        }
        .light-mode #cta .glass-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
        }
        /* DELETED - Replaced with Tailwind classes
        footer {
            padding-bottom: 150px; 
        }
        */

        /* --- Modern CV Styles --- */
        .timeline-item-cv {
            position: relative;
        }
        .timeline-item-cv::before {
            content: '';
            position: absolute;
            left: -39px; /* Based on ml-3 pl-8 */
            top: 5px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--bg-primary);
            border: 3px solid var(--accent-color);
            transition: all 0.3s ease;
        }
        .light-mode .timeline-item-cv::before {
             background: var(--bg-primary);
        }

        html[dir="rtl"] .timeline-item-cv {
            border-left: none;
            border-right: 2px solid var(--border-primary);
            margin-left: 0;
            margin-right: 0.75rem; /* ml-3 */
            padding-left: 0;
            padding-right: 2rem; /* pl-8 */
        }
         html[dir="rtl"] .timeline-item-cv::before {
            left: auto;
            right: -40px;
        }


        /* --- Admin Controls on Product Cards --- */
        body.logged-in .store-product-card .admin-controls {
            display: flex;
        }
        #add-product-container {
            display: none;
        }
        body.logged-in #add-product-container {
            display: block;
        }

        /* --- NEW: Modern Store Product Card Styles --- */
        .store-product-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border-radius: 1.5rem; /* rounded-3xl */
            border: 1px solid var(--border-primary);
            padding: 1rem;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }
        .store-product-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 1.5rem;
            border: 2px solid transparent;
            background: linear-gradient(45deg, var(--accent-color), #8B5CF6) border-box;
            -webkit-mask:
                linear-gradient(#fff 0 0) padding-box,
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: destination-out;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none; /* Add this line to fix click issue */
        }
        .store-product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 30px rgba(0,0,0,0.2);
        }
        .store-product-card:hover:before {
            opacity: 1;
        }
        .store-product-card .product-card-image {
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 1rem; /* rounded-2xl */
            margin-bottom: 1rem;
        }
        .store-product-card .product-card-image img {
            transition: transform 0.5s ease;
        }
        .store-product-card:hover .product-card-image img {
            transform: scale(1.08);
        }
        .store-product-card .product-category {
            font-size: 0.875rem; /* text-sm */
            color: var(--text-secondary-color);
            font-weight: 500;
        }
        .store-product-card .product-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700;
            color: var(--text-primary-color);
            margin: 0.25rem 0 1rem 0;
            min-height: 3.5rem; /* for 2 lines */
        }
        .store-product-card .details-price-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border-primary);
        }
        .store-product-card .product-price-display {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 800;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .store-product-card .details-btn {
            background: transparent;
            color: var(--text-primary-color);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-primary);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .light-mode .store-product-card .details-btn {
            border-color: rgba(0,0,0,0.2);
        }
        .store-product-card .details-btn:hover {
            background-color: var(--accent-color);
            color: var(--text-on-accent);
            transform: scale(1.05);
            border-color: var(--accent-color);
        }
        .store-product-card .details-btn svg {
             width: 1rem; /* 16px */
             height: 1rem; /* 16px */
             transition: transform 0.3s ease;
        }
        .store-product-card .details-btn:hover svg {
            transform: translateX(3px);
        }

        /* --- Product Detail Slider (Coverflow Style) --- */
        #product-media-slider-container {
            perspective: 1200px;
            position: relative;
            width: 100%;
            height: 100%;
        }
        .product-media-slide {
            position: absolute;
            width: 60%;
            height: 100%;
            top: 0;
            left: 20%;
            border-radius: 1rem;
            overflow: hidden;
            transition: transform 0.5s ease, opacity 0.5s ease, z-index 0.5s ease;
            /* -webkit-box-reflect: below 1px linear-gradient(transparent, transparent, #0004); */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0,0,0,0.2);
        }
        .product-media-slide img,
        .product-media-slide iframe {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .product-media-slide.active {
            transform: translateX(0) scale(1.1);
            opacity: 1;
            z-index: 10;
        }
        .product-media-slide.active[data-media-type="image"] {
            cursor: pointer;
        }
        .product-media-slide.prev {
            transform: translateX(-55%) scale(0.85);
            opacity: 0.4;
            z-index: 5;
        }
        .product-media-slide.next {
            transform: translateX(55%) scale(0.85);
            opacity: 0.4;
            z-index: 5;
        }
        .product-media-slide.hidden-prev {
             transform: translateX(-80%) scale(0.7);
             opacity: 0;
             z-index: 1;
        }
        .product-media-slide.hidden-next {
             transform: translateX(80%) scale(0.7);
             opacity: 0;
             z-index: 1;
        }


        /* --- Certificate Section Styles --- */
        #certificates-slider-container {
            perspective: 1000px;
            position: relative;
            width: 100%;
            height: 100%;
        }
        .certificate-card-slider {
            position: absolute;
            width: 60%;
            height: 100%;
            top: 0;
            left: 20%;
            border-radius: 1rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.5s ease, opacity 0.5s ease, z-index 0.5s ease;
            -webkit-box-reflect: below 1px linear-gradient(transparent, transparent, #0004);
        }
        .certificate-card-slider img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .certificate-card-slider .overlay {
             position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 70%);
            display: flex;
            align-items: flex-end;
            padding: 1rem;
            opacity: 1; /* Always visible for stacked view */
        }
         .certificate-card-slider .overlay h5 {
            color: white;
            font-weight: 700;
        }
        .certificate-card-slider.active {
            transform: translateX(0) scale(1.15);
            opacity: 1;
            z-index: 10;
            cursor: default;
        }
        .certificate-card-slider.prev {
            transform: translateX(-50%) scale(0.9);
            opacity: 0.5;
            z-index: 5;
        }
        .certificate-card-slider.next {
            transform: translateX(50%) scale(0.9);
            opacity: 0.5;
            z-index: 5;
        }
        .certificate-card-slider.hidden-prev {
             transform: translateX(-70%) scale(0.7);
             opacity: 0;
             z-index: 1;
        }
        .certificate-card-slider.hidden-next {
             transform: translateX(70%) scale(0.7);
             opacity: 0;
             z-index: 1;
        }
        body.logged-in .certificate-card-slider .admin-controls {
            display: flex;
        }
        body.logged-in #add-certificate-container {
            display: block;
        }

        /* --- Certificate Gallery Modal Styles --- */
        #certificate-gallery-modal .gallery-nav {
            background-color: rgba(13, 13, 13, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid var(--border-primary);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        #certificate-gallery-modal .gallery-nav:hover {
            background-color: var(--accent-color);
            transform: scale(1.1);
        }
        #certificate-gallery-modal .gallery-nav.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }
        #certificate-gallery-modal img {
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform: scale(0.95);
            opacity: 0;
        }
        #certificate-gallery-modal:not(.modal-hidden) img {
            transform: scale(1);
            opacity: 1;
        }


        /* --- Chatbot Styles --- */
        #chat-fab-btn {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }
        #chat-fab-btn.fab-visible {
            transform: scale(1);
            opacity: 1;
            pointer-events: auto;
        }
        #chat-widget {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 90;
            width: clamp(300px, 90vw, 400px);
            max-height: 70vh;
            border-radius: 1.5rem; /* rounded-3xl */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: translateY(20px) scale(0.95);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
        }
        #chat-widget.visible {
            transform: translateY(0) scale(1);
            opacity: 1;
            visibility: visible;
        }
        .chat-header {
            padding: 1rem 1.5rem;
            flex-shrink: 0;
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            word-wrap: break-word;
        }
        .chat-message.user {
            background-image: var(--accent-gradient);
            color: var(--text-on-accent);
            border-bottom-right-radius: 0.25rem;
            align-self: flex-end;
        }
        .chat-message.bot {
            background-color: rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 0.25rem;
            align-self: flex-start;
        }
        .light-mode .chat-message.bot {
            background-color: #e5e7eb; /* gray-200 */
        }
        #chat-form {
            padding: 1.5rem;
            flex-shrink: 0;
        }
        #chat-input {
            padding-right: 3rem; /* Space for the send button */
        }
        #chat-send-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary-color);
            transition: all 0.2s ease;
        }
        #chat-send-btn:hover {
            background-color: rgba(212, 175, 55, 0.1);
            color: var(--accent-color);
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: currentColor;
            margin: 0 2px;
            animation: bounce 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* --- Project Recommendations Styles --- */
        #project-recommendations-container h4 {
            border-bottom: 2px solid var(--border-primary);
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .recommendation-card {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .recommendation-card:hover {
            transform: translateY(-5px);
            border-color: var(--glass-border-hover);
            background: var(--glass-hover-bg);
        }
        .recommendation-card img {
            aspect-ratio: 16 / 10;
            object-fit: cover;
        }

        /* --- Reading Progress Bar --- */
        #reading-progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background-image: var(--accent-gradient);
            width: 0%;
            z-index: 9998; /* Below maintenance overlay but above everything else */
            transition: width 0.1s linear;
            box-shadow: 0 2px 10px rgba(var(--accent-color-rgb), 0.5);
            display: none; /* Hidden by default */
        }

    </style>
</head>

<body>
    <div id="reading-progress-bar"></div>
    <div id="maintenance-overlay" class="hidden fixed inset-0 z-[9999] flex items-center justify-center p-4">
        <div class="maintenance-content text-center">
            <svg class="mx-auto h-16 w-16 text-[var(--accent-color)] mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.472-2.472a3.375 3.375 0 00-4.773-4.773L6.23 5.73a3.375 3.375 0 00-4.773 4.773l2.472 2.472M11.42 15.17l-2.472 2.472a3.375 3.375 0 01-4.773-4.773L5.73 6.23a3.375 3.375 0 014.773-4.773l2.472 2.472" />
            </svg>
            <h1 class="text-4xl font-bold mb-2">Under Maintenance</h1>
            <p class="text-gray-400">Our site is currently undergoing scheduled maintenance. We'll be back shortly. Thank you for your patience.</p>
        </div>
    </div>
    <canvas id="bg-canvas"></canvas>
    <!-- --- Preloader --- -->
    <div id="preloader">
        <div id="preloader-logo" class="text-7xl font-bold gradient-text">B</div>
    </div>

    <!-- Video Background -->
    <div class="video-background-container" style="background-image: url('https://i.ibb.co/QFtzp7t3/1172-copy.jpg'); background-size: cover; background-position: center center;">
        <video id="background-video" autoplay loop muted playsinline 
               data-dark-src="https://motionbgs.com/media/2384/levi-ackerman-aot.960x540.mp4"
               data-light-src="https://livewallpapers4free.com/wp-content/uploads/2024/06/kpve7bybuay5bpqf.mp4?id=0"
               poster="https://i.ibb.co/QFtzp7t3/1172-copy.jpg">
            <source type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <div id="glow1" class="glow"></div>
    <div id="glow2" class="glow"></div>

    <header class="header-glass fixed top-4 left-1/2 -translate-x-1/2 w-[90%] sm:w-[95%] max-w-5xl z-50 rounded-full content-hidden">
        <div class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
             <div id="auth-container" class="text-2xl font-bold">
                <a href="#" id="auth-link" class="gradient-text">Badr.</a>
            </div>
            <div class="flex items-center gap-2 md:gap-4">
                <nav class="hidden md:flex space-x-2 items-center">
                    <a href="#hero" class="nav-link" data-nav-link="hero" title="Home">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                        <span class="tooltip" data-translate-key="navHome">Home</span>
                    </a>
                    <a href="#projects" class="nav-link" data-nav-link="projects" title="Projects">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
                        <span class="tooltip" data-translate-key="navProjects">Projects</span>
                    </a>
                    <a href="#blog" class="nav-link" data-nav-link="blog" title="Blog">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                        <span class="tooltip" data-translate-key="navBlog">Blog</span>
                    </a>
                     <a href="#certificates" class="nav-link" data-nav-link="certificates" title="Certificates" data-translate-title="navCertificates">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>
                        <span class="tooltip" data-translate-key="navCertificates">Certificates</span>
                    </a>
                    <a href="#store" class="nav-link" data-nav-link="store" title="Store" data-translate-title="navStore">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        <span class="tooltip" data-translate-key="navStore">Store</span>
                    </a>
                     <a href="#" id="cv-nav-btn" class="nav-link" title="View CV">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                        <span class="tooltip">CV</span>
                    </a>
                </nav>

                <!-- Search Button -->
                <button id="search-btn" class="nav-link" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <span class="tooltip">Search</span>
                </button>
                
                <!-- Theme Toggle -->
                <button id="theme-toggle-btn" class="language-switcher-btn" title="Toggle theme" data-translate-title="tooltipToggleTheme">
                    <svg class="sun-icon w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                    <svg class="moon-icon w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                </button>

                <!-- Language Switcher -->
                <div class="relative" id="language-switcher">
                    <button id="language-switcher-btn" class="language-switcher-btn" title="Change language" data-translate-title="tooltipChangeLang">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                    </button>
                    <div id="language-dropdown" class="glass-card rounded-xl overflow-hidden shadow-lg">
                        <a href="#" class="language-option" data-lang="en"><span>🇺🇸</span> English</a>
                        <a href="#" class="language-option" data-lang="ar"><span>🇪🇬</span> العربية</a>
                    </div>
                </div>

                <button id="mobile-menu-button" class="md:hidden p-2 rounded-md focus:outline-none text-gray-300">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="md:hidden">
        <button id="mobile-menu-close-button" class="absolute top-6 right-6 text-gray-300 p-2 z-10">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <div class="flex flex-col items-center space-y-6 text-center">
             <a href="#hero" class="mobile-menu-link" data-translate-key="navHome">Home</a>
             <a href="#projects" class="mobile-menu-link" data-translate-key="navProjects">Projects</a>
             <a href="#blog" class="mobile-menu-link" data-translate-key="navBlog">Blog</a>
             <a href="#certificates" class="mobile-menu-link" data-translate-key="navCertificates">Certificates</a>
             <a href="#store" class="mobile-menu-link" data-translate-key="navStore">Store</a>
             <a href="#" class="mobile-menu-link contact-modal-trigger" data-translate-key="heroCtaContact">Contact Me</a>
        </div>
    </div>

    <!-- Search Overlay -->
    <div id="search-overlay" class="fixed inset-0 z-[60] bg-black/70 backdrop-blur-sm hidden"></div>
    <div id="search-container" class="fixed top-0 left-0 w-full z-[70] p-4 transform -translate-y-full transition-transform duration-300 ease-in-out">
        <div class="max-w-2xl mx-auto">
            <form id="search-form" class="relative">
                <input type="search" id="search-input" placeholder="Search projects, articles, skills..." class="form-input w-full !text-lg !py-3 !pl-5 !pr-12" autocomplete="off">
                <button type="submit" class="absolute top-1/2 right-4 -translate-y-1/2 text-gray-400 hover:text-white">
                     <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </button>
            </form>
        </div>
    </div>

    <main class="container mx-auto px-6 content-hidden">
        <section id="hero" class="min-h-screen flex items-center justify-center relative pt-24 md:pt-0">
            <div class="relative z-10 w-full flex flex-col-reverse md:grid md:grid-cols-2 items-center gap-8 md:gap-12">
                
                <!-- Left Side: Text Content -->
                <div class="text-center md:text-left">
                    <span class="block text-xl font-semibold text-violet-400 mb-2" id="hero-greeting" data-translate-key="heroGreeting">Hello, I'm</span>
                    <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black text-white leading-tight">
                        <span class="gradient-text" data-translate-key="heroLine1">Badr</span><br><span data-translate-key="heroLine2">Ibraheem Mohameed</span>
                    </h1>
                    <h2 class="mt-4 text-lg sm:text-xl md:text-2xl font-medium text-gray-300 min-h-[50px]">
                        <span id="typing-effect"></span>
                    </h2>
                    <p class="mt-6 text-gray-400 max-w-lg mx-auto md:mx-0" data-translate-key="heroBio">
                        I combine design and code to build engaging digital experiences. Specializing in creating unique visual identities and interactive websites that captivate users.
                    </p>
                    
                    <!-- Social Icons -->
                    <div class="mt-8 flex justify-center md:justify-start items-center gap-x-1 sm:gap-x-2" id="hero-socials">
                        <a href="https://www.linkedin.com/in/bdremohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="LinkedIn" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
                        <a href="https://github.com/bdremohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="GitHub" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
                        <a href="https://x.com/bdr_e_mohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="X" title="X (formerly Twitter)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></a>
                    </div>

                    <!-- CTA Buttons -->
                    <div class="mt-8 flex flex-col sm:flex-row items-center justify-center md:justify-start gap-4" id="hero-ctas">
                        <a href="#projects" class="view-work-btn group w-full sm:w-auto justify-center">
                            <span data-translate-key="heroCtaViewWork">View My Work</span>
                            <svg class="ml-2 w-5 h-5 transition-transform duration-300 group-hover:rotate-[-45deg]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                <polyline points="15 3 21 3 21 9"/>
                                <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                        </a>
                        <a href="#store" class="store-btn group w-full sm:w-auto justify-center" id="hero-store-btn">
                             <svg class="mr-2 w-5 h-5 transition-transform duration-300 group-hover:scale-110" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                            <span data-translate-key="navStore">Store</span>
                        </a>
                    </div>
                </div>

                <!-- Right Side: Image -->
                 <div id="hero-image-container" class="relative flex justify-center items-center">
                    <div class="relative w-full max-w-md md:max-w-lg lg:max-w-xl flex justify-center items-center">
                         <div class="hero-image-glow absolute w-[80%] h-[80%] rounded-full opacity-70"></div>
                         <div class="relative z-10 w-60 h-60 sm:w-80 sm:h-80 md:w-[420px] md:h-[420px] rounded-full overflow-hidden shadow-2xl ring-4 ring-white/10">
                            <img id="profile-picture-img" src="https://i.ibb.co/QFtzp7t3/1172-copy.jpg"
                                 data-dark-src="https://i.ibb.co/QFtzp7t3/1172-copy.jpg"
                                 data-light-src="https://i.ibb.co/N6dQBv1/IMG-20240621-WA0010.jpg"
                                 alt="صورة شخصية احترافية للمصمم بدر إبراهيم، مصمم جرافيك ومطور برامج من الفيوم، مصر." class="w-full h-full object-cover opacity-95 transition-opacity duration-300" loading="lazy" width="420" height="420">
                         </div>
                    </div>
                </div>

            </div>
        </section>

        <section id="skills" class="py-20 sm:py-24">
            <h3 class="text-3xl sm:text-4xl font-bold text-center mb-12 gsap-reveal gradient-text" data-translate-key="skillsTitle">Core Competencies</h3>
            <div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
                
                <!-- Design & Creative Column -->
                <div class="space-y-6">
                    <h4 class="text-2xl font-bold text-center md:text-left gradient-text">Design & Creative</h4>
                    
                    <div class="skill-card glass-card gsap-reveal">
                        <div class="skill-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.998 15.998 0 011.622-3.385m5.043.025a15.998 15.998 0 001.622-3.385m3.388 1.62a15.998 15.998 0 00-1.622-3.385m-5.043.025a15.998 15.998 0 01-3.388-1.621m7.849 14.742a15.998 15.998 0 00-3.388-1.622m-5.043-.025a15.998 15.998 0 01-1.622-3.385m5.043.025a15.998 15.998 0 00-1.622-3.385m-3.388 1.62a15.998 15.998 0 001.622-3.385m-7.849-1.47a15.998 15.998 0 013.388-1.622m5.043.025a15.998 15.998 0 003.388 1.622m7.849 14.742a15.998 15.998 0 001.622-3.385m-5.043-.025a15.998 15.998 0 011.622-3.385m3.388 1.62a15.998 15.998 0 00-1.622-3.385m-5.043.025a15.998 15.998 0 01-3.388-1.622m7.849 14.742a15.998 15.998 0 00-3.388-1.622m-5.043-.025a15.998 15.998 0 01-1.622-3.385m-3.388 1.62a15.998 15.998 0 001.622-3.385"/></svg>
                        </div>
                        <div class="skill-details">
                            <h5 class="skill-name">Branding & Identity</h5>
                            <p class="skill-desc" data-translate-key="skillBrandDesc">Logos, Style Guides, Visual Systems</p>
                        </div>
                    </div>
                     <div class="skill-card glass-card gsap-reveal">
                        <div class="skill-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" /></svg>
                        </div>
                        <div class="skill-details">
                            <h5 class="skill-name">UI/UX Design</h5>
                            <p class="skill-desc" data-translate-key="skillUiUxDesc">Websites, Mobile Apps, Prototypes</p>
                        </div>
                    </div>
                     <div class="skill-card glass-card gsap-reveal">
                        <div class="skill-icon">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                        </div>
                        <div class="skill-details">
                            <h5 class="skill-name">3D Modeling</h5>
                            <p class="skill-desc" data-translate-key="skill3dDesc">Blender, 3D Rendering</p>
                        </div>
                    </div>
                </div>

                <!-- Software & Technical Column -->
                <div class="space-y-6">
                    <h4 class="text-2xl font-bold text-center md:text-left gradient-text">Software & Technical</h4>
                     <div class="skill-card glass-card gsap-reveal">
                        <div class="skill-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z" /></svg>
                        </div>
                        <div class="skill-details">
                            <h5 class="skill-name">HTML & CSS</h5>
                            <p class="skill-desc" data-translate-key="skillHtmlCssDesc">Responsive Web Layouts</p>
                        </div>
                    </div>
                     <div class="skill-card glass-card gsap-reveal">
                        <div class="skill-icon">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
                        </div>
                        <div class="skill-details">
                            <h5 class="skill-name">JavaScript</h5>
                             <p class="skill-desc" data-translate-key="skillJsDesc">Interactive Web Elements</p>
                        </div>
                    </div>
                    <div class="skill-card glass-card gsap-reveal">
                        <div class="skill-icon">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg>
                        </div>
                        <div class="skill-details">
                            <h5 class="skill-name">Microsoft Office</h5>
                            <p class="skill-desc" data-translate-key="skillOfficeDesc">Word, PowerPoint, Excel</p>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <section id="experience" class="py-20 sm:py-24 overflow-hidden">
            <h3 class="text-3xl sm:text-4xl font-bold text-center mb-12 gsap-reveal gradient-text" data-translate-key="experienceTitle">Experience & Training</h3>
            <div id="interactive-timeline" class="max-w-5xl mx-auto gsap-reveal">
                <!-- Timeline details will be displayed here -->
                <div id="timeline-details-container" class="glass-card p-6 md:p-8 rounded-2xl mb-8 min-h-[180px] sm:min-h-[150px]">
                    <!-- JS will populate this -->
                </div>
                <!-- The timeline track and navigation -->
                <div class="relative">
                    <div id="timeline-track-container" class="overflow-hidden mx-16">
                        <div id="timeline-track" class="flex items-start justify-center transition-transform duration-500 ease-in-out gap-16 md:gap-24">
                            <!-- JS will populate this with events -->
                        </div>
                    </div>
                    <button id="timeline-prev" class="slider-btn left-0 disabled" aria-label="Previous Experience">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
                    </button>
                    <button id="timeline-next" class="slider-btn right-0" aria-label="Next Experience">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
                    </button>
                </div>
            </div>
        </section>

        <section id="education" class="py-20 sm:py-24">
            <h3 class="text-3xl sm:text-4xl font-bold text-center mb-12 gsap-reveal gradient-text" data-translate-key="educationTitle">Education & Certifications</h3>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                 <div class="glass-card p-6 md:p-8 rounded-2xl gsap-reveal">
                     <h4 class="text-2xl font-bold mb-4 md:text-left" data-translate-key="educationSubTitle">Education</h4>
                     <p class="font-semibold text-white" data-translate-key="educationDegree">Bachelor of Tourism and Hotels</p>
                     <p class="text-gray-400" data-translate-key="educationDepartment">Hospitality Management Department</p>
                     <p class="text-sm text-gray-500" data-translate-key="educationInstitute">Higher Institute of Tourism and Hotels - Graduated June 2025</p>
                 </div>
                 <div class="glass-card p-6 md:p-8 rounded-2xl gsap-reveal">
                    <h4 class="text-2xl font-bold mb-4 md:text-left" data-translate-key="languagesSubTitle">Languages</h4>
                    <p data-translate-key="languageArabic"><span class="font-semibold text-white">Arabic:</span> <span class="text-gray-400">Native</span></p>
                    <p data-translate-key="languageEnglish"><span class="font-semibold text-white">English:</span> <span class="text-gray-400">Intermediate Proficiency</span></p>
                </div>
             </div>
        </section>

        <section id="certificates" class="py-20 sm:py-24">
            <div class="text-center">
                <h3 class="text-3xl sm:text-4xl font-bold mb-4 gsap-reveal gradient-text" data-translate-key="certificatesTitle">Certificates & Awards</h3>
                <p class="max-w-2xl mx-auto text-gray-400 mb-12 leading-relaxed gsap-reveal" data-translate-key="certificatesDesc">
                    A collection of my professional certifications and recognitions.
                </p>
            </div>
            <div class="relative max-w-5xl mx-auto h-[350px] md:h-[450px] flex items-center justify-center">
                 <div id="certificates-slider-container" class="relative w-full h-full">
                    <!-- Certificates will be injected here by JS -->
                </div>
                <button id="prev-certificate-slide" class="slider-btn absolute top-1/2 -translate-y-1/2 left-0 sm:-left-4 z-30 disabled" aria-label="Previous Certificate">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
                </button>
                <button id="next-certificate-slide" class="slider-btn absolute top-1/2 -translate-y-1/2 right-0 sm:-right-4 z-30 disabled" aria-label="Next Certificate">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
                </button>
            </div>
        </section>

        <section id="projects" class="py-20 sm:py-24 relative">
            <div class="text-center">
                <h3 class="text-3xl sm:text-4xl font-bold mb-4 gsap-reveal gradient-text" data-translate-key="projectsTitle">My Projects</h3>
                <p class="max-w-2xl mx-auto text-gray-400 mb-12 leading-relaxed gsap-reveal" data-translate-key="projectsDesc">
                    A selection of my recent work. Hover over a project to see more details and click "View Details" to see the full case study.
                </p>
            </div>
            
            <!-- Project Filters -->
            <div id="project-filters" class="flex justify-center flex-wrap gap-3 mb-10 gsap-reveal">
                <!-- Filter buttons will be generated here -->
            </div>

            <div class="relative max-w-7xl mx-auto">
                <div id="projects-slider-container" class="flex overflow-x-auto snap-x snap-mandatory py-4 -mx-6 px-6">
                    <div id="projects-grid" class="flex-none flex gap-8">
                        <!-- Projects are loaded dynamically here from Firebase -->
                    </div>
                </div>
                 <!-- Slider Navigation -->
                <button id="prev-slide" class="slider-btn left-2 md:-left-6" title="Previous" data-translate-title="tooltipSliderPrev" aria-label="Previous Project">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
                </button>
                <button id="next-slide" class="slider-btn right-2 md:-right-6" title="Next" data-translate-title="tooltipSliderNext" aria-label="Next Project">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
                </button>
            </div>
        </section>

        <section id="blog" class="py-20 sm:py-24">
            <div class="text-center">
                <h3 class="text-3xl sm:text-4xl font-bold mb-4 gsap-reveal gradient-text" data-translate-key="blogTitle">From the Blog</h3>
                <p class="max-w-2xl mx-auto text-gray-400 mb-12 leading-relaxed gsap-reveal" data-translate-key="blogDesc">
                    Sharing insights, tips, and tutorials on design, development, and creative technology.
                </p>
            </div>

            <div class="relative max-w-7xl mx-auto">
                <div id="articles-slider-container" class="flex overflow-x-auto snap-x snap-mandatory py-4 -mx-6 px-6">
                    <div id="articles-grid" class="flex-none flex gap-8">
                        <!-- Articles are loaded dynamically here -->
                    </div>
                </div>
                <!-- Slider Navigation -->
                <button id="prev-article-slide" class="slider-btn left-2 md:-left-6" title="Previous Article" aria-label="Previous Article">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
                </button>
                <button id="next-article-slide" class="slider-btn right-2 md:-right-6" title="Next Article" aria-label="Next Article">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
                </button>
            </div>

        </section>

        <section id="testimonials" class="py-20 sm:py-24">
            <h3 class="text-3xl sm:text-4xl font-bold text-center mb-12 gsap-reveal gradient-text" data-translate-key="testimonialsTitle">What Clients Say</h3>
            <div class="relative max-w-3xl mx-auto">
                <button id="prev-testimonial" class="slider-btn left-2 md:left-0 md:-translate-x-1/2" aria-label="Previous Comment">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
                </button>
                <div id="testimonial-slider" class="w-full">
                    <!-- Comments will be loaded here dynamically -->
                </div>
                <button id="next-testimonial" class="slider-btn right-2 md:right-0 md:translate-x-1/2" aria-label="Next Comment">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
                </button>
                <div id="testimonial-dots" class="flex justify-center gap-3 mt-8">
                    <!-- Dots will be generated here -->
                </div>
            </div>

            <!-- Comment form -->
            <div id="comment-section-wrapper" class="max-w-xl mx-auto gsap-reveal mt-20">
                <form id="comment-form">
                    <div class="flex items-start gap-4">
                         <!-- Avatar -->
                        <div class="flex-shrink-0 pt-2">
                            <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-500/30">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            </span>
                        </div>
                        <div class="w-full space-y-4">
                            <!-- Always visible textarea, acts as trigger -->
                            <div>
                                <label for="comment-message" class="sr-only">Your Comment</label>
                                <textarea id="comment-message" name="message" rows="1" placeholder="Leave a reply..." required class="form-input focus:ring-0 focus:border-[var(--accent-color)] transition-all duration-300 resize-none"></textarea>
                            </div>
                            
                            <!-- Collapsible section -->
                            <div id="comment-form-collapsible" class="overflow-hidden transition-all duration-500 ease-in-out" style="max-height: 0px; opacity: 0;">
                                <div class="space-y-4">
                                        <div>
                                        <label for="comment-name" class="sr-only">Your Name</label>
                                        <input type="text" id="comment-name" name="name" placeholder="Your Name" required class="form-input">
                                    </div>
                                    <div class="flex justify-end items-center gap-4">
                                        <button type="button" id="cancel-comment-btn" class="secondary-btn !py-2 !px-4 !text-sm">Cancel</button>
                                        <button type="submit" id="submit-comment-btn" class="submit-btn group">
                                            <span data-translate-key="postCommentBtn">Post Comment</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 ml-2 transition-transform duration-300 group-hover:translate-x-1"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"></path></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div id="comment-status" class="text-center mt-4 h-6 max-w-3xl mx-auto"></div>
        </section>

        <!-- CTA Section -->
        <section id="cta" class="gsap-reveal">
            <div class="glass-card p-6 sm:p-8 text-center flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4">
                <h3 class="text-xl sm:text-2xl font-bold text-white" data-translate-key="ctaTitle">Interested in working together?</h3>
                <p class="text-gray-300" data-translate-key="ctaSubtitle">Let's start a conversation.</p>
            </div>
        </section>
    </main>

    <!-- Project Detail View (replaces modal) -->
    <section id="project-detail-view" class="hidden min-h-screen py-20">
        <div class="container mx-auto px-6">
            <button id="back-to-home-btn" class="secondary-btn mb-8 inline-flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                <span data-translate-key="backToHomeBtn">Back to Home</span>
            </button>
            <div id="project-detail-content" class="max-w-6xl mx-auto">
                <!-- Content will be injected by JS -->
            </div>
        </div>
    </section>

    <!-- Article Detail View -->
    <section id="article-detail-view" class="hidden min-h-screen py-20">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center mb-8">
                <button id="back-to-home-from-article-btn" class="secondary-btn inline-flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                    <span data-translate-key="backToHomeBtn">Back to Home</span>
                </button>
                <div id="article-detail-admin-controls" class="gap-2">
                    <!-- Admin controls will be injected here -->
                </div>
            </div>
            <div id="article-detail-content" class="max-w-4xl mx-auto">
                <!-- Article Content will be injected by JS -->
            </div>
        </div>
    </section>

    <!-- Search Results View -->
    <section id="search-results-view" class="hidden min-h-screen py-20">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center mb-8">
                 <h2 class="text-3xl sm:text-4xl font-bold gradient-text">Search Results</h2>
                <button id="close-search-btn" class="secondary-btn inline-flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    <span>Close</span>
                </button>
            </div>
            <div id="search-results-content" class="max-w-4xl mx-auto">
                <!-- Search results will be injected here -->
            </div>
        </div>
    </section>

    <!-- Store View -->
    <section id="store-view" class="hidden min-h-screen py-20">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center mb-8">
                 <h2 class="text-3xl sm:text-4xl font-bold gradient-text" data-translate-key="navStore">Store</h2>
                <button id="close-store-btn" class="secondary-btn inline-flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    <span>Close</span>
                </button>
            </div>
            <div id="store-content" class="max-w-7xl mx-auto">
                <!-- Grid for products -->
                <div id="products-grid-store" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                    <!-- Products will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- Product Detail View -->
    <section id="product-detail-view" class="hidden min-h-screen py-20">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center mb-8">
                <button id="back-to-store-btn" class="secondary-btn inline-flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                    <span>Back to Store</span>
                </button>
            </div>
            <div id="product-detail-content" class="max-w-7xl mx-auto">
                <!-- Product details will be injected here by JS -->
            </div>
        </div>
    </section>

    <!-- Product Add/Edit Modal -->
    <div id="product-admin-modal" class="modal-hidden fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm product-admin-modal-overlay-bg"></div>
        <div class="relative w-11/12 max-w-2xl project-modal-content glass-card rounded-2xl p-6 md:p-8 z-10 max-h-[90vh] overflow-y-auto">
            <button id="close-product-admin-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors" aria-label="Close">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h3 id="product-admin-modal-title" class="text-2xl font-bold mb-6">Add New Product</h3>
            <form id="product-admin-form" class="space-y-6">
                <input type="hidden" id="product-admin-id" name="id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="product-admin-name" class="form-label">Product Name</label>
                        <input type="text" id="product-admin-name" name="name" required class="form-input">
                    </div>
                    <div>
                        <label for="product-admin-category" class="form-label">Category</label>
                        <input type="text" id="product-admin-category" name="category" required class="form-input">
                    </div>
                </div>
                <div>
                    <label for="product-admin-tags" class="form-label">Tags</label>
                    <input type="text" id="product-admin-tags" name="tags" placeholder="e.g. design, template, 3d" class="form-input">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2">
                        <label for="product-admin-price" class="form-label">Price</label>
                        <input type="number" id="product-admin-price" name="price" required class="form-input">
                    </div>
                    <div>
                        <label for="product-admin-currency" class="form-label">Currency</label>
                        <select id="product-admin-currency" name="currency" class="form-input">
                            <option value="EGP">EGP</option>
                            <option value="USD">USD</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="product-admin-description" class="form-label">Description</label>
                    <textarea id="product-admin-description" name="description" rows="4" required class="form-input"></textarea>
                </div>
                 <div>
                    <label for="product-admin-youtube" class="form-label">YouTube Video URL (Optional)</label>
                    <input type="url" id="product-admin-youtube" name="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." class="form-input">
                </div>
                <div>
                    <label for="product-admin-media" class="form-label">Image URLs</label>
                    <textarea id="product-admin-media" name="media" rows="4" placeholder="Enter one image URL per line." class="form-input"></textarea>
                </div>
                <div class="text-center pt-4">
                    <button type="submit" class="submit-btn group w-full sm:w-auto justify-center px-8 py-3">
                        <span id="product-admin-submit-btn-text">Save Product</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- CV View -->
    <div id="cv-view">
        <div class="cv-container">
            <header class="cv-header flex-shrink-0 flex justify-between items-center p-4 border-b border-[var(--border-primary)]">
                <h2 class="text-xl sm:text-2xl font-bold gradient-text flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    <span data-translate-key="cvTitle">Curriculum Vitae</span>
                </h2>
                <div class="cv-actions flex items-center gap-2">
                    <a href="#" id="download-cv-btn" class="secondary-btn !py-1.5 !px-3 !text-sm" download>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="mr-1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        <span data-translate-key="downloadCvBtn">Download</span>
                    </a>
                    <button id="close-cv-btn" class="nav-link !p-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
            </header>
            <div class="cv-content-wrapper">
                <div class="cv-grid">
                    <!-- Sidebar -->
                    <aside class="cv-sidebar">
                        <div class="text-center mb-8">
                            <img id="cv-profile-picture-img" src="https://i.ibb.co/QFtzp7t3/1172-copy.jpg" alt="Badr Ibraheem" class="w-32 h-32 rounded-full mx-auto mb-4 ring-4 ring-[var(--accent-color)] p-1">
                            <h1 class="text-2xl font-bold" data-translate-key="cvName">Badr Ibraheem</h1>
                            <p class="gradient-text font-semibold" data-translate-key="cvJobTitle">Graphic & Software Designer</p>
                        </div>
                        <div class="space-y-6">
                            <div>
                                <h3 class="font-bold text-lg mb-2 border-b-2 border-[var(--accent-color)] pb-1 inline-block" data-translate-key="cvContactTitle">Contact</h3>
                                <ul class="space-y-2 text-sm">
                                    <li class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg><a href="mailto:badr.e.mohameed@gmail.com" class="hover:text-[var(--accent-color)]">badr.e.mohameed@gmail.com</a></li>
                                    <li class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg><a href="tel:+201069913150" class="hover:text-[var(--accent-color)]">+20 106 991 3150</a></li>
                                    <li class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg><span data-translate-key="cvLocation">Faiyum, Egypt</span></li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg mb-2 border-b-2 border-[var(--accent-color)] pb-1 inline-block" data-translate-key="cvSkillsTitle">Skills</h3>
                                <div class="flex flex-wrap gap-2 text-sm">
                                    <span class="bg-white/10 px-3 py-1 rounded-full" data-translate-key="cvSkillAdobe">Adobe Suite</span>
                                    <span class="bg-white/10 px-3 py-1 rounded-full" data-translate-key="cvSkill3D">3D Design</span>
                                    <span class="bg-white/10 px-3 py-1 rounded-full" data-translate-key="cvSkillUIUX">UI/UX</span>
                                    <span class="bg-white/10 px-3 py-1 rounded-full" data-translate-key="skillOffice">Microsoft Office</span>
                                    <span class="bg-white/10 px-3 py-1 rounded-full" data-translate-key="cvSkillHTML">HTML & CSS</span>
                                    <span class="bg-white/10 px-3 py-1 rounded-full" data-translate-key="cvSkillJS">JavaScript</span>
                                </div>
                            </div>
                             <div>
                                <h3 class="font-bold text-lg mb-2 border-b-2 border-[var(--accent-color)] pb-1 inline-block" data-translate-key="languagesSubTitle">Languages</h3>
                                <p class="text-sm"><strong data-translate-key="cvLangArabicLabel">Arabic:</strong> <span data-translate-key="cvLangArabicLevel">Native</span></p>
                                <p class="text-sm"><strong data-translate-key="cvLangEnglishLabel">English:</strong> <span data-translate-key="cvLangEnglishLevel">Intermediate</span></p>
                            </div>
                        </div>
                    </aside>
                    <!-- Main Content -->
                    <main>
                        <section class="mb-8">
                            <h2 class="text-2xl font-bold mb-4 border-l-4 border-[var(--accent-color)] pl-4" data-translate-key="cvSummaryTitle">Summary</h2>
                            <p class="text-gray-400" data-translate-key="cvSummaryContent">
                                Creative graphic designer and software developer from Faiyum, Egypt with over 3 years of experience in print and digital advertising. Skilled in using 3D elements, Adobe Creative Suite, and modern web technologies to deliver high-quality, impactful visual projects and user experiences.
                            </p>
                        </section>
                        <section class="mb-8">
                            <h2 class="text-2xl font-bold mb-6 border-l-4 border-[var(--accent-color)] pl-4" data-translate-key="experienceTitle">Experience</h2>
                            <div class="relative border-l-2 border-[var(--border-primary)] ml-3 pl-8 space-y-8">
                                 <div class="timeline-item-cv">
                                    <h3 class="font-bold" data-translate-key="exp1Title">Hotel Marketing Intern</h3>
                                    <p class="text-sm text-gray-400" data-translate-key="exp1Meta">Dec 2024 – Feb 2025 | 6th of October City, Giza</p>
                                    <ul class="list-disc pl-5 mt-2 text-gray-400 text-sm space-y-1">
                                        <li data-translate-key="cvExp1Point1">Supported marketing initiatives, including creating content for social media.</li>
                                        <li data-translate-key="cvExp1Point2">Assisted with market research and analysis to guide marketing strategies.</li>
                                    </ul>
                                </div>
                            </div>
                        </section>
                         <section class="mb-8">
                            <h2 class="text-2xl font-bold mb-6 border-l-4 border-[var(--accent-color)] pl-4" data-translate-key="educationTitle">Education</h2>
                             <div class="relative border-l-2 border-[var(--border-primary)] ml-3 pl-8 space-y-8">
                                <div class="timeline-item-cv">
                                    <h3 class="font-bold" data-translate-key="educationDegree">Bachelor of Tourism and Hotels</h3>
                                    <p class="text-sm text-gray-400"><span data-translate-key="educationInstitute">Higher Institute of Tourism and Hotels</span> - <span data-translate-key="cvEducationDate">Graduated June 2025</span></p>
                                </div>
                            </div>
                        </section>
                        <section>
                            <h2 class="text-2xl font-bold mb-6 border-l-4 border-[var(--accent-color)] pl-4" data-translate-key="cvCoursesTitle">Courses & Training</h2>
                             <div class="relative border-l-2 border-[var(--border-primary)] ml-3 pl-8 space-y-8">
                                 <div class="timeline-item-cv">
                                    <h3 class="font-bold" data-translate-key="exp2Title">Graphic Designer Course</h3>
                                    <p class="text-sm text-gray-400" data-translate-key="exp2Meta">Jan 2021 – Feb 2022 | Adobe, Nasr City</p>
                                </div>
                                 <div class="timeline-item-cv">
                                    <h3 class="font-bold" data-translate-key="exp3Title">Air Hostess Training</h3>
                                    <p class="text-sm text-gray-400" data-translate-key="exp3Meta">2022 | Higher Institute of Tourism and Hotels, 6th of October</p>
                                </div>
                            </div>
                        </section>
                    </main>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Contact Button -->
    <button id="contact-fab-btn" class="fixed bottom-6 right-6 md:bottom-8 md:right-8 z-50 cta-btn group" aria-label="Get in touch" title="Get in touch" data-translate-title="tooltipFabContact">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7 transition-transform duration-300 group-hover:scale-110"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
    </button>
    
    <!-- Chatbot Widget -->
    <button id="chat-fab-btn" class="fixed bottom-6 left-6 md:bottom-8 md:left-8 z-50 cta-btn group" aria-label="Open Chatbot" title="Open Chatbot" data-translate-title="tooltipChatbot">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7 transition-transform duration-300 group-hover:scale-110"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2z"></path></svg>
    </button>
    <div id="chat-widget" class="glass-card">
        <div class="chat-header flex justify-between items-center border-b border-white/10">
            <div>
                <h3 class="font-bold text-lg">Badr's Assistant</h3>
                <p class="text-xs text-gray-400">Powered by Gemini AI</p>
            </div>
            <button id="close-chat-btn" class="p-2 -mr-2 text-gray-400 hover:text-white" title="Close chat" data-translate-title="tooltipModalClose">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div id="chat-messages">
            <!-- Messages will be injected here -->
        </div>
        <form id="chat-form">
            <div class="relative">
                <input type="text" id="chat-input" placeholder="Ask about projects, skills..." class="form-input w-full">
                <button type="submit" id="chat-send-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"></path></svg>
                </button>
            </div>
        </form>
    </div>

    <!-- Article Add/Edit Modal -->
    <div id="article-modal" class="modal-hidden fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm article-modal-overlay-bg"></div>
        <div class="relative w-11/12 max-w-3xl project-modal-content glass-card rounded-2xl p-6 md:p-8 z-10 max-h-[90vh] overflow-y-auto">
            <button id="close-article-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors" aria-label="Close" title="Close" data-translate-title="tooltipModalClose">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h3 id="article-modal-title" class="text-2xl font-bold mb-6">Write New Article</h3>
            <form id="article-form" class="space-y-6">
                <input type="hidden" id="article-id" name="id">
                <div>
                    <label for="article-title" class="form-label">Title</label>
                    <input type="text" id="article-title" name="title" placeholder="A catchy title for your article" required class="form-input">
                </div>
                <div>
                    <label for="article-coverImageUrl" class="form-label">Cover Image URL (Optional)</label>
                    <input type="url" id="article-coverImageUrl" name="coverImageUrl" placeholder="https://.../cover-image.jpg" class="form-input">
                </div>
                 <div>
                    <label for="article-tags" class="form-label">Tags / Categories</label>
                    <input type="text" id="article-tags" name="tags" placeholder="Design, Tutorial, Tech" class="form-input">
                </div>
                <div>
                    <label for="article-content" class="form-label">Content (Use new lines for paragraphs)</label>
                    <textarea id="article-content" name="content" rows="12" placeholder="Write your article content here..." required class="form-input"></textarea>
                </div>
                <div class="text-center pt-4">
                    <button type="submit" class="submit-btn group w-full sm:w-auto justify-center px-8 py-3">
                        <span id="article-submit-btn-text">Publish Article</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contact-modal" class="modal-hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
        <!-- Modal Overlay -->
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm modal-overlay-bg"></div>
    
        <!-- Modal Content -->
        <div class="relative w-11/12 max-w-md md:max-w-3xl bg-transparent rounded-2xl z-10 max-h-[85vh] flex flex-col">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors z-20" aria-label="Close" title="Close" data-translate-title="tooltipModalClose">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            
            <div class="grid md:grid-cols-5 glass-card rounded-2xl overflow-y-auto">
                <!-- Left Side: Info -->
                <div class="md:col-span-2 p-4 md:p-8 text-white">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-gold-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
                        </div>
                        <h3 class="text-2xl md:text-3xl font-bold gradient-text" data-translate-key="contactTitle">Get In Touch</h3>
                    </div>
                    <p class="text-gray-300 mb-6 text-sm" data-translate-key="contactDesc">Fill up the form and I will get back to you within 24 hours.</p>
                    
                    <div class="space-y-4">
                        <div class="flex items-start gap-3 text-left">
                            <div class="bg-white/5 p-2 rounded-full text-[#25D366] mt-1">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 4.316 1.905 6.03l-.419 1.533 1.519-.4zM9.5 14.5c-.042-.124-.125-.195-.27-.295-.145-.1-.315-.148-.43-.153s-.24-.008-.344.092c-.105.1-.33.34-.438.465-.108.125-.216.25-.324.375s-.24.165-.368.125c-.128-.04-.547-.21-1.046-.595s-.863-.835-1.19-1.16c-.27-.27-.504-.635-.504-.975s.25-.56.375-.75c.125-.19.25-.31.375-.435s.125-.24.062-.375c-.062-.125-.562-1.345-.75-1.845-.19-.5-.375-.435-.5-.435s-.24-.008-.344.092c-.105.1-.33.34-.438.465s-.33.375-.438.635c-.108.25-.165.56-.165.875s.125 1.19.25 1.435c.125.25.562.935 1.312 1.688s1.438 1.19 2.188 1.5s1.19.438 1.562.438c.312 0 .562-.062.75-.125s.562-.625.625-.75c.062-.125.062-.25.062-.31s-.062-.125-.125-.19c-.062-.062-.24-.125-.312-.19s-.125-.125-.125-.19c0-.062-.042-.125-.062-.165z"/></svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-base text-white" data-translate-key="phoneTitle">WhatsApp</h4>
                                <a href="https://wa.me/201069913150" target="_blank" rel="noopener noreferrer" class="block text-sm text-gray-300 hover:text-white transition-colors">+20 106 991 3150</a>
                                <a href="https://wa.me/201112162908" target="_blank" rel="noopener noreferrer" class="block text-sm text-gray-300 hover:text-white transition-colors mt-1">+20 111 216 2908</a>
                            </div>
                        </div>
                         <a href="mailto:badr.e.mohameed@gmail.com" class="flex items-start gap-3 group text-left">
                            <div class="bg-white/5 p-2 rounded-full group-hover:bg-[var(--accent-color)] group-hover:text-[var(--background-dark)] transition-all duration-300 mt-1">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-base text-white" data-translate-key="emailTitle">Email</h4>
                                <p class="text-sm text-gray-300 group-hover:text-white transition-colors break-all">badr.e.mohameed@gmail.com</p>
                            </div>
                        </a>
                    </div>

                    <div class="mt-6 pt-4 border-t border-white/10">
                         <h4 class="font-semibold text-base mb-3 text-white" data-translate-key="socialTitle">Follow Me</h4>
                         <div class="flex items-center gap-2">
                             <a href="https://www.linkedin.com/in/bdremohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="LinkedIn" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
                             <a href="https://github.com/bdremohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="GitHub" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
                             <a href="https://x.com/bdr_e_mohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="X" title="X (formerly Twitter)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></a>
                         </div>
                    </div>
                </div>

                <!-- Right Side: Form -->
                <div class="md:col-span-3 p-4 md:p-8">
                    <form id="contact-form" action="https://formspree.io/f/mzzayzwe" method="POST" class="space-y-4">
                        <div>
                            <label for="contact-name" class="sr-only">Name</label>
                            <input type="text" id="contact-name" name="name" placeholder="Your Name" required class="form-input" data-translate-placeholder="formName">
                        </div>
                        <div>
                             <label for="contact-email" class="sr-only">Email</label>
                            <input type="email" id="contact-email" name="email" placeholder="Your Email" required class="form-input" data-translate-placeholder="formEmail">
                        </div>
                        <div>
                            <label for="contact-message" class="sr-only">Message</label>
                            <textarea id="contact-message" name="message" rows="4" placeholder="Your Message" required class="form-input" data-translate-placeholder="formMessage"></textarea>
                        </div>
                        <div class="pt-1">
                            <button type="submit" class="submit-btn group w-full justify-center">
                                <span data-translate-key="sendMessageBtn">Send Message</span>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 ml-2 transition-transform duration-300 group-hover:translate-x-1"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"></path></svg>
                            </button>
                        </div>
                    </form>
                    <div id="form-status" class="text-center mt-4 h-6"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Lightbox Modal -->
    <div id="image-lightbox" class="modal-hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-md lightbox-overlay"></div>
        <img id="lightbox-image" src="" alt="Full-size project image, enlarged view." class="relative max-w-full max-h-full rounded-lg z-10" loading="lazy">
        <button id="close-lightbox-btn" class="absolute top-6 right-6 text-white hover:text-gray-300 transition-colors z-20" aria-label="Close" title="Close" data-translate-title="tooltipModalClose">
             <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-hidden fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm settings-modal-overlay-bg"></div>
        <div class="relative w-11/12 max-w-lg project-modal-content glass-card rounded-2xl p-6 md:p-8 z-10 max-h-[90vh] overflow-y-auto">
            <button id="close-settings-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors" aria-label="Close">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h3 class="text-2xl font-bold mb-6">Profile Settings</h3>
            <form id="settings-form" class="space-y-6">
                <div>
                    <label for="light-mode-url" class="form-label">Light Mode Profile Picture URL</label>
                    <input type="url" id="light-mode-url" name="lightModeUrl" placeholder="https://..." required class="form-input">
                </div>
                 <div>
                    <label for="dark-mode-url" class="form-label">Dark Mode Profile Picture URL</label>
                    <input type="url" id="dark-mode-url" name="darkModeUrl" placeholder="https://..." required class="form-input">
                </div>
                <div class="border-t border-white/10 pt-6 mt-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <label for="maintenance-mode-toggle" class="form-label !mb-0">Maintenance Mode</label>
                            <p class="text-xs text-gray-400">Puts the site offline for all visitors.</p>
                        </div>
                        <label for="maintenance-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="maintenance-mode-toggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-violet-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-violet-600"></div>
                        </label>
                    </div>
                </div>
                <div id="settings-status" class="text-center h-5 text-sm"></div>
                <div class="text-center pt-4">
                    <button type="submit" class="submit-btn group w-full sm:w-auto justify-center px-8 py-3">
                        <span>Save Settings</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Certificate Gallery Modal -->
    <div id="certificate-gallery-modal" class="modal-hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-md certificate-gallery-overlay"></div>
        <div class="relative w-full max-w-5xl h-full flex flex-col items-center justify-center">
            <img id="certificate-gallery-image" src="" alt="Full-size certificate image." class="relative max-w-full max-h-[85%] object-contain rounded-lg z-10">
            <p id="certificate-gallery-title" class="text-white text-lg font-bold mt-4"></p>
            <button id="close-certificate-gallery-btn" class="absolute top-6 right-6 text-white hover:text-gray-300 transition-colors z-20" aria-label="Close">
                 <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <button id="certificate-gallery-prev" class="absolute left-4 top-1/2 -translate-y-1/2 gallery-nav button text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            <button id="certificate-gallery-next" class="absolute right-4 top-1/2 -translate-y-1/2 gallery-nav button text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>
        </div>
    </div>

    <!-- Certificate Add/Edit Modal -->
    <div id="certificate-modal" class="modal-hidden fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm certificate-modal-overlay-bg"></div>
        <div class="relative w-11/12 max-w-lg project-modal-content glass-card rounded-2xl p-6 md:p-8 z-10 max-h-[90vh] overflow-y-auto">
            <button id="close-certificate-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors" aria-label="Close">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h3 id="certificate-modal-title" class="text-2xl font-bold mb-6">Add Certificate</h3>
            <form id="certificate-form" class="space-y-6">
                <input type="hidden" id="certificate-id" name="id">
                <div>
                    <label for="certificate-title" class="form-label">Certificate Title</label>
                    <input type="text" id="certificate-title" name="title" placeholder="e.g., Adobe Certified Expert" required class="form-input">
                </div>
                <div>
                    <label for="certificate-imageUrl" class="form-label">Image URL</label>
                    <input type="url" id="certificate-imageUrl" name="imageUrl" placeholder="https://.../certificate.jpg" required class="form-input">
                </div>
                <div class="text-center pt-4">
                    <button type="submit" class="submit-btn group w-full sm:w-auto justify-center px-8 py-3">
                        <span id="certificate-submit-btn-text">Save Certificate</span>
                    </button>
                </div>
            </form>
        </div>
    </div>


    <footer class="mt-20 border-t border-white/10 pt-12 pb-40 sm:pb-24">
        <div class="container mx-auto px-6 text-center text-gray-500">
            <div class="mb-8 flex justify-center items-center flex-wrap gap-x-2 sm:gap-x-4 gap-y-4">
                <!-- Updated Social Media Icons -->
                <a href="https://www.linkedin.com/in/bdremohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="LinkedIn" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
                <a href="https://github.com/bdremohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="GitHub" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
                <a href="https://x.com/bdr_e_mohameed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="X" title="X (formerly Twitter)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></a>
                <a href="https://www.facebook.com/bdr.e.mohmed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="Facebook" title="Facebook"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a>
                <a href="https://www.instagram.com/bdr_e_mohamed" target="_blank" rel="noopener noreferrer" class="social-btn" aria-label="Instagram" title="Instagram"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg></a>
            </div>
            <p data-translate-key="footerRights">&copy; 2025 Badr. All rights reserved.</p>
        </div>
    </footer>

            <script src="https://unpkg.com/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    
    <script type="module">
        // --- Firebase SDK Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, getDoc, addDoc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, query, orderBy, increment, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyAscmJUPUyFwcE9fiYDNon6-YRM4Xgu1a4",
            authDomain: "website-me-7404b.firebaseapp.com",
            projectId: "website-me-7404b",
            storageBucket: "website-me-7404b.appspot.com",
            messagingSenderId: "436023684505",
            appId: "1:436023684505:web:e69745fac9c926d21cb708",
            measurementId: "G-W1HDBJFGV5"
        };

        // --- Initialize Firebase ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Firestore Collection References ---
        const projectsCollection = collection(db, 'projects');
        const articlesCollection = collection(db, 'articles');
            const certificatesCollection = collection(db, 'certificates');
        const productsCollection = collection(db, 'products');
        const siteStatusRef = doc(db, 'settings', 'site_status');

        // --- Translations ---
        const translations = {
            en: {
                navHome: 'Home', navServices: 'Services', navSkills: 'Skills', navExperience: 'Experience', navProjects: 'Projects', navBlog: 'Blog', navCertificates: 'Certificates', navStore: 'Store',
                heroLine1: 'Badr', heroLine2: 'Ibraheem Mohameed', heroLine3: 'Digital Experience Designer',
                heroGreeting: "Hello, I'm",
                heroBio: "I combine design and code to build engaging digital experiences. Specializing in creating unique visual identities and interactive websites that captivate users.",
                heroCtaViewWork: 'View My Work',
                heroCtaContact: 'Contact Me',
                aboutTitle: 'About Me',
                aboutParagraph: 'I am a creative graphic designer and software developer from Faiyum, Egypt with over 3 years of experience in print and digital advertising. I am skilled in using 3D elements and Microsoft Office tools, and I deliver high-quality designs on time. I am constantly striving to develop and contribute to impactful visual projects.',
                statYears: 'Years Experience',
                statProjects: 'Projects Completed',
                statClients: 'Happy Clients',
                technicalSkillsTitle: 'Technical Skills',
                skillAdobe: 'Adobe Creative Suite',
                skillOffice: 'Microsoft Office Suite',
                skillComputer: 'Computer Operations',
                skill3d: '3D & Visual Design',
                skillBrandDesc: "Logos, Style Guides, Visual Systems",
                skillUiUxDesc: "Websites, Mobile Apps, Prototypes",
                skill3dDesc: "Blender, 3D Rendering",
                skillHtmlCssDesc: "Responsive Web Layouts",
                skillJsDesc: "Interactive Web Elements",
                skillOfficeDesc: "Word, PowerPoint, Excel",
                personalSkillsTitle: 'Personal Skills',
                skillCommunication: 'Communication',
                skillTeamwork: 'Teamwork & Collaboration',
                skillAdaptable: 'Adaptable & Quick Learner',
                skillAttention: 'Attention to detail and high-quality work',
                skillProblemSolving: 'Creative Problem-Solving',
                servicesTitle: 'What I Offer',
                serviceGraphicTitle: 'Brand Identity & Visual Design',
                serviceGraphicDesc: 'Crafting memorable brand identities, from logos to complete visual systems, that tell a compelling story across all digital platforms.',
                serviceDigitalTitle: 'UI/UX & Product Design',
                serviceDigitalDesc: 'Designing intuitive, user-centric interfaces for websites and applications that are both beautiful and highly functional.',
                serviceDevTitle: 'Interactive Development',
                serviceDevDesc: 'Bringing designs to life with front-end development, creating smooth animations and engaging 3D web experiences.',
                skillsTitle: 'Core Competencies',
                experienceTitle: 'Experience & Training',
                exp1Title: 'Hotel Marketing Intern',
                exp1Meta: 'Dec 2024 – Feb 2025 | 6th of October City, Giza',
                exp1Desc: 'Supported marketing initiatives, including creating content for social media and other platforms. Assisted with market research and analysis to guide marketing strategies.',
                exp2Title: 'Graphic Designer Course',
                exp2Meta: 'Jan 2021 – Feb 2022 | Adobe, Nasr City',
                exp2Desc: 'Comprehensive training focused on graphic design principles, visual identity creation, and proficiency in the Adobe Creative Suite.',
                exp3Title: 'Air Hostess Training',
                exp3Meta: '2022 | Higher Institute of Tourism and Hotels, 6th of October',
                exp3Desc: 'Completed university course in air hospitality and passenger service standards, in collaboration with EgyptAir.',
                exp4Title: 'Assistant Chef Training',
                exp4Meta: '2019 | Holiday Inn, Nasr City',
                exp4Desc: 'Gained practical experience in kitchen operations and culinary assistance at a professional hotel.',
                projectsTitle: 'My Projects',
                certificatesTitle: 'Certificates & Awards',
                certificatesDesc: 'A collection of my professional certifications and recognitions.',
                addCertificateBtn: 'Add New Certificate',
                blogTitle: 'From the Blog',
                blogDesc: 'Sharing insights, tips, and tutorials on design, development, and creative technology.',
                addArticleBtn: 'Write New Article',
                readMoreBtn: 'Read More',
                formMessage: 'Your Message',
                projectDetailAboutTitle: 'About This Project',
                projectDetailInfoTitle: 'Project Info',
                projectDetailDate: 'Date',
                projectDetailTools: 'Tools Used',
                projectDetailStatus: 'Status',
                projectDetailTags: 'Tags',
                projectDetailVisitBtn: 'Visit Project',
                projectDetailDownloadBtn: 'Download',
                tooltipToggleTheme: 'Toggle theme',
                tooltipChangeLang: 'Change language',
                tooltipAdminEdit: 'Edit',
                tooltipAdminDelete: 'Delete',
                tooltipSliderPrev: 'Previous',
                tooltipSliderNext: 'Next',
                tooltipModalClose: 'Close',
                tooltipFabContact: 'Get in touch',
                tooltipChatbot: 'Open Chatbot',
                resumeBtn: 'Download CV',
                downloadCvBtn: 'Download CV',
                ctaTitle: 'Interested in working together?',
                ctaSubtitle: "Let's start a conversation.",
                cvTitle: "My CV",
                cvName: "Badr Ibraheem",
                cvJobTitle: "Graphic & Software Designer",
                cvContactTitle: "Contact",
                cvLocation: "Faiyum, Egypt",
                cvSkillsTitle: "Skills",
                ctaSubtitle: "Let's start a conversation.",
                cvTitle: "My CV",
                cvName: "Badr Ibraheem",
                cvJobTitle: "Graphic & Software Designer",
                cvContactTitle: "Contact",
                cvLocation: "Faiyum, Egypt",
                cvSkillsTitle: "Skills",
                cvSkillAdobe: "Adobe Suite",
                cvSkill3D: "3D Design",
                cvSkillUIUX: "UI/UX",
                cvSkillHTML: "HTML & CSS",
                cvSkillJS: "JavaScript",
                cvLangArabicLabel: "Arabic:",
                cvLangArabicLevel: "Native",
                cvLangEnglishLabel: "English:",
                cvLangEnglishLevel: "Intermediate",
                cvSummaryTitle: "Summary",
                cvSummaryContent: "Creative graphic designer and software developer from Faiyum, Egypt with over 3 years of experience in print and digital advertising. Skilled in using 3D elements, Adobe Creative Suite, and modern web technologies to deliver high-quality, impactful visual projects and user experiences.",
                cvExp1Point1: "Supported marketing initiatives, including creating content for social media.",
                cvExp1Point2: "Assisted with market research and analysis to guide marketing strategies.",
                cvEducationDate: "Graduated June 2025",
                cvCoursesTitle: "Courses & Training",
                phoneTitle: "WhatsApp",
                productDetailBtn: "Details",
                addProductBtn: "Add New Product",
                productDescriptionTitle: "Description",
                productTagsTitle: "Tags",
            },
            ar: {
                navHome: 'الرئيسية', navServices: 'الخدمات', navSkills: 'المهارات', navExperience: 'الخبرة', navProjects: 'المشاريع', navBlog: 'المدونة', navCertificates: 'الشهادات', navStore: 'المتجر',
                heroLine1: 'بدر', heroLine2: 'ابراهيم محمد', heroLine3: 'مصمم تجارب رقمية',
                heroGreeting: 'مرحباً، أنا',
                heroBio: 'أدمج التصميم والبرمجة لبناء تجارب رقمية تفاعلية. متخصص في إنشاء هويات بصرية فريدة ومواقع ويب تفاعلية تأسر المستخدمين.',
                heroCtaViewWork: 'عرض أعمالي',
                heroCtaContact: 'تواصل معي',
                aboutTitle: 'عني',
                aboutParagraph: 'أنا مصمم جرافيك ومطور برامج مبدع من الفيوم، مصر ولدي أكثر من 3 سنوات من الخبرة في الإعلانات المطبوعة والرقمية. أنا ماهر في استخدام العناصر ثلاثية الأبعاد وأدوات مايكروسوفت أوفيس، وأقدم تصميمات عالية الجودة في الوقت المحدد. أسعى باستمرار للتطوير والمساهمة في المشاريع المرئية المؤثرة.',
                statYears: 'سنوات خبرة',
                statProjects: 'مشروع مكتمل',
                statClients: 'عميل سعيد',
                technicalSkillsTitle: 'المهارات الفنية',
                skillAdobe: 'مجموعة أدوبي كريتيف',
                skillOffice: 'مجموعة مايكروسوفت أوفيس',
                skillComputer: 'عمليات الحاسوب',
                skill3d: 'العناصر ثلاثية الأبعاد والتصميم المرئي',
                skillBrandDesc: "شعارات، أدلة بصرية، أنظمة مرئية",
                skillUiUxDesc: "مواقع ويب، تطبيقات جوال، نماذج أولية",
                skill3dDesc: "بلندر، تصيير ثلاثي الأبعاد",
                skillHtmlCssDesc: "تخطيطات ويب سريعة الاستجابة",
                skillJsDesc: "عناصر ويب تفاعلية",
                skillOfficeDesc: "وورد، بوربوينت، إكسل",
                personalSkillsTitle: 'المهارات الشخصية',
                skillCommunication: 'التواصل',
                skillTeamwork: 'العمل الجماعي والتعاون',
                skillAdaptable: 'قابلية التكيف وسرعة التعلم',
                skillAttention: 'الاهتمام بالتفاصيل وجودة العمل العالية',
                skillProblemSolving: 'حل المشكلات الإبداعي',
                servicesTitle: 'ماذا أقدم',
                serviceGraphicTitle: 'الهوية التجارية والتصميم البصري',
                serviceGraphicDesc: 'صياغة هويات تجارية لا تُنسى، من الشعارات إلى الأنظمة المرئية الكاملة، التي تروي قصة مقنعة عبر جميع المنصات الرقمية.',
                serviceDigitalTitle: 'تصميم واجهة وتجربة المستخدم',
                serviceDigitalDesc: 'تصميم واجهات بديهية تتمحور حول المستخدم للمواقع والتطبيقات، تجمع بين الجمال والكفاءة العالية.',
                serviceDevTitle: 'التطوير التفاعلي',
                serviceDevDesc: 'إحياء التصاميم من خلال تطوير الواجهات الأمامية، وإنشاء رسوم متحركة سلسة وتجارب ويب ثلاثية الأبعاد جذابة.',
                skillsTitle: 'الكفاءات الأساسية',
                experienceTitle: 'الخبرة والتدريب',
                exp1Title: 'متدرب تسويق فندقي',
                exp1Meta: 'ديسمبر 2024 – فبراير 2025 | مدينة 6 أكتوبر، الجيزة',
                exp1Desc: 'دعم مبادرات التسويق، بما في ذلك إنشاء محتوى لوسائل التواصل الاجتماعي والمنصات الأخرى. المساعدة في أبحاث السوق وتحليلها لتوجيه استراتيجيات التسويق.',
                exp2Title: 'دورة مصمم جرافيك',
                exp2Meta: 'يناير 2021 – فبراير 2022 | شركة أدوبي، مدينة نصر',
                exp2Desc: 'تدريب شامل يركز على مبادئ التصميم الجرافيكي، وإنشاء الهوية البصرية، وإتقان مجموعة أدوبي كريتيف.',
                exp3Title: 'تدريب الضيافة الجوية',
                exp3Meta: '2022 | المعهد العالي للسياحة والفنادق، 6 أكتوبر',
                exp3Desc: 'إتمام دورة جامعية في معايير الضيافة الجوية وخدمة الركاب بالتعاون مع مصر للطيران.',
                exp4Title: 'تدريب مساعد شيف',
                exp4Meta: '2019 | هوليداي إن، مدينة نصر',
                exp4Desc: 'اكتساب خبرة عملية في عمليات المطبخ والمساعدة في الطهي في فندق احترافي.',
                projectsTitle: 'مشاريعي',
                projectsDesc: 'مجموعة مختارة من أعمالي الأخيرة. مرر الفأرة فوق المشروع لرؤية المزيد من التفاصيل وانقر على "عرض التفاصيل" لرؤية دراسة الحالة الكاملة.',
                addProjectBtn: 'إضافة مشروع جديد',
                certificatesTitle: 'الشهادات والجوائز',
                certificatesDesc: 'مجموعة من شهاداتي المهنية والتقديرات التي حصلت عليها.',
                addCertificateBtn: 'إضافة شهادة جديدة',
                testimonialsTitle: 'ماذا يقول العملاء',
                blogTitle: 'من المدونة',
                blogDesc: 'أشارك رؤى ونصائح ودروسًا تعليمية حول التصميم والتطوير والتكنولوجيا الإبداعية.',
                addArticleBtn: 'اكتب مقال جديد',
                readMoreBtn: 'اقرأ المزيد',
                replyTitle: 'اترك ردًا',
                replyDesc: 'ملاحظاتك قيمة ومقدرة!',
                postCommentBtn: 'انشر التعليق',
                backToHomeBtn: 'العودة إلى الرئيسية',
                footerRights: '&copy; 2025 بدر. كل الحقوق محفوظة.',
                educationTitle: 'التعليم والشهادات',
                educationSubTitle: 'التعليم',
                educationDegree: 'بكالوريوس سياحة وفنادق',
                educationDepartment: 'قسم إدارة الضيافة',
                educationInstitute: 'المعهد العالي للسياحة والفنادق - تخرج يونيو 2025',
                languagesSubTitle: 'اللغات',
                languageArabic: '<span class="font-semibold text-white">العربية:</span> <span class="text-gray-400">اللغة الأم</span>',
                languageEnglish: '<span class="font-semibold text-white">الإنجليزية:</span> <span class="text-gray-400">إتقان متوسط</span>',
                contactTitle: 'تواصل معي',
                contactDesc: 'املأ النموذج وسأعود إليك في غضون 24 ساعة.',
                emailTitle: 'البريد الإلكتروني',
                phoneTitle: 'واتساب',
                socialTitle: 'تابعني',
                sendMessageBtn: 'إرسال رسالة',
                formName: 'اسمك',
                formEmail: 'بريدك الإلكتروني',
                formMessage: 'رسالتك',
                projectDetailAboutTitle: 'عن هذا المشروع',
                projectDetailInfoTitle: 'معلومات المشروع',
                projectDetailDate: 'التاريخ',
                projectDetailTools: 'الأدوات المستخدمة',
                projectDetailStatus: 'الحالة',
                projectDetailTags: 'العلامات',
                projectDetailVisitBtn: 'زيارة المشروع',
                projectDetailDownloadBtn: 'تحميل',
                tooltipToggleTheme: 'تبديل المظهر',
                tooltipChangeLang: 'تغيير اللغة',
                tooltipAdminEdit: 'تعديل',
                tooltipAdminDelete: 'حذف',
                tooltipSliderPrev: 'السابق',
                tooltipSliderNext: 'التالي',
                tooltipModalClose: 'إغلاق',
                tooltipFabContact: 'تواصل معي',
                tooltipChatbot: 'افتح المحادثة',
                resumeBtn: 'تحميل السيرة الذاتية',
                downloadCvBtn: 'تحميل السيرة الذاتية',
                ctaTitle: 'هل أنت مهتم بالعمل معاً؟',
                ctaSubtitle: 'لِنبدأ حواراً.',
                cvTitle: "سيرتي الذاتية",
                cvName: "بدر إبراهيم",
                cvJobTitle: "مصمم جرافيك ومطور برامج",
                cvContactTitle: "معلومات التواصل",
                cvLocation: "الفيوم، مصر",
                cvSkillsTitle: "المهارات",
                cvSkillAdobe: "مجموعة أدوبي",
                cvSkill3D: "تصميم ثلاثي الأبعاد",
                cvSkillUIUX: "تصميم واجهات وتجربة المستخدم",
                cvSkillHTML: "HTML & CSS",
                cvSkillJS: "JavaScript",
                cvLangArabicLabel: "العربية:",
                cvLangArabicLevel: "اللغة الأم",
                cvLangEnglishLabel: "الإنجليزية:",
                cvLangEnglishLevel: "مستوى متوسط",
                cvSummaryTitle: "ملخص احترافي",
                cvSummaryContent: "مصمم جرافيك ومطور برامج مبدع من الفيوم، مصر بخبرة تزيد عن 3 سنوات في مجال الإعلانات المطبوعة والرقمية. ماهر في استخدام العناصر ثلاثية الأبعاد، ومجموعة أدوبي كريتيف، وتقنيات الويب الحديثة لتقديم مشاريع مرئية عالية الجودة وتجارب مستخدم مؤثرة.",
                cvExp1Point1: "دعم المبادرات التسويقية، بما في ذلك إنشاء محتوى لوسائل التواصل الاجتماعي.",
                cvExp1Point2: "المساعدة في أبحاث السوق وتحليلها لتوجيه استراتيجيات التسويق.",
                educationDegree: "بكالوريوس سياحة وفنادق",
                educationInstitute: "المعهد العالي للسياحة والفنادق",
                cvEducationDate: "تخرج يونيو 2025",
                cvCoursesTitle: "الدورات والتدريب",
                productDetailBtn: "التفاصيل",
                addProductBtn: "أضف منتج جديد",
                productDescriptionTitle: "الوصف",
                productTagsTitle: "الوسوم",
            }
        };

        // --- Google Translate ---
        function getMediaEmbedHTML(url, type, title) {
            let embedHTML = '';
            if(!url) return ''; // Return nothing if no URL is provided
            try {
                // For direct file links or when URL object fails for partial links
                if (type === 'video' && url.match(/\.(mp4|webm|ogg)$/i)) {
                    return `<div class="video-container rounded-lg mb-6 overflow-hidden"><video controls autoplay loop muted playsinline src="${url}" class="w-full h-full object-contain"></video></div>`;
                }
                if (type === 'image' && url.match(/\.(jpeg|jpg|gif|png|webp|svg)$/i)) {
                     return `<div class="rounded-lg mb-6 overflow-hidden"><img src="${url}" alt="${title}" class="w-full h-auto max-h-[60vh] object-contain rounded-lg" loading="lazy"></div>`;
                }

                const urlObj = new URL(url);
                const hostname = urlObj.hostname.replace('www.', '');

                // Handle Instagram & Facebook links: Direct embedding is unreliable due to their platform policies.
                if (hostname.includes('instagram.com') || hostname.includes('facebook.com')) {
                    return `
                        <div class="text-center text-amber-300 p-4 rounded-lg bg-amber-500/10 border border-amber-500/30">
                            <h4 class="font-bold mb-2">Embedding from Instagram & Facebook is Unreliable</h4>
                            <p class="text-sm">For a stable portfolio, it's best to upload your video to <strong>YouTube</strong> or <strong>Vimeo</strong>. Your site is already set up to embed those links perfectly. This avoids issues with broken video links in the future.</p>
                        </div>`;
                }
                else if (type === 'video') {
                    if (hostname === 'youtube.com' || hostname === 'youtu.be') {
                        let videoId = urlObj.searchParams.get('v');
                        if (hostname === 'youtu.be') {
                            videoId = urlObj.pathname.substring(1);
                        }
                        if (videoId) {
                            embedHTML = `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                        }
                    } else if (hostname === 'vimeo.com') {
                        const videoId = urlObj.pathname.split('/').pop();
                        if (videoId) {
                             embedHTML = `<iframe src="https://player.vimeo.com/video/${videoId}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
                        }
                    }
                } else if (type === 'image') {
                    // Fallback for other image links (non-Instagram)
                    return `<div class="rounded-lg mb-6 overflow-hidden"><img src="${url}" alt="${title}" class="w-full h-auto max-h-[60vh] object-contain rounded-lg" loading="lazy"></div>`;
                }

                if (embedHTML) {
                    return `<div class="video-container rounded-lg mb-6 overflow-hidden">${embedHTML}</div>`;
                } else {
                    return `<div class="text-center text-red-400 p-4 rounded-lg bg-red-500/10">Could not embed media. The URL might be private or unsupported.</div>`;
                }

            } catch (error) {
                console.error("Invalid URL:", url, error);
                return `<div class="text-center text-red-400 p-4 rounded-lg bg-red-500/10">Invalid or unsupported media URL provided.</div>`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const originalTitle = document.title;
            let lastScrollPosition = 0;
            
            // --- Disable Right-Click Context Menu ---
            document.addEventListener('contextmenu', event => event.preventDefault());

            // --- DevTools Protection ---
            function detectDevTools() {
                const devtools = {
                    isOpen: false,
                    orientation: null
                };

                const threshold = 160;

                const emitEvent = (isOpen, orientation) => {
                    window.dispatchEvent(new CustomEvent('devtoolschange', {
                        detail: {
                            isOpen,
                            orientation
                        }
                    }));
                };

                setInterval(() => {
                    const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                    const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                    const orientation = widthThreshold ? 'vertical' : 'horizontal';

                    if (
                        !(heightThreshold && widthThreshold) &&
                        ((window.Firebug && window.Firebug.chrome && window.Firebug.chrome.isInitialized) || widthThreshold || heightThreshold)
                    ) {
                        if (!devtools.isOpen || devtools.orientation !== orientation) {
                            emitEvent(true, orientation);
                        }

                        devtools.isOpen = true;
                        devtools.orientation = orientation;
                    } else {
                        if (devtools.isOpen) {
                            emitEvent(false, null);
                        }

                        devtools.isOpen = false;
                        devtools.orientation = null;
                    }
                }, 500);

                let isDevToolsOpen = false;
                window.addEventListener('devtoolschange', event => {
                    isDevToolsOpen = event.detail.isOpen;
                });
                
                // Anti-debugging function
                (function() {
                    function block() {
                        // When DevTools are open, this debugger statement will be hit repeatedly, 
                        // making it difficult to inspect or debug the code.
                        if (isDevToolsOpen) {
                             // Clearing the console makes it harder to see logs.
                            console.clear();
                            // Logging a message can be a deterrent.
                            console.log('%cStop!', 'color: red; font-size: 48px; font-weight: bold; -webkit-text-stroke: 1px black;');
                            console.log('This area is intended for developers. Please close this window.');
                            debugger;
                        }
                    }
                    // Run the check frequently.
                    setInterval(block, 1000);
                }());
            }
            detectDevTools();

            // --- 3D Background Setup ---
            let scene, camera, renderer, particles, animationFrameId;
            let mouseX = 0, mouseY = 0;
            const windowHalfX = window.innerWidth / 2;
            const windowHalfY = window.innerHeight / 2;
            let isThreeJSInitialized = false;

            // --- Background Video Optimization ---
            // This logic is now handled inside the applyTheme function to support dynamic video switching.

            let myProjects = [];
            let commentsData = [];
            let articlesData = [];
            let certificatesData = [];
            let productsData = [];
            
            // --- UI Elements ---
            const mainContent = document.querySelector('main');
            const projectDetailView = document.getElementById('project-detail-view');
            const projectsGrid = document.getElementById('projects-grid');
            const projectFiltersContainer = document.getElementById('project-filters');
            const authContainer = document.getElementById('auth-container');
            const articlesGrid = document.getElementById('articles-grid');
            const certificatesGrid = document.getElementById('certificates-grid');
            const articleDetailView = document.getElementById('article-detail-view');
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const searchBtn = document.getElementById('search-btn');
            const searchOverlay = document.getElementById('search-overlay');
            const searchContainer = document.getElementById('search-container');
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');
            const searchResultsView = document.getElementById('search-results-view');
            const searchResultsContent = document.getElementById('search-results-content');
            const closeSearchBtn = document.getElementById('close-search-btn');
            const header = document.querySelector('header');
            const cvView = document.getElementById('cv-view');
            const readingProgressBar = document.getElementById('reading-progress-bar');
            const storeView = document.getElementById('store-view');
            const closeStoreBtn = document.getElementById('close-store-btn');
            const productDetailView = document.getElementById('product-detail-view');
            const backToStoreBtn = document.getElementById('back-to-store-btn');
            
            // --- THEME SWITCHER ---
            const body = document.body;
            const currentTheme = localStorage.getItem('theme');

            function applyTheme(theme) {
                const articleContent = document.querySelector('#article-detail-content .prose');
                const canvasEl = document.getElementById('bg-canvas');
                const profilePic = document.getElementById('profile-picture-img');
                const cvProfilePic = document.getElementById('cv-profile-picture-img');

                if (theme === 'light') {
                    body.classList.add('light-mode');
                    if (articleContent) articleContent.classList.remove('prose-invert');
                    if (profilePic && profilePic.dataset.lightSrc) {
                        profilePic.src = profilePic.dataset.lightSrc;
                    }
                    if (cvProfilePic && cvProfilePic.dataset.lightSrc) {
                        cvProfilePic.src = cvProfilePic.dataset.lightSrc;
                    }
                    
                    if (canvasEl) canvasEl.style.display = 'block';

                    if (!isThreeJSInitialized) {
                        initThreeJS();
                    }
                    startThreeJSAnimation();

                } else { // Dark mode
                    body.classList.remove('light-mode');
                    if (articleContent) articleContent.classList.add('prose-invert');
                    if (profilePic && profilePic.dataset.darkSrc) {
                        profilePic.src = profilePic.dataset.darkSrc;
                    }
                    if (cvProfilePic && cvProfilePic.dataset.darkSrc) {
                        cvProfilePic.src = cvProfilePic.dataset.darkSrc;
                    }
                    
                    if (canvasEl) canvasEl.style.display = 'none';
                    stopThreeJSAnimation();
                    
                }
            }

            async function loadThemeAndSettings() {
                try {
                    const publicSettingsRef = doc(db, 'settings', 'main_profile');
                    const settingsDoc = await getDoc(publicSettingsRef);
                    
                    if (settingsDoc.exists()) {
                        const publicSettings = settingsDoc.data();
                        const profilePic = document.getElementById('profile-picture-img');
                        const cvProfilePic = document.getElementById('cv-profile-picture-img');

                        if (publicSettings.lightModeUrl) {
                            if(profilePic) profilePic.dataset.lightSrc = publicSettings.lightModeUrl;
                            if(cvProfilePic) cvProfilePic.dataset.lightSrc = publicSettings.lightModeUrl;
                        }
                        if (publicSettings.darkModeUrl) {
                            if(profilePic) profilePic.dataset.darkSrc = publicSettings.darkModeUrl;
                            if(cvProfilePic) cvProfilePic.dataset.darkSrc = publicSettings.darkModeUrl;
                        }
                    }
                } catch (error) {
                    console.error("Could not load public profile settings:", error);
                } finally {
                    // Determine and apply the theme after fetching settings
                    let initialTheme = localStorage.getItem('theme') || 'dark';
                    if (!localStorage.getItem('theme') && window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                        initialTheme = 'light';
                    }
                    localStorage.setItem('theme', initialTheme);
                    applyTheme(initialTheme);
                }
            }

            themeToggleBtn.addEventListener('click', () => {
                const newTheme = body.classList.contains('light-mode') ? 'dark' : 'light';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });


            // --- PROJECTS DATA HANDLING (FIRESTORE) ---
            function listenForProjects() {
                // The original query required a composite index. By removing orderBy and sorting client-side, we avoid this requirement.
                onSnapshot(projectsCollection, (snapshot) => {
                    myProjects = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));

                    // Update completed projects count
                    const completedProjectsCount = myProjects.filter(p => p.status === 'Completed').length;
                    const projectsStatElement = document.getElementById('projects-completed-stat');
                    if (projectsStatElement) {
                        projectsStatElement.textContent = `${completedProjectsCount}+`;
                    }

                    // Sort projects client-side to avoid needing a composite index
                    myProjects.sort((a, b) => {
                        // Sort by featured status (true comes first)
                        const featuredSort = (b.featured ? 1 : 0) - (a.featured ? 1 : 0);
                        if (featuredSort !== 0) {
                            return featuredSort;
                        }
                        // Then sort by date (newest first)
                        return new Date(b.date) - new Date(a.date);
                    });

                    generateFilterButtons();
                    displayProjects();
                }, (error) => {
                    console.error("Error fetching projects: ", error);
                    projectsGrid.innerHTML = `
                        <div class="w-full flex flex-col items-center justify-center text-center p-8 gap-4 glass-card rounded-2xl mx-auto max-w-md">
                           <svg class="w-16 h-16 text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                            </svg>
                            <h4 class="text-2xl font-bold text-white">Failed to Load Projects</h4>
                            <p class="text-gray-400">There was a problem connecting to the database. Please check your internet connection and refresh the page.</p>
                        </div>
                    `;
                });
            }

            // --- ARTICLES DATA HANDLING (FIRESTORE) ---
            function listenForArticles() {
                onSnapshot(query(articlesCollection, orderBy('createdAt', 'desc')), (snapshot) => {
                    articlesData = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));

                    displayArticles();
                }, (error) => {
                    console.error("Error fetching articles: ", error);
                    if (articlesGrid) articlesGrid.innerHTML = `
                        <div class="w-full flex flex-col items-center justify-center text-center p-8 gap-4 glass-card rounded-2xl mx-auto max-w-md col-span-full">
                           <svg class="w-16 h-16 text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                            </svg>
                            <h4 class="text-2xl font-bold text-white">Failed to Load Articles</h4>
                            <p class="text-gray-400">There was a problem connecting to the database. Please check your internet connection and refresh the page.</p>
                        </div>
                    `;
                });
            }

            // --- PRODUCTS DATA HANDLING (FIRESTORE) ---
            function listenForProducts() {
                const productsGridStore = document.getElementById('products-grid-store');
                if (!productsGridStore) return;

                onSnapshot(query(productsCollection, orderBy('createdAt', 'desc')), (snapshot) => {
                    productsData = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                    displayProductsInStore();
                }, (error) => {
                    console.error("Error fetching products:", error);
                    productsGridStore.innerHTML = `<p class="text-red-400 col-span-full text-center">Failed to load products.</p>`;
                });
            }

            // --- CERTIFICATES DATA HANDLING ---
            function listenForCertificates() {
                onSnapshot(query(certificatesCollection, orderBy('createdAt', 'desc')), (snapshot) => {
                    certificatesData = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                    displayCertificates();
                }, (error) => {
                    console.error("Error fetching certificates: ", error);
                    const sliderContainer = document.getElementById('certificates-slider-container');
                    if (sliderContainer) sliderContainer.innerHTML = `<p class="text-red-400 col-span-full text-center">Failed to load certificates.</p>`;
                });
            }

            function displayProductsInStore() {
                const productsGridStore = document.getElementById('products-grid-store');
                if (!productsGridStore) return;
                const isLoggedIn = document.body.classList.contains('logged-in');
                productsGridStore.innerHTML = '';

                if (productsData.length === 0) {
                    productsGridStore.innerHTML = `<p class="text-gray-400 text-center col-span-full">No products available yet.</p>`;
                    return;
                }

                productsData.forEach(product => {
                    const adminControls = '';
                    
                    const coverImage = (product.media && product.media.length > 0) ? product.media.find(m => m.type === 'image')?.url || product.media[0].url : 'https://placehold.co/400x400/0D0D0D/FFD700?text=No+Image';

                    const cardHTML = `
                        <div class="store-product-card">
                            ${adminControls}
                            <div class="product-card-image">
                                <img src="${coverImage}" alt="${product.name}" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <p class="product-category">${product.category}</p>
                                <h4 class="product-title">${product.name}</h4>
                                <div class="details-price-wrapper">
                                    <span class="product-price-display">${product.currency || 'EGP'} ${product.price}</span>
                                    <a href="#" class="details-btn view-product-btn" data-id="${product.id}">
                                        <span data-translate-key="productDetailBtn">Details</span>
                                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3" /></svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                    productsGridStore.innerHTML += cardHTML;
                });

                attachProductEventListeners();
            }

            function displayCertificates() {
                const sliderContainer = document.getElementById('certificates-slider-container');
                if (!sliderContainer) return;
                const isLoggedIn = document.body.classList.contains('logged-in');
                sliderContainer.innerHTML = '';

                if (certificatesData.length === 0) {
                    sliderContainer.innerHTML = `<p class="text-gray-400 text-center col-span-full">No certificates added yet.</p>`;
                    updateCertificatesSliderButtons();
                    return;
                }

                certificatesData.forEach((cert, index) => {
                    const adminControls = '';

                    const cardHTML = `
                        <div class="certificate-card-slider" data-index="${index}">
                            ${adminControls}
                            <img src="${cert.imageUrl}" alt="${cert.title}" loading="lazy">
                            <div class="overlay">
                                <h5>${cert.title}</h5>
                            </div>
                        </div>
                    `;
                    sliderContainer.innerHTML += cardHTML;
                });
                attachCertificateEventListeners();
                updateCertificatesSlider();
                updateCertificatesSliderButtons();
            }

            // --- Function to generate filter buttons ---
            function generateFilterButtons() {
                const allTags = new Set();
                myProjects.forEach(p => {
                    if (p.tags) {
                        p.tags.split(',').forEach(tag => allTags.add(tag.trim()));
                    }
                });

                let buttonsHTML = '<button class="filter-btn active px-4 py-2 rounded-full text-sm font-semibold" data-filter="All">All</button>';
                allTags.forEach(tag => {
                    if (tag) {
                         buttonsHTML += `<button class="filter-btn px-4 py-2 rounded-full text-sm font-semibold" data-filter="${tag}">${tag}</button>`;
                    }
                });
                projectFiltersContainer.innerHTML = buttonsHTML;

                // Add event listeners
                projectFiltersContainer.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (projectFiltersContainer.querySelector('.active')) {
                            projectFiltersContainer.querySelector('.active').classList.remove('active');
                        }
                        btn.classList.add('active');
                        displayProjects(btn.dataset.filter);
                    });
                });
            }

            // --- Function to display projects (with filter) ---
            function displayProjects(filter = 'All') {
                
                if (!myProjects) {
                    projectsGrid.innerHTML = '<p class="text-center col-span-full text-gray-400">No projects to display yet.</p>';
                    return;
                }

                const filteredProjects = filter === 'All' ? myProjects : myProjects.filter(p => p.tags && p.tags.split(',').map(t => t.trim()).includes(filter));
                
                if (filteredProjects.length === 0) {
                     projectsGrid.innerHTML = `
                        <div class="w-full flex flex-col items-center justify-center text-center p-8 gap-4 glass-card rounded-2xl mx-auto max-w-md">
                           <svg class="w-16 h-16 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M6 20.25h12m-7.5-3.75v3.75m3.75-3.75v3.75m-7.5-3.75L3 16.5m18 0l-3.75-3.75M3 16.5l7.5-7.5 7.5 7.5" />
                            </svg>
                            <h4 class="text-2xl font-bold text-white">No Projects Found</h4>
                            <p class="text-gray-400">There are currently no projects in the "${filter}" category.</p>
                            <button id="show-all-projects-btn" class="submit-btn mt-4">Show All Projects</button>
                        </div>
                     `;
                     document.getElementById('show-all-projects-btn').addEventListener('click', () => {
                        const allButton = document.querySelector('#project-filters .filter-btn[data-filter="All"]');
                        if (allButton) allButton.click();
                     });
                     updateSliderButtons();
                     return;
                }

                projectsGrid.innerHTML = '';

                filteredProjects.forEach((project) => {
                    const adminControls = '';

                    const featuredBadge = project.featured ? `
                        <div class="absolute top-4 left-4 bg-yellow-400 text-yellow-900 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1.5 z-10 shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                            <span>Featured</span>
                        </div>
                    ` : '';
                    
                    let statusDisplay = project.status || '';
                    if (statusDisplay === 'Concept') statusDisplay = 'Idea'; // Map old value to new one
                    const statusText = statusDisplay.replace(/([A-Z])/g, ' $1').trim();
                    const statusBadge = project.status ? `<div class="status-badge status-${statusDisplay}">${statusText}</div>` : '';

                    const tagsHTML = project.tags ? project.tags.split(',').map(tag => `<span class="inline-block bg-white/10 text-violet-300 text-xs font-semibold mr-1 mb-1 px-2.5 py-1 rounded-full">${tag.trim()}</span>`).join('') : '';

                    const projectCard = `
                        <article class="group relative rounded-2xl overflow-hidden shadow-lg project-card w-[280px] sm:w-[320px] h-[420px] flex-none snap-center">
                            ${adminControls}
                            ${featuredBadge}
                            ${statusBadge}
                            
                            <!-- Background Image -->
                            <img src="${project.coverImageUrl}" alt="صورة الغلاف لمشروع ${project.title}، وهو مشروع في فئة ${project.tags ? project.tags.split(',')[0].trim() : 'تصميم'}." class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 ease-in-out group-hover:scale-110" loading="lazy" width="320" height="420">
                            
                            <!-- Gradient Overlay -->
                            <div class="absolute inset-0 project-gradient-overlay"></div>
                            
                            <!-- Content that slides up -->
                            <div class="absolute inset-0 flex flex-col justify-end p-6 text-white project-card-content">
                                <div> <!-- Wrapper for always-visible content -->
                                    <h4 class="text-2xl font-bold tracking-tight mb-2 flex-shrink-0">${project.title}</h4>
                                    <div class="project-card-stats flex items-center gap-4 text-gray-300 text-sm mb-4">
                                        <span class="flex items-center gap-1.5" title="Views">
                                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                            ${project.views || 0}
                                        </span>
                                        <span class="flex items-center gap-1.5" title="Likes">
                                            <svg class="w-4 h-4" style="fill: currentColor;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                            ${project.likes || 0}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="project-card-details">
                                    <p class="text-gray-300 text-sm mb-4 h-12 overflow-hidden">${project.description}</p>
                                    <div class="flex flex-wrap gap-y-1 mb-4">
                                        ${tagsHTML}
                                    </div>
                                    <a href="#project/${project.id}" class="submit-btn view-project-btn w-full justify-center" data-id="${project.id}">View Details</a>
                                </div>
                            </div>
                        </div>
                    `;
                    projectsGrid.innerHTML += projectCard;
                });
                attachProjectEventListeners();
                updateSliderButtons(); // Update slider buttons after rendering
            }
            
            // --- Project Slider Logic ---
            const sliderContainer = document.getElementById('projects-slider-container');
            const prevButton = document.getElementById('prev-slide');
            const nextButton = document.getElementById('next-slide');

            function updateProjectSliderAppearance() {
                if (!sliderContainer) return;
                const sliderRect = sliderContainer.getBoundingClientRect();
                const sliderCenter = sliderRect.left + sliderRect.width / 2;

                sliderContainer.querySelectorAll('.project-card').forEach(card => {
                    const cardRect = card.getBoundingClientRect();
                    const cardCenter = cardRect.left + cardRect.width / 2;
                    const distance = Math.abs(sliderCenter - cardCenter);
                    
                    const scale = Math.max(0.85, 1 - (distance / (sliderRect.width)));
                    const opacity = Math.max(0.5, 1 - (distance / (sliderRect.width / 1.5)));
                    
                    card.style.transform = `scale(${scale})`;
                    card.style.opacity = `${opacity}`;
                });
            }

            function updateSliderButtons() {
                if (!sliderContainer || sliderContainer.scrollWidth <= sliderContainer.clientWidth) {
                    prevButton.classList.add('disabled');
                    nextButton.classList.add('disabled');
                    return;
                };
                const maxScrollLeft = sliderContainer.scrollWidth - sliderContainer.clientWidth;
                prevButton.classList.toggle('disabled', sliderContainer.scrollLeft <= 0);
                nextButton.classList.toggle('disabled', sliderContainer.scrollLeft >= maxScrollLeft - 1);
            }

            nextButton.addEventListener('click', () => {
                const card = sliderContainer.querySelector('.project-card');
                if (!card) return;
                const scrollAmount = card.offsetWidth + 32; // Corresponds to gap-8
                sliderContainer.scrollLeft += scrollAmount;
            });

            prevButton.addEventListener('click', () => {
                const card = sliderContainer.querySelector('.project-card');
                if (!card) return;
                const scrollAmount = card.offsetWidth + 32; // Corresponds to gap-8
                sliderContainer.scrollLeft -= scrollAmount;
            });

            sliderContainer.addEventListener('scroll', () => {
                updateSliderButtons();
                updateProjectSliderAppearance();
            });
            window.addEventListener('load', () => setTimeout(() => {
                updateSliderButtons();
                updateProjectSliderAppearance();
            }, 100));
            window.addEventListener('resize', () => setTimeout(() => {
                updateSliderButtons();
                updateProjectSliderAppearance();
            }, 100));

            // --- RENDER ARTICLES ---
            function displayArticles() {
                if (!articlesGrid) return;
                
                articlesGrid.innerHTML = '';

                if (articlesData.length === 0) {
                    articlesGrid.innerHTML = '<p class="text-gray-400 text-center col-span-full">No articles published yet. Check back soon!</p>';
                    return;
                }

                articlesData.forEach(article => {
                    const adminControls = '';
                    const dateFormatted = article.createdAt?.toDate ? new Date(article.createdAt.toDate()).toLocaleDateString('en-US', { year: 'numeric', month: 'long' }) : 'Just now';

                    const imageOrPlaceholder = article.coverImageUrl 
                        ? `<img src="${article.coverImageUrl}" alt="صورة الغلاف لمقال بعنوان: ${article.title}" class="w-full h-48 object-cover" loading="lazy" width="400" height="192">`
                        : `<div class="article-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                           </div>`;

                    const articleCard = `
                    <article class="relative article-card glass-card rounded-2xl overflow-hidden flex flex-col gsap-reveal w-[280px] sm:w-[320px] flex-none snap-center">
                        ${adminControls}
                        ${imageOrPlaceholder}
                        <div class="p-6 flex flex-col flex-grow article-card-content">
                            <p class="text-sm text-gray-400 mb-2">${dateFormatted}</p>
                            <h4 class="text-xl font-bold text-white mb-3 flex-grow">${article.title}</h4>
                            <a href="#article/${article.id}" class="secondary-btn view-article-btn mt-4 self-start" data-id="${article.id}" data-translate-key="readMoreBtn">Read More</a>
                        </div>
                    </div>
                    `;
                    articlesGrid.innerHTML += articleCard;
                });

                attachArticleEventListeners();

                // Use requestAnimationFrame to ensure layout is calculated before we manipulate scroll and styles
                requestAnimationFrame(() => {
                    if (articlesSliderContainer) {
                        articlesSliderContainer.scrollLeft = 0; // Instantly reset scroll to the beginning
                        updateArticleSliderButtons();
                        updateArticleSliderAppearance(); // Apply the animation based on the new scroll position
                    }
                });

                translatePage(getCookie('selected_language') || 'en');
            }


            // --- Article Slider Logic ---
            const articlesSliderContainer = document.getElementById('articles-slider-container');
            const prevArticleButton = document.getElementById('prev-article-slide');
            const nextArticleButton = document.getElementById('next-article-slide');

            function updateArticleSliderAppearance() {
                if (!articlesSliderContainer) return;
                const sliderRect = articlesSliderContainer.getBoundingClientRect();
                const sliderCenter = sliderRect.left + sliderRect.width / 2;

                articlesSliderContainer.querySelectorAll('.article-card').forEach(card => {
                    const cardRect = card.getBoundingClientRect();
                    const cardCenter = cardRect.left + cardRect.width / 2;
                    const distance = Math.abs(sliderCenter - cardCenter);
                    
                    const effectDistance = sliderRect.width / 2;
                    const distanceFactor = Math.min(distance / effectDistance, 1);

                    const minScale = 0.85;
                    const scale = 1 - (1 - minScale) * distanceFactor;

                    const minOpacity = 0.5;
                    const opacity = 1 - (1 - minOpacity) * distanceFactor;

                    card.style.transform = `scale(${scale})`;
                    card.style.opacity = `${opacity}`;
                });
            }

            function updateArticleSliderButtons() {
                if (!articlesSliderContainer || articlesSliderContainer.scrollWidth <= articlesSliderContainer.clientWidth) {
                    prevArticleButton.classList.add('disabled');
                    nextArticleButton.classList.add('disabled');
                    return;
                };
                const maxScrollLeft = articlesSliderContainer.scrollWidth - articlesSliderContainer.clientWidth;
                prevArticleButton.classList.toggle('disabled', articlesSliderContainer.scrollLeft <= 0);
                nextArticleButton.classList.toggle('disabled', articlesSliderContainer.scrollLeft >= maxScrollLeft - 1);
            }

            nextArticleButton.addEventListener('click', () => {
                const card = articlesSliderContainer.querySelector('.article-card');
                if (!card) return;
                const scrollAmount = card.offsetWidth + 32;
                articlesSliderContainer.scrollLeft += scrollAmount;
            });

            prevArticleButton.addEventListener('click', () => {
                const card = articlesSliderContainer.querySelector('.article-card');
                if (!card) return;
                const scrollAmount = card.offsetWidth + 32;
                articlesSliderContainer.scrollLeft -= scrollAmount;
            });

            articlesSliderContainer.addEventListener('scroll', () => {
                updateArticleSliderButtons();
                updateArticleSliderAppearance();
            });
             window.addEventListener('load', () => setTimeout(() => {
                updateArticleSliderButtons();
                updateArticleSliderAppearance();
            }, 100));
            window.addEventListener('resize', () => setTimeout(() => {
                updateArticleSliderButtons();
                updateArticleSliderAppearance();
            }, 100));


            // --- Testimonials Slider Logic ---
            const testimonialSlider = document.getElementById('testimonial-slider');
            let commentsLoaded = false;
            let currentTestimonialIndex = 0;
            let touchStartX = 0;
            let touchEndX = 0;
            let testimonialInterval;

            function updateTestimonialPositions() {
                const cards = document.querySelectorAll('#testimonial-slider .testimonial-card');
                const dots = document.querySelectorAll('#testimonial-dots button');
                if (cards.length === 0) return;

                cards.forEach((card, index) => {
                    card.classList.toggle('active', index === currentTestimonialIndex);
                });

                dots.forEach((dot, index) => {
                    dot.classList.toggle('bg-white/60', index === currentTestimonialIndex);
                    dot.classList.toggle('bg-white/20', index !== currentTestimonialIndex);
                });
            }
            
            if (testimonialSlider) {
                testimonialSlider.addEventListener('touchstart', e => {
                    touchStartX = e.changedTouches[0].screenX;
                    if (testimonialInterval) clearInterval(testimonialInterval); // Stop auto-slide on touch
                }, { passive: true });

                testimonialSlider.addEventListener('touchend', e => {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipeGesture();
                }, { passive: true });
            }

            function handleSwipeGesture() {
                const swipeThreshold = 50; // Minimum distance for a swipe in pixels
                if (touchEndX < touchStartX - swipeThreshold) {
                    // Swiped left, go to next slide
                    changeTestimonialSlide(currentTestimonialIndex + 1, true);
                }
                if (touchEndX > touchStartX + swipeThreshold) {
                    // Swiped right, go to previous slide
                    changeTestimonialSlide(currentTestimonialIndex - 1, true);
                }
            }

            // --- Reading Progress Logic ---
            function updateReadingProgress() {
                // Only calculate if the progress bar is visible
                if (readingProgressBar.style.display !== 'block') return;

                const scrollableHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollTop = window.scrollY;
                
                if (scrollableHeight <= 0) {
                    readingProgressBar.style.width = '100%';
                    return;
                }

                const progress = (scrollTop / scrollableHeight) * 100;
                readingProgressBar.style.width = `${Math.min(progress, 100)}%`;
            }


            // --- Contact Form Logic ---
            const form = document.getElementById('contact-form');
            const formStatus = document.getElementById('form-status');
            async function handleSubmit(event) {
                event.preventDefault();
                const data = new FormData(event.target);
                formStatus.innerHTML = '<p class="text-gray-400">Sending...</p>';
                try {
                    const response = await fetch(event.target.action, {
                        method: form.method,
                        body: data,
                        headers: { 'Accept': 'application/json' }
                    });
                    if (response.ok) {
                        formStatus.innerHTML = '<p class="text-green-400">Thank you for your message!</p>';
                        form.reset();
                    } else {
                        const responseData = await response.json();
                        if (Object.hasOwn(responseData, 'errors')) {
                            formStatus.innerHTML = `<p class="text-red-400">${responseData["errors"].map(error => error["message"]).join(", ")}</p>`;
                        } else {
                            formStatus.innerHTML = '<p class="text-red-400">Oops! There was a problem.</p>';
                        }
                    }
                } catch (error) {
                    formStatus.innerHTML = '<p class="text-red-400">Oops! There was a problem.</p>';
                }
            }
                if(form) form.addEventListener("submit", handleSubmit);


            // --- Comments Section Logic (Google Apps Script) ---
            const commentForm = document.getElementById('comment-form');
            const commentStatus = document.getElementById('comment-status');
            const submitCommentBtn = document.getElementById('submit-comment-btn');
            // IMPORTANT: Replace this URL with your own Google Apps Script Web App URL
            const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbyC2AWInSgXhayqy5H2tXB3Rt-lsmZEaqD0qVNHWXUzG5idiTHiGD9g7OIsdTMW7Fkd/exec'; 

            async function fetchComments() {
                if (commentsLoaded) return; // Don't fetch if already loaded
                testimonialSlider.innerHTML = `<div class="text-center w-full"><div class="typing-indicator" style="opacity: 0.5; margin-bottom: 1rem;"><span></span><span></span><span></span></div><p class="text-gray-400">Loading comments...</p></div>`;

                try {
                    // Add a parameter to tell the script we are GETTING data
                    const response = await fetch(`${appsScriptUrl}?action=read`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const comments = await response.json();
                    if (!Array.isArray(comments)) throw new Error("Received invalid data from API.");

                    if (comments.length > 0) {
                        comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        commentsData = comments;
                    } else {
                        commentsData = [];
                    }
                    commentsLoaded = true; // Set flag to true after successful fetch
                } catch (error) {
                    console.error("Failed to fetch comments:", error);
                    testimonialSlider.innerHTML = `<div class="text-center w-full"><p class="text-red-400">Failed to load comments. Please try refreshing.</p></div>`;
                } finally {
                    displayCommentsSlider();
                }
            }
            
            function displayCommentsSlider() {
                const slider = document.getElementById('testimonial-slider');
                const dotsContainer = document.getElementById('testimonial-dots');
                if (!slider || !dotsContainer) return;

                slider.innerHTML = '';
                dotsContainer.innerHTML = '';

                if (commentsData.length === 0) {
                    slider.innerHTML = `<p class="text-gray-400 text-center w-full">No testimonials have been added yet.</p>`;
                    return;
                }

                commentsData.forEach((comment, index) => {
                    const card = document.createElement('div');
                    card.className = 'testimonial-card';
                    card.dataset.index = index;
                    card.innerHTML = `
                        <div class="max-w-3xl mx-auto">
                             <p class="text-xl md:text-2xl font-medium text-gray-300 mb-6 leading-relaxed">“${escapeHTML(comment.message)}”</p>
                             <p class="font-bold text-white text-lg">${escapeHTML(comment.name)}</p>
                             <p class="text-sm text-gray-500 mt-1">${new Date(comment.timestamp).toLocaleDateString()}</p>
                        </div>
                    `;
                    slider.appendChild(card);

                    const dot = document.createElement('button');
                    dot.className = 'w-2 h-2 rounded-full bg-white/20 transition-colors duration-300';
                    dot.dataset.index = index;
                    dot.addEventListener('click', () => {
                        changeTestimonialSlide(index, true);
                    });
                    dotsContainer.appendChild(dot);
                });

                changeTestimonialSlide(0, false); // Set initial slide
                startTestimonialAutoSlide(); // Start the auto-sliding
            }

            function startTestimonialAutoSlide() {
                if (testimonialInterval) clearInterval(testimonialInterval);
                testimonialInterval = setInterval(() => {
                    changeTestimonialSlide(currentTestimonialIndex + 1, false);
                }, 4000);
            }

            function changeTestimonialSlide(newIndex, isManual = false) {
                 if (isManual && testimonialInterval) {
                    clearInterval(testimonialInterval);
                }

                const cards = document.querySelectorAll('#testimonial-slider .testimonial-card');
                if (cards.length === 0) return;
                if (newIndex < 0) {
                    newIndex = cards.length - 1;
                } else if (newIndex >= cards.length) {
                    newIndex = 0;
                }
                currentTestimonialIndex = newIndex;
                updateTestimonialPositions();
            }

            function escapeHTML(str) {
                const p = document.createElement('p');
                if (str) {
                    p.textContent = str;
                }
                return p.innerHTML;
            }

            // --- Offensive Comment Filter ---
            const offensiveWords = [
                // English - Basic examples
                'fuck', 'shit', 'bitch', 'cunt', 'asshole', 'dick',
                // Arabic - Basic examples
                'كلب', 'حيوان', 'خرا', 'كس', 'عاهرة'
            ];

            function isOffensive(text) {
                const lowerCaseText = text.toLowerCase();
                // Simple check, can be improved with regex for word boundaries (\b)
                return offensiveWords.some(word => lowerCaseText.includes(word));
            }

            async function addComment(name, message) {
                submitCommentBtn.disabled = true;
                commentStatus.innerHTML = `<p class="text-gray-400">Adding comment...</p>`;
                const newComment = { timestamp: new Date().toISOString(), name, message };

                // Optimistic UI Update: Add the comment to the UI immediately.
                commentsData.unshift(newComment);
                currentTestimonialIndex = 0; // Go to the new comment
                displayCommentsSlider();
                commentForm.reset();
                commentStatus.innerHTML = `<p class="text-green-400">Your comment has been posted!</p>`;


                try {
                    // Send the data to the server in the background
                    const postResponse = await fetch(appsScriptUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify({ action: 'create', data: newComment })
                    });

                    const result = await postResponse.json();
                    
                    if (!postResponse.ok || result.status !== "success") {
                        // Log the error but don't disrupt the user's experience.
                        console.error("Failed to save comment to server:", result.message || 'Unknown error');
                        // Optionally, update the status to inform the user of the sync failure.
                        commentStatus.innerHTML = `<p class="text-amber-400">Your comment is visible but failed to sync with the server.</p>`;
                    }
                    
                } catch (error) {
                     console.error("Failed to save comment:", error);
                     commentStatus.innerHTML = `<p class="text-amber-400">Your comment is visible but failed to sync with the server.</p>`;
                } finally {
                    submitCommentBtn.disabled = false;
                    setTimeout(() => { commentStatus.innerHTML = ''; }, 5000);
                }
            }

            // --- Collapsible Comment Form Logic ---
            if(commentForm) {
                const commentWrapper = document.getElementById('comment-section-wrapper');
                const commentMessage = document.getElementById('comment-message');
                const collapsibleSection = document.getElementById('comment-form-collapsible');
                const cancelBtn = document.getElementById('cancel-comment-btn');
                const commentNameInput = document.getElementById('comment-name');

                const expandCommentForm = () => {
                    commentMessage.rows = 4;
                    collapsibleSection.style.maxHeight = '300px';
                    collapsibleSection.style.opacity = '1';
                };

                const collapseCommentForm = () => {
                    commentMessage.rows = 1;
                    collapsibleSection.style.maxHeight = '0px';
                    collapsibleSection.style.opacity = '0';
                    commentMessage.blur(); // Remove focus to hide keyboard on mobile
                };

                commentMessage.addEventListener('focus', expandCommentForm);

                cancelBtn.addEventListener('click', () => {
                    commentForm.reset();
                    collapseCommentForm();
                });

                // New: Click outside to collapse
                document.addEventListener('click', (e) => {
                    const isExpanded = collapsibleSection.style.maxHeight !== '0px';
                    if (isExpanded && !commentWrapper.contains(e.target)) {
                        collapseCommentForm();
                    }
                });

                commentForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const name = commentNameInput.value.trim();
                    const message = commentMessage.value.trim();

                    if (isOffensive(name) || isOffensive(message)) {
                        commentStatus.innerHTML = `<p class="text-red-400">Please use respectful language. Your comment was not posted.</p>`;
                        setTimeout(() => { commentStatus.innerHTML = ''; }, 4000);
                        return;
                    }

                    if (name && message) {
                        await addComment(name, message);
                        // After submitting, reset and collapse the form
                        setTimeout(() => {
                            commentForm.reset();
                            collapseCommentForm();
                        }, 500); // Small delay to let user see success message
                    }
                });
            }

            const prevTestimonialBtn = document.getElementById('prev-testimonial');
            const nextTestimonialBtn = document.getElementById('next-testimonial');
            if (prevTestimonialBtn && nextTestimonialBtn) {
                prevTestimonialBtn.addEventListener('click', () => changeTestimonialSlide(currentTestimonialIndex - 1, true));
                nextTestimonialBtn.addEventListener('click', () => changeTestimonialSlide(currentTestimonialIndex + 1, true));
            }


            // --- 3D Background Functions ---
            function initThreeJS() {
                const canvas = document.getElementById('bg-canvas');
                if (!canvas) return;

                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
                camera.position.z = 1000;

                scene = new THREE.Scene();

                renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000000, 0); // Transparent background

                const particlesGeometry = new THREE.BufferGeometry();
                const particlesCnt = 5000;
                const posArray = new Float32Array(particlesCnt * 3);

                for (let i = 0; i < particlesCnt * 3; i++) {
                    posArray[i] = (Math.random() - 0.5) * (Math.random() * 5000);
                }
                particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

                const particlesMaterial = new THREE.PointsMaterial({
                    size: 1.5,
                    color: 0x00A99D, // Use light theme accent color
                    blending: THREE.AdditiveBlending,
                    transparent: true,
                    opacity: 0.8
                });

                particles = new THREE.Points(particlesGeometry, particlesMaterial);
                scene.add(particles);
                
                document.addEventListener('mousemove', onMouseMove, false);
                window.addEventListener('resize', onWindowResize, false);
                isThreeJSInitialized = true;
            }

            function animate() {
                animationFrameId = requestAnimationFrame(animate);

                const time = Date.now() * 0.00005;
                camera.position.x += (mouseX - camera.position.x) * 0.05;
                camera.position.y += (-mouseY - camera.position.y) * 0.05;
                camera.lookAt(scene.position);

                if (particles) {
                    particles.rotation.x = time * 0.5;
                    particles.rotation.y = time * 0.4;
                }

                if (renderer) renderer.render(scene, camera);
            }

            function startThreeJSAnimation() {
                if (!animationFrameId && isThreeJSInitialized) {
                    animate();
                }
            }
            
            function stopThreeJSAnimation() {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
            }
            
            function onWindowResize() {
                if (!camera || !renderer) return;
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function onMouseMove(event) {
                mouseX = (event.clientX - windowHalfX) * 0.5;
                mouseY = (event.clientY - windowHalfY) * 0.5;
            }


            // --- LIKES & VIEWS LOGIC ---
            function getLikedProjects() {
                return JSON.parse(localStorage.getItem('likedProjects')) || [];
            }

            function setLikedProjects(liked) {
                localStorage.setItem('likedProjects', JSON.stringify(liked));
            }

            function getViewedProjects() {
                return JSON.parse(sessionStorage.getItem('viewedProjects')) || [];
            }

            function setViewedProjects(viewed) {
                sessionStorage.setItem('viewedProjects', JSON.stringify(viewed));
            }

            async function incrementProjectView(projectId) {
                const viewedProjects = getViewedProjects();
                if (!viewedProjects.includes(projectId)) {
                    viewedProjects.push(projectId);
                    setViewedProjects(viewedProjects);

                    const projectRef = doc(db, 'projects', projectId);
                    try {
                        await updateDoc(projectRef, { views: increment(1) });
                    } catch(e) {
                        console.error("Error incrementing view:", e);
                    }
                }
            }

            async function toggleLike(projectId) {
                const likeButton = document.getElementById('like-btn');
                const likeCountSpan = document.getElementById('like-count');
                if (!likeButton || !likeCountSpan) return;

                let likedProjects = getLikedProjects();
                const projectRef = doc(db, 'projects', projectId);
                let currentLikes = parseInt(likeCountSpan.textContent, 10);

                if (likedProjects.includes(projectId)) {
                    // Unlike
                    likedProjects = likedProjects.filter(id => id !== projectId);
                    await updateDoc(projectRef, { likes: increment(-1) });
                    likeButton.classList.remove('liked');
                    likeCountSpan.textContent = currentLikes - 1;

                } else {
                    // Like
                    likedProjects.push(projectId);
                    await updateDoc(projectRef, { likes: increment(1) });
                    likeButton.classList.add('liked');
                    likeCountSpan.textContent = currentLikes + 1;
                }
                setLikedProjects(likedProjects);
            }
            
            // --- AI Project Recommendations ---
            async function getProjectRecommendations(currentProject) {
                const recommendationsContainer = document.getElementById('project-recommendations-container');
                if (!recommendationsContainer) return;
                
                // Show loading state
                recommendationsContainer.innerHTML = `
                    <h4 class="text-xl font-bold text-white">You May Also Like</h4>
                    <div class="text-center p-4">
                        <div class="typing-indicator" style="opacity: 0.5;"><span></span><span></span><span></span></div>
                        <p class="text-gray-400 mt-2 text-sm">Generating recommendations with Gemini AI...</p>
                    </div>
                `;

                // 1. Prepare the data for the API
                const otherProjects = myProjects
                    .filter(p => p.id !== currentProject.id)
                    .map(p => ({ title: p.title, description: p.description, tags: p.tags }));

                if (otherProjects.length < 3) {
                     recommendationsContainer.innerHTML = ''; // Not enough projects to recommend
                     return;
                }

                const apiKey = "AIzaSyCfBd1hVbM0l18xlzkZHBjmUL8X4Gp53dw"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const systemPrompt = `You are an expert portfolio curator. Your task is to recommend three relevant projects from a provided list based on a user's currently viewed project. Analyze the current project's title, description, and tags. Then, from the list of "other projects", select the three that are most similar in style, tools used, or theme.
                
                You MUST respond ONLY with a valid JSON array containing the exact titles of the three recommended projects. Do not include any other text, explanation, or formatting.
                
                Example response:
                ["Project Title A", "Project Title B", "Project Title C"]`;
                
                const userQuery = `Current Project:
                - Title: "${currentProject.title}"
                - Description: "${currentProject.description}"
                - Tags: "${currentProject.tags}"

                List of other projects to choose from:
                ${JSON.stringify(otherProjects, null, 2)}

                Based on the "Current Project", what are the three most relevant projects from the list?`;

                const payload = {
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    contents: [{ parts: [{ text: userQuery }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                    }
                };

                // 2. Call the Gemini API
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const result = await response.json();
                    const recommendedText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (!recommendedText) {
                        throw new Error("No recommendation text received from API.");
                    }

                    const recommendedTitles = JSON.parse(recommendedText);
                    renderRecommendations(recommendedTitles);

                } catch (error) {
                    console.error("Error getting AI recommendations:", error);
                    recommendationsContainer.innerHTML = `
                        <h4 class="text-xl font-bold text-white">You May Also Like</h4>
                        <p class="text-gray-400 text-sm">Could not load recommendations at this time.</p>
                    `;
                }
            }

            function renderRecommendations(titles) {
                const recommendationsContainer = document.getElementById('project-recommendations-container');
                if (!titles || titles.length === 0) {
                    recommendationsContainer.innerHTML = ''; // Clear if no titles
                    return;
                }

                const recommendedProjects = titles
                    .map(title => myProjects.find(p => p.title === title))
                    .filter(Boolean); // Filter out any nulls if a title wasn't found

                if (recommendedProjects.length === 0) {
                     recommendationsContainer.innerHTML = '';
                     return;
                }

                const recommendationsHTML = recommendedProjects.map(project => `
                    <a href="#" class="recommendation-card block glass-card rounded-lg overflow-hidden p-3 view-project-btn-from-recommendation" data-id="${project.id}">
                        <img src="${project.coverImageUrl}" alt="${project.title}" class="w-full h-24 object-cover rounded-md mb-3">
                        <h5 class="font-bold text-white truncate">${project.title}</h5>
                        <p class="text-xs text-gray-400 truncate">${project.tags || ''}</p>
                    </a>
                `).join('');

                recommendationsContainer.innerHTML = `
                    <h4 class="text-xl font-bold text-white">You May Also Like</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        ${recommendationsHTML}
                    </div>
                `;

                // Add event listeners to the new recommendation cards
                document.querySelectorAll('.view-project-btn-from-recommendation').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const project = myProjects.find(p => p.id === btn.dataset.id);
                        if (project) {
                            showProjectDetailView(project);
                        }
                    });
                });
            }
            
            function attachProjectEventListeners() {
                
                document.querySelectorAll('.view-project-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPage({ view: 'project', id: btn.dataset.id });
                    });
                });
            }

            function attachArticleEventListeners() {

                document.querySelectorAll('.view-article-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPage({ view: 'article', id: btn.dataset.id });
                    });
                });
            }

            function attachProductEventListeners() {
                 document.querySelectorAll('.view-product-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPage({ view: 'product', id: btn.dataset.id });
                    });
                });

            }

            function attachCertificateEventListeners() {
                // View certificate in gallery
                document.querySelectorAll('.certificate-card-slider').forEach(card => {
                    card.addEventListener('click', (event) => {
                         if (!event.target.closest('.admin-controls') && card.classList.contains('active')) {
                            const index = parseInt(card.dataset.index, 10);
                            showCertificateGallery(index);
                        }
                    });
                });

            }

            // --- Project Detail View Logic ---
            const backToHomeBtn = document.getElementById('back-to-home-btn');
            const projectDetailContent = document.getElementById('project-detail-content');
            let galleryKeydownListener = null; // To hold the listener function

            function showProjectDetailView(project) {
                // The router now handles showing/hiding the main container
                projectDetailView.classList.remove('hidden');
                document.title = `${project.title} | Badr Ibraheem`;
                // Increment view count
                incrementProjectView(project.id);

                window.scrollTo(0, 0);

                let mediaHTML = '';
                // Display video if it exists
                if (project.mediaUrl) {
                    mediaHTML += getMediaEmbedHTML(project.mediaUrl, 'video', project.title);
                }
                
                // Display gallery if it exists
                if (project.galleryImages && project.galleryImages.length > 0) {
                    // If there's a video, gallery is thumbnails only. Otherwise, it's a full gallery.
                    mediaHTML += createGalleryHTML(project.galleryImages, !!project.mediaUrl, project.title);
                }

                // Fallback to cover image if no other media
                if (!project.mediaUrl && (!project.galleryImages || project.galleryImages.length === 0)) {
                    mediaHTML = getMediaEmbedHTML(project.coverImageUrl, 'image', project.title);
                }

                const dateFormatted = project.date ? new Date(project.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long' }) : 'N/A';
                const isLiked = getLikedProjects().includes(project.id);
                
                let actionButtonHTML = '';
                if (project.url) {
                     actionButtonHTML += `
                        <a href="${project.url}" target="_blank" rel="noopener noreferrer" class="submit-btn group w-full justify-center mt-2">
                            <span data-translate-key="projectDetailVisitBtn">Visit Project</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 ml-2 transition-transform duration-300"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                        </a>
                    `;
                }
                if (project.downloadUrl) {
                    actionButtonHTML += `
                        <a href="${project.downloadUrl}" target="_blank" rel="noopener noreferrer" class="submit-btn group w-full justify-center mt-2" style="background: linear-gradient(to right, #10B981, #34D399); color: white;">
                            <span data-translate-key="projectDetailDownloadBtn">Download</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 ml-2 transition-transform duration-300"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        </a>
                    `;
                }
                
                const tagsHTML = project.tags ? project.tags.split(',').map(tag => `<span class="inline-block bg-white/10 text-violet-300 text-xs font-semibold mr-1 mb-1 px-2.5 py-1 rounded-full">${tag.trim()}</span>`).join('') : 'None';
                const toolsHTML = project.tools ? project.tools.split(',').map(tool => `<span class="inline-block bg-white/10 text-gray-300 text-xs font-semibold mr-1 mb-1 px-2.5 py-1 rounded-full">${tool.trim()}</span>`).join('') : 'N/A';
                
                projectDetailContent.innerHTML = `
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 md:gap-12">
                        <!-- Main Content -->
                        <div class="lg:col-span-2">
                            ${mediaHTML}
                            <div class="mt-8">
                                <h3 class="text-2xl font-bold text-white mb-4" data-translate-key="projectDetailAboutTitle">About This Project</h3>
                                <div class="text-gray-300 leading-relaxed prose prose-invert max-w-none">
                                    ${project.additionalDetails ? project.additionalDetails.replace(/\n/g, '<br>') : 'No additional details provided.'}
                                </div>
                            </div>
                            
                            <!-- AI Recommendations Section -->
                            <div id="project-recommendations-container" class="mt-12"></div>
                        </div>

                        <!-- Sidebar -->
                        <div class="lg:col-span-1">
                            <div class="glass-card p-6 rounded-2xl sticky top-24">
                                <h1 class="text-3xl md:text-4xl font-bold gradient-text mb-4">${project.title}</h1>
                                
                                <div class="space-y-5">
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider" data-translate-key="projectDetailDate">Date</h4>
                                        <p class="text-white">${dateFormatted}</p>
                                    </div>
                                     <div>
                                        <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider" data-translate-key="projectDetailStatus">Status</h4>
                                        <p class="text-white">${project.status.replace(/([A-Z])/g, ' $1').trim()}</p>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider" data-translate-key="projectDetailTools">Tools Used</h4>
                                        <div class="flex flex-wrap mt-1">${toolsHTML}</div>
                                    </div>
                                     <div>
                                        <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider" data-translate-key="projectDetailTags">Tags</h4>
                                        <div class="flex flex-wrap mt-1">${tagsHTML}</div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-between items-center pt-5 mt-5 border-t border-white/10">
                                     <button class="like-btn ${isLiked ? 'liked' : ''}" id="like-btn" data-id="${project.id}">
                                         <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                        <span id="like-count">${project.likes || 0}</span>
                                    </button>
                                     <div class="project-stats text-sm">
                                        <div class="flex items-center gap-1" title="Views">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                            <span id="view-count">${project.views || 0}</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="pt-2">
                                    ${actionButtonHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Add event listener for the new like button after rendering the content
                document.getElementById('like-btn').addEventListener('click', (e) => {
                    toggleLike(e.currentTarget.dataset.id);
                });
                
                if (project.galleryImages && project.galleryImages.length > 0) {
                    initGallery(!project.mediaUrl); // Full gallery only if no video
                }
                
                // Fetch and display AI-powered recommendations
                getProjectRecommendations(project);
            }
            
            backToHomeBtn.addEventListener('click', (e) => {
                e.preventDefault();
                renderPage({ view: 'home' });
            });


            // --- Article Detail View Logic ---
            const backToHomeFromArticleBtn = document.getElementById('back-to-home-from-article-btn');
            const articleDetailContent = document.getElementById('article-detail-content');
                const articleDetailAdminControls = document.getElementById('article-detail-admin-controls');

            if(backToHomeFromArticleBtn) {
                backToHomeFromArticleBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderPage({ view: 'home' });
                });
            }

            if (backToStoreBtn) {
                backToStoreBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderPage({ view: 'store' });
                });
            }

            function showArticleDetailView(article) {
                // The router now handles showing/hiding the main container
                articleDetailView.classList.remove('hidden');
                document.title = `${article.title} | Badr Ibraheem's Blog`;
                window.scrollTo(0, 0);

                // Show and listen for progress bar
                readingProgressBar.style.display = 'block';
                window.addEventListener('scroll', updateReadingProgress, { passive: true });
                // Use a timeout to ensure the content is rendered and scrollHeight is calculated correctly
                setTimeout(updateReadingProgress, 100); 

                // --- SEO 2: Add Article Schema Markup ---
                const articleSchema = {
                    "@context": "https://schema.org",
                    "@type": "Article",
                    "headline": article.title,
                    "author": {
                        "@type": "Person",
                        "name": "Badr Ibraheem Mohameed",
                        "url": "https://badre.site/"
                    },
                    "datePublished": article.createdAt?.toDate ? article.createdAt.toDate().toISOString() : new Date().toISOString(),
                    "image": article.coverImageUrl || "https://i.ibb.co/QFtzp7t3/1172-copy.jpg"
                };
                const schemaScript = document.createElement('script');
                schemaScript.type = 'application/ld+json';
                schemaScript.id = 'article-schema';
                schemaScript.text = JSON.stringify(articleSchema);
                document.head.appendChild(schemaScript);

                articleDetailAdminControls.innerHTML = '';


                const dateFormatted = article.createdAt?.toDate ? new Date(article.createdAt.toDate()).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'N/A';
                const tagsHTML = article.tags ? article.tags.split(',').map(tag => `<span class="inline-block bg-white/10 text-violet-300 text-xs font-semibold mr-2 mb-2 px-3 py-1 rounded-full">${tag.trim()}</span>`).join('') : '';
                const coverImageHTML = article.coverImageUrl ? `<img src="${article.coverImageUrl}" alt="الصورة الرئيسية لمقال: ${article.title}" class="w-full h-auto max-h-[70vh] object-contain rounded-2xl mb-12 bg-black/20" loading="lazy">` : '';

                articleDetailContent.innerHTML = `
                    <div class="text-center mb-12">
                        <h1 class="text-4xl md:text-5xl font-bold gradient-text mb-4">${article.title}</h1>
                        <p class="text-gray-400">Published on ${dateFormatted}</p>
                    </div>
                    ${coverImageHTML}
                    <div class="prose prose-invert lg:prose-xl max-w-none text-gray-300 leading-loose">
                        ${article.content.replace(/\n/g, '<br>')}
                    </div>
                    <div class="mt-12 pt-8 border-t border-white/10">
                        <h4 class="text-lg font-bold text-white mb-4">Tags</h4>
                        <div class="flex flex-wrap">${tagsHTML}</div>
                    </div>
                `;
                 applyTheme(localStorage.getItem('theme')); // Apply correct prose theme
                 translatePage(getCookie('selected_language') || 'en');
            }

            // --- Product Detail View Logic ---
            function showProductDetailView(product) {
                productDetailView.classList.remove('hidden');
                document.title = `${product.name} | Badr's Store`;
                window.scrollTo(0, 0);

                const productDetailContent = document.getElementById('product-detail-content');
                if (!productDetailContent) return;

                // 1. Create a unified media array
                let unifiedMedia = [];
                if (product.youtubeUrl) {
                    try {
                        const url = new URL(product.youtubeUrl);
                        let videoId = url.searchParams.get('v');
                        if (url.hostname === 'youtu.be') {
                            videoId = url.pathname.substring(1);
                        }
                        if (videoId) {
                             unifiedMedia.push({
                                type: 'youtube',
                                videoId: videoId,
                                thumbnailUrl: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
                            });
                        }
                    } catch(e) { console.error("Invalid YouTube URL", e); }
                }
                if (product.media && product.media.length > 0) {
                    product.media.forEach(item => {
                        if (item.type === 'image') {
                            unifiedMedia.push({ type: 'image', url: item.url, thumbnailUrl: item.url });
                        }
                    });
                }
                
                const hasMedia = unifiedMedia.length > 0;

                // 2. Generate HTML for the slider
                const slidesHTML = hasMedia
                    ? unifiedMedia.map((item, index) => {
                        if (item.type === 'youtube') {
                            return `<div class="product-media-slide" data-index="${index}" data-media-type="youtube">
                                        <iframe src="https://www.youtube.com/embed/${item.videoId}?enablejsapi=1" 
                                                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                                allowfullscreen></iframe>
                                    </div>`;
                        }
                        return `<div class="product-media-slide" data-index="${index}" data-media-type="image" data-media-url="${item.url}">
                                    <img src="${item.url}" alt="${product.name} - Image ${index + 1}">
                                </div>`;
                    }).join('')
                    : `<div class="product-media-slide active" data-index="0" data-media-type="image">
                           <img src="https://placehold.co/600x400/0D0D0D/FFD700?text=No+Media" alt="Placeholder">
                       </div>`;

                const galleryNavHTML = hasMedia && unifiedMedia.length > 1 ? `
                    <button id="product-gallery-prev" class="slider-btn absolute top-1/2 -translate-y-1/2 left-0 sm:-left-4 z-30 disabled"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg></button>
                    <button id="product-gallery-next" class="slider-btn absolute top-1/2 -translate-y-1/2 right-0 sm:-right-4 z-30"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></button>
                ` : '';
                
                const tagsHTML = product.tags 
                    ? product.tags.split(',').map(tag => 
                        `<span class="inline-block border border-[var(--border-primary)] bg-white/5 text-gray-300 text-sm font-medium mr-2 mb-2 px-4 py-1.5 rounded-full">#${tag.trim()}</span>`
                      ).join('')
                    : '';

                // 3. Render the main content with the new layout
                productDetailContent.innerHTML = `
                    <div class="max-w-7xl mx-auto">
                        <!-- Media Slider Section -->
                        <div class="relative h-[300px] sm:h-[400px] md:h-[550px] flex items-center justify-center mb-12">
                             <div id="product-media-slider-container">
                                ${slidesHTML}
                            </div>
                            ${galleryNavHTML}
                        </div>

                        <!-- Details Section -->
                        <div class="max-w-4xl mx-auto">
                            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">${product.name}</h1>
                            <div class="flex flex-wrap mb-8">
                                ${tagsHTML}
                            </div>
                            <h2 class="text-2xl font-bold gradient-text mb-4" data-translate-key="productDescriptionTitle">Description</h2>
                            <p class="text-gray-300 leading-relaxed mb-12">${product.description.replace(/\n/g, '<br>')}</p>
                            
                            <!-- Price and Order Section -->
                            <div class="border border-[var(--border-primary)] p-6 rounded-2xl">
                                <p class="text-sm text-gray-400 mb-2">${product.category}</p>
                                <div class="text-4xl md:text-5xl font-bold text-white mb-6">
                                    <span>${product.currency || 'EGP'} ${product.price}</span>
                                </div>
                                <a href="https://wa.me/201069913150?text=Hello, I'm interested in the product: ${encodeURIComponent(product.name)}" target="_blank" rel="noopener noreferrer" class="submit-btn group w-full justify-center">
                                    Order via WhatsApp
                                    <svg class="w-5 h-5 ml-2" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 4.316 1.905 6.03l-.419 1.533 1.519-.4zM9.5 14.5c-.042-.124-.125-.195-.27-.295-.145-.1-.315-.148-.43-.153s-.24-.008-.344.092c-.105.1-.33.34-.438.465-.108.125-.216.25-.324.375s-.24.165-.368.125c-.128-.04-.547-.21-1.046-.595s-.863-.835-1.19-1.16c-.27-.27-.504-.635-.504-.975s.25-.56.375-.75c.125-.19.25-.31.375-.435s.125-.24.062-.375c-.062-.125-.562-1.345-.75-1.845-.19-.5-.375-.435-.5-.435s-.24-.008-.344.092c-.105.1-.33.34-.438.465s-.33.375-.438.635c-.108.25-.165.56-.165.875s.125 1.19.25 1.435c.125.25.562.935 1.312 1.688s1.438 1.19 2.188 1.5s1.19.438 1.562.438c.312 0 .562-.062.75-.125s.562-.625.625-.75c.062-.125.062-.25.062-.31s-.062-.125-.125-.19c-.062-.062-.24-.125-.312-.19s-.125-.125-.125-.19c0-.062-.042-.125-.062-.165z"/></svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 4. Initialize the new slider interactivity
                initProductMediaSlider(unifiedMedia.length);
            }

            // --- New Function: Initialize Product Media Slider ---
            function initProductMediaSlider(mediaCount) {
                const sliderContainer = document.getElementById('product-media-slider-container');
                const prevBtn = document.getElementById('product-gallery-prev');
                const nextBtn = document.getElementById('product-gallery-next');
                if (!sliderContainer || mediaCount <= 1) {
                    if(prevBtn) prevBtn.style.display = 'none';
                    if(nextBtn) nextBtn.style.display = 'none';
                    return;
                }
                
                let currentIndex = 0;

                function updateSlider() {
                    const slides = sliderContainer.querySelectorAll('.product-media-slide');
                    slides.forEach((slide, i) => {
                        slide.classList.remove('active', 'prev', 'next', 'hidden-prev', 'hidden-next');
                        const index = parseInt(slide.dataset.index, 10);

                        if (index === currentIndex) {
                            slide.classList.add('active');
                            // Add lightbox listener only to the active image slide
                            if (slide.dataset.mediaType === 'image') {
                                slide.onclick = () => showLightbox(slide.dataset.mediaUrl, 'Enlarged product image');
                            } else {
                                slide.onclick = null; // Remove listener for videos
                            }
                        } else if (index === currentIndex - 1) {
                            slide.classList.add('prev');
                             slide.onclick = null;
                        } else if (index === currentIndex + 1) {
                            slide.classList.add('next');
                             slide.onclick = null;
                        } else if (index < currentIndex - 1) {
                            slide.classList.add('hidden-prev');
                             slide.onclick = null;
                        } else if (index > currentIndex + 1) {
                            slide.classList.add('hidden-next');
                             slide.onclick = null;
                        }
                    });
                    
                    prevBtn.classList.toggle('disabled', currentIndex === 0);
                    nextBtn.classList.toggle('disabled', currentIndex === mediaCount - 1);
                }

                prevBtn.addEventListener('click', () => {
                    if (currentIndex > 0) {
                        currentIndex--;
                        updateSlider();
                    }
                });

                nextBtn.addEventListener('click', () => {
                    if (currentIndex < mediaCount - 1) {
                        currentIndex++;
                        updateSlider();
                    }
                });

                updateSlider(); // Initial call
            }

            // --- Certificate Modals & Gallery Logic ---
            const certificateModal = document.getElementById('certificate-modal');
            const certificateForm = document.getElementById('certificate-form');
            const closeCertificateModalBtn = document.getElementById('close-certificate-modal-btn');
            const certificateModalOverlay = certificateModal.querySelector('.certificate-modal-overlay-bg');
            const addCertificateBtn = document.getElementById('add-certificate-btn');
            
            const galleryModal = document.getElementById('certificate-gallery-modal');
            const galleryImage = document.getElementById('certificate-gallery-image');
            const galleryTitle = document.getElementById('certificate-gallery-title');
            const closeGalleryBtn = document.getElementById('close-certificate-gallery-btn');
            const prevGalleryBtn = document.getElementById('certificate-gallery-prev');
            const nextGalleryBtn = document.getElementById('certificate-gallery-next');
            let currentCertificateIndex = 0;
            let currentCertificateSlideIndex = 0;

            function showCertificateModal() { if(certificateModal) certificateModal.classList.remove('modal-hidden'); }
            function hideCertificateModal() { if(certificateModal) certificateModal.classList.add('modal-hidden'); }
            
            function showCertificateGallery(index) {
                if (certificatesData.length === 0) return;
                currentCertificateIndex = index;
                updateCertificateGalleryView();
                galleryModal.classList.remove('modal-hidden');
                 document.addEventListener('keydown', handleGalleryKeyPress);
            }

            function hideCertificateGallery() {
                galleryModal.classList.add('modal-hidden');
                document.removeEventListener('keydown', handleGalleryKeyPress);
            }

            function updateCertificateGalleryView() {
                const cert = certificatesData[currentCertificateIndex];
                galleryImage.src = cert.imageUrl;
                galleryImage.alt = cert.title;
                galleryTitle.textContent = cert.title;
                prevGalleryBtn.classList.toggle('disabled', currentCertificateIndex === 0);
                nextGalleryBtn.classList.toggle('disabled', currentCertificateIndex === certificatesData.length - 1);
            }
            
            function handleGalleryKeyPress(e) {
                if (e.key === 'ArrowRight') nextGalleryBtn.click();
                if (e.key === 'ArrowLeft') prevGalleryBtn.click();
                if (e.key === 'Escape') hideCertificateGallery();
            }

            if (addCertificateBtn) {
                addCertificateBtn.addEventListener('click', () => {
                    editingCertificateId = null;
                    certificateForm.reset();
                    document.getElementById('certificate-modal-title').textContent = 'Add Certificate';
                    document.getElementById('certificate-submit-btn-text').textContent = 'Add Certificate';
                    showCertificateModal();
                });
            }

            if(closeCertificateModalBtn && certificateModalOverlay) {
                closeCertificateModalBtn.addEventListener('click', hideCertificateModal);
                certificateModalOverlay.addEventListener('click', hideCertificateModal);
            }
            if(galleryModal) {
                 closeGalleryBtn.addEventListener('click', hideCertificateGallery);
                 galleryModal.querySelector('.certificate-gallery-overlay').addEventListener('click', hideCertificateGallery);
                 prevGalleryBtn.addEventListener('click', () => {
                    if (currentCertificateIndex > 0) {
                        showCertificateGallery(currentCertificateIndex - 1);
                    }
                 });
                 nextGalleryBtn.addEventListener('click', () => {
                    if (currentCertificateIndex < certificatesData.length - 1) {
                        showCertificateGallery(currentCertificateIndex + 1);
                    }
                 });
            }

            if (certificateForm) {
                certificateForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const certificateData = {
                        title: document.getElementById('certificate-title').value,
                        imageUrl: document.getElementById('certificate-imageUrl').value,
                    };
                    try {
                        if (editingCertificateId) {
                            await updateDoc(doc(db, 'certificates', editingCertificateId), certificateData);
                        } else {
                            await addDoc(certificatesCollection, { ...certificateData, createdAt: serverTimestamp() });
                        }
                        hideCertificateModal();
                    } catch (error) {
                        console.error("Error saving certificate:", error);
                        alert("Could not save certificate.");
                    }
                });
            }

            // --- Product Admin Modal ---
            const productAdminModal = document.getElementById('product-admin-modal');
            const productAdminForm = document.getElementById('product-admin-form');
            const closeProductAdminModalBtn = document.getElementById('close-product-admin-modal-btn');
            const productAdminModalOverlay = productAdminModal.querySelector('.product-admin-modal-overlay-bg');
            const addProductBtn = document.getElementById('add-product-btn');

            function showProductAdminModal(product = null) {
                editingProductId = product ? product.id : null;
                productAdminForm.reset();
                if (product) {
                    document.getElementById('product-admin-modal-title').textContent = 'Edit Product';
                    document.getElementById('product-admin-submit-btn-text').textContent = 'Save Changes';
                    document.getElementById('product-admin-id').value = product.id;
                    document.getElementById('product-admin-name').value = product.name;
                    document.getElementById('product-admin-category').value = product.category;
                    document.getElementById('product-admin-tags').value = product.tags || '';
                    document.getElementById('product-admin-price').value = product.price;
                    document.getElementById('product-admin-currency').value = product.currency || 'EGP';
                    document.getElementById('product-admin-description').value = product.description;
                    document.getElementById('product-admin-youtube').value = product.youtubeUrl || ''; // Add this line
                    const mediaText = (product.media || []).filter(item => item.type === 'image').map(item => item.url).join('\n');
                    document.getElementById('product-admin-media').value = mediaText;
                } else {
                    document.getElementById('product-admin-modal-title').textContent = 'Add New Product';
                    document.getElementById('product-admin-submit-btn-text').textContent = 'Add Product';
                }
                productAdminModal.classList.remove('modal-hidden');
            }

            function hideProductAdminModal() {
                productAdminModal.classList.add('modal-hidden');
            }

            if (addProductBtn) addProductBtn.addEventListener('click', () => showProductAdminModal());
            if (closeProductAdminModalBtn) closeProductAdminModalBtn.addEventListener('click', hideProductAdminModal);
            if (productAdminModalOverlay) productAdminModalOverlay.addEventListener('click', hideProductAdminModal);

            if (productAdminForm) {
                productAdminForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const mediaText = document.getElementById('product-admin-media').value;
                    const media = mediaText.split('\n')
                        .map(line => line.trim())
                        .filter(line => line)
                        .map(line => {
                            // Now we only handle images from this text area
                            return { type: 'image', url: line };
                        });

                    const productData = {
                        name: document.getElementById('product-admin-name').value,
                        category: document.getElementById('product-admin-category').value,
                        tags: document.getElementById('product-admin-tags').value,
                        price: parseFloat(document.getElementById('product-admin-price').value),
                        currency: document.getElementById('product-admin-currency').value,
                        description: document.getElementById('product-admin-description').value,
                        youtubeUrl: document.getElementById('product-admin-youtube').value.trim(), // Get YouTube URL
                        media: media,
                    };

                    try {
                        if (editingProductId) {
                            await updateDoc(doc(db, 'products', editingProductId), productData);
                        } else {
                            await addDoc(productsCollection, { ...productData, createdAt: serverTimestamp() });
                        }
                        hideProductAdminModal();
                    } catch (error) {
                        console.error("Error saving product:", error);
                        alert("Could not save product.");
                    }
                });
            }


            // --- New Certificate Slider Logic ---
            const prevCertificateBtn = document.getElementById('prev-certificate-slide');
            const nextCertificateBtn = document.getElementById('next-certificate-slide');
            
            function updateCertificatesSlider() {
                const cards = document.querySelectorAll('.certificate-card-slider');
                cards.forEach((card, i) => {
                    card.classList.remove('active', 'prev', 'next', 'hidden-prev', 'hidden-next');
                    const index = parseInt(card.dataset.index);
                    if (index === currentCertificateSlideIndex) {
                        card.classList.add('active');
                    } else if (index === currentCertificateSlideIndex - 1) {
                        card.classList.add('prev');
                    } else if (index === currentCertificateSlideIndex + 1) {
                        card.classList.add('next');
                    } else if (index < currentCertificateSlideIndex -1) {
                        card.classList.add('hidden-prev');
                    } else if (index > currentCertificateSlideIndex + 1) {
                        card.classList.add('hidden-next');
                    }
                });
            }

            function updateCertificatesSliderButtons() {
                if (!prevCertificateBtn || !nextCertificateBtn) return;
                prevCertificateBtn.classList.toggle('disabled', currentCertificateSlideIndex === 0);
                nextCertificateBtn.classList.toggle('disabled', currentCertificateSlideIndex >= certificatesData.length - 1);
            }

            if(prevCertificateBtn && nextCertificateBtn){
                prevCertificateBtn.addEventListener('click', () => {
                    if (currentCertificateSlideIndex > 0) {
                        currentCertificateSlideIndex--;
                        updateCertificatesSlider();
                        updateCertificatesSliderButtons();
                    }
                });

                nextCertificateBtn.addEventListener('click', () => {
                    if (currentCertificateSlideIndex < certificatesData.length - 1) {
                        currentCertificateSlideIndex++;
                        updateCertificatesSlider();
                        updateCertificatesSliderButtons();
                    }
                });
            }


            function createGalleryHTML(images, thumbnailsOnly = false, title = "Project") {
                const thumbsHTML = images.map((img, index) => `<img src="${img}" alt="صورة مصغرة ${index + 1} لمشروع ${title}" class="gallery-thumb ${index === 0 && !thumbnailsOnly ? 'active' : ''}" data-index="${index}" loading="lazy" width="80" height="60">`).join('');

                if (thumbnailsOnly) {
                     return `<div class="gallery-thumbs mt-0">${thumbsHTML}</div>`;
                }

                return `
                    <div class="gallery-container">
                        <div class="gallery-main-image">
                            <img src="${images[0]}" alt="صورة المعرض الرئيسية لمشروع: ${title}" loading="lazy">
                        </div>
                        <div class="gallery-nav">
                            <button id="gallery-prev"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>
                            <button id="gallery-next"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></button>
                        </div>
                        <div class="gallery-thumbs">${thumbsHTML}</div>
                    </div>
                `;
            }

            function initGallery(isFullGallery = true) {
                 const thumbs = document.querySelectorAll('.gallery-thumb');
                if (!isFullGallery) {
                    thumbs.forEach(thumb => {
                         thumb.addEventListener('click', () => showLightbox(thumb.src, thumb.alt));
                    });
                    return;
                }

                const mainImageContainer = document.querySelector('.gallery-main-image');
                if (!mainImageContainer) return;
                const mainImage = mainImageContainer.querySelector('img');
                const prevBtn = document.getElementById('gallery-prev');
                const nextBtn = document.getElementById('gallery-next');
                let currentIndex = 0;

                function updateGallery(index) {
                    if (index < 0) {
                        index = thumbs.length - 1;
                    } else if (index >= thumbs.length) {
                        index = 0;
                    }
                    mainImage.src = thumbs[index].src;
                    mainImage.alt = thumbs[index].alt; // Update alt text as well
                    thumbs.forEach(t => t.classList.remove('active'));
                    thumbs[index].classList.add('active');
                    currentIndex = index;
                }

                const showNext = () => updateGallery(currentIndex + 1);
                const showPrev = () => updateGallery(currentIndex - 1);

                thumbs.forEach(thumb => {
                    thumb.addEventListener('click', () => updateGallery(parseInt(thumb.dataset.index)));
                });
                
                mainImageContainer.style.cursor = 'pointer';
                mainImageContainer.addEventListener('click', () => {
                    showLightbox(mainImage.src, mainImage.alt);
                });
                
                prevBtn.addEventListener('click', showPrev);
                nextBtn.addEventListener('click', showNext);

                // Remove any old listener before adding a new one
                if (galleryKeydownListener) {
                    document.removeEventListener('keydown', galleryKeydownListener);
                }

                galleryKeydownListener = (e) => {
                    // Check if the project detail view is visible to avoid global key conflicts
                    if (!projectDetailView.classList.contains('hidden')) {
                        if (e.key === 'ArrowRight') {
                            showNext();
                        } else if (e.key === 'ArrowLeft') {
                            showPrev();
                        }
                    }
                };

                document.addEventListener('keydown', galleryKeydownListener);
            }


            // --- Search Logic ---
            function showSearchUI() {
                searchOverlay.classList.remove('hidden');
                searchContainer.classList.add('visible');
                searchInput.focus();
            }

            function hideSearchUI() {
                searchOverlay.classList.add('hidden');
                searchContainer.classList.remove('visible');
                searchInput.blur();
            }

            function showSearchResultsView(query) {
                // The router now handles showing/hiding the main container
                searchResultsView.classList.remove('hidden');
                document.querySelector('#search-results-view h2').innerHTML = `Search Results for "<span class="text-white">${escapeHTML(query)}</span>"`;
                window.scrollTo(0, 0);
            }

            function hideSearchResultsView() {
                // This function is now mainly for cleanup, router handles visibility
                mainContent.classList.remove('hidden');
                searchResultsView.classList.add('hidden');
                searchInput.value = '';
            }

            function performSearch(query) {
                if (!query || query.length < 2) {
                    searchResultsContent.innerHTML = '';
                    return;
                };

                const lowerCaseQuery = query.toLowerCase();
                let resultsHTML = '';
                let resultCount = 0;

                // Search Projects
                const projectResults = myProjects.filter(p => 
                    (p.title && p.title.toLowerCase().includes(lowerCaseQuery)) ||
                    (p.description && p.description.toLowerCase().includes(lowerCaseQuery)) ||
                    (p.tags && p.tags.toLowerCase().includes(lowerCaseQuery)) ||
                    (p.tools && p.tools.toLowerCase().includes(lowerCaseQuery))
                );
                
                if (projectResults.length > 0) {
                    resultsHTML += '<h3 class="text-2xl font-bold text-white mb-6 border-b border-white/10 pb-3">Projects</h3>';
                    projectResults.forEach(project => {
                        resultCount++;
                        resultsHTML += `
                            <div class="mb-6 gsap-reveal">
                                <a href="#" class="view-project-btn-from-search text-xl font-bold gradient-text hover:brightness-125 transition" data-id="${project.id}">${project.title}</a>
                                <p class="text-gray-400 mt-2 text-sm">${project.description}</p>
                            </div>`;
                    });
                }

                // Search Articles
                const articleResults = articlesData.filter(a => 
                    (a.title && a.title.toLowerCase().includes(lowerCaseQuery)) ||
                    (a.content && a.content.toLowerCase().includes(lowerCaseQuery)) ||
                    (a.tags && a.tags.toLowerCase().includes(lowerCaseQuery))
                );

                if (articleResults.length > 0) {
                    resultsHTML += '<h3 class="text-2xl font-bold text-white mb-6 mt-10 border-b border-white/10 pb-3">Blog Articles</h3>';
                    articleResults.forEach(article => {
                         resultCount++;
                        resultsHTML += `
                            <div class="mb-6 gsap-reveal">
                                <a href="#" class="view-article-btn-from-search text-xl font-bold gradient-text hover:brightness-125 transition" data-id="${article.id}">${article.title}</a>
                                <p class="text-gray-400 mt-2 text-sm">${article.content.substring(0, 150)}...</p>
                            </div>`;
                    });
                }

                if (resultCount === 0) {
                    resultsHTML = `
                        <div class="text-center flex flex-col items-center justify-center gap-4 p-8">
                            <svg class="w-16 h-16 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                            <h4 class="text-2xl font-bold text-white">No Results Found</h4>
                            <p class="text-gray-400 max-w-sm">Sorry, we couldn't find anything for your search. Please try a different term or check your spelling.</p>
                        </div>
                    `;
                }

                searchResultsContent.innerHTML = resultsHTML;
                // The router will now call showSearchResultsView
                
                // Re-attach listeners for the new result links
                document.querySelectorAll('.view-project-btn-from-search').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPage({ view: 'project', id: btn.dataset.id });
                    });
                });
                document.querySelectorAll('.view-article-btn-from-search').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderPage({ view: 'article', id: btn.dataset.id });
                    });
                });
            }

            // --- Contact Modal Logic ---
            const contactFabBtn = document.getElementById('contact-fab-btn');
            const contactModal = document.getElementById('contact-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modalOverlay = contactModal.querySelector('.modal-overlay-bg');
            const heroStoreBtn = document.getElementById('hero-store-btn');

            function showModal() {
                contactModal.classList.remove('modal-hidden');
            }

            function hideModal() {
                contactModal.classList.add('modal-hidden');
            }

            if(contactFabBtn && contactModal && closeModalBtn && modalOverlay) {
                contactFabBtn.addEventListener('click', showModal);
                closeModalBtn.addEventListener('click', hideModal);
                modalOverlay.addEventListener('click', hideModal);
            }

            if(heroStoreBtn) {
                heroStoreBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderPage({ view: 'store' });
                });
            }

            // --- Chatbot Logic ---
            const chatFabBtn = document.getElementById('chat-fab-btn');
            const chatWidget = document.getElementById('chat-widget');
            const closeChatBtn = document.getElementById('close-chat-btn');
            const chatMessagesContainer = document.getElementById('chat-messages');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            let chatHistory = [];

            function renderMessages() {
                chatMessagesContainer.innerHTML = '';
                chatHistory.forEach(msg => {
                    const messageEl = document.createElement('div');
                    messageEl.classList.add('chat-message', msg.role); // msg.role is 'user' or 'bot'
                    messageEl.textContent = msg.text;
                    chatMessagesContainer.appendChild(messageEl);
                });
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            }
            
            function showTypingIndicator() {
                const typingEl = document.createElement('div');
                typingEl.classList.add('chat-message', 'bot', 'typing-indicator');
                typingEl.innerHTML = '<span></span><span></span><span></span>';
                chatMessagesContainer.appendChild(typingEl);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            }

            function removeTypingIndicator() {
                const indicator = chatMessagesContainer.querySelector('.typing-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }

            async function getBotResponse(userMessage) {
                chatHistory.push({ role: 'user', text: userMessage });
                renderMessages();
                showTypingIndicator();

                const apiKey = "AIzaSyCfBd1hVbM0l18xlzkZHBjmUL8X4Gp53dw"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const systemPrompt = `You are a friendly, professional chatbot assistant for Badr Ibraheem Mohameed's portfolio website. 
                Your primary goal is to answer questions about Badr, his skills, and his projects.
                - Badr's Skills: Graphic Design, Software Development, 3D Design, UI/UX, Branding, Adobe Creative Suite, Microsoft Office.
                - Badr's Background: He has over 3 years of experience and is a creative professional based in Egypt. He is a graduate of the Higher Institute of Tourism and Hotels.
                - Be concise and helpful. If you don't know an answer from the context, say you can only provide information found on the portfolio.
                - If asked about personal contact details other than the email (badr.e.mohameed@gmail.com), politely direct the user to the contact form.
                - If a question is outside the scope of Badr's portfolio, politely state that you can only assist with portfolio-related inquiries.
                - Your language should match the user's language. The current user is likely speaking English or Arabic.`;

                const payload = {
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    contents: chatHistory.map(msg => ({
                        role: msg.role === 'bot' ? 'model' : 'user',
                        parts: [{ text: msg.text }]
                    }))
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    const botMessage = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't process that. Please try again.";
                    
                    chatHistory.push({ role: 'bot', text: botMessage });
                } catch (error) {
                    console.error("Chatbot API Error:", error);
                    chatHistory.push({ role: 'bot', text: "Apologies, I'm having trouble connecting right now. Please try again in a moment." });
                } finally {
                    removeTypingIndicator();
                    renderMessages();
                    sessionStorage.setItem('chatHistory', JSON.stringify(chatHistory));
                }
            }

            if(chatFabBtn) {
                 window.addEventListener('scroll', () => {
                    if (window.scrollY > 400) {
                        chatFabBtn.classList.add('fab-visible');
                    } else {
                        chatFabBtn.classList.remove('fab-visible');
                    }
                }, { passive: true });

                chatFabBtn.addEventListener('click', () => {
                    chatWidget.classList.toggle('visible');
                    if (chatWidget.classList.contains('visible') && chatHistory.length === 0) {
                        // Add initial welcome message
                        chatHistory.push({ role: 'bot', text: "Hello! I'm Badr's AI assistant. How can I help you today?" });
                        renderMessages();
                    }
                });
            }
            if(closeChatBtn) closeChatBtn.addEventListener('click', () => chatWidget.classList.remove('visible'));

            if(chatForm) {
                chatForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const userMessage = chatInput.value.trim();
                    if (userMessage) {
                        getBotResponse(userMessage);
                        chatInput.value = '';
                    }
                });
            }

            // Load chat history from session storage
            const savedHistory = sessionStorage.getItem('chatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
                renderMessages();
            }


            // --- Floating Action Button Scroll Logic ---
            if (contactFabBtn) {
                window.addEventListener('scroll', () => {
                    const scrollThreshold = 400; 
                    if (window.scrollY > scrollThreshold) {
                        contactFabBtn.classList.add('fab-visible');
                    } else {
                        contactFabBtn.classList.remove('fab-visible');
                    }
                }, { passive: true });
            }

            // --- Image Lightbox Logic ---
            const lightbox = document.getElementById('image-lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const closeLightboxBtn = document.getElementById('close-lightbox-btn');
            const lightboxOverlay = lightbox.querySelector('.lightbox-overlay');

            function showLightbox(src, alt = "Enlarged project image") {
                lightboxImage.src = src;
                lightboxImage.alt = alt;
                lightbox.classList.remove('modal-hidden');
            }

            function hideLightbox() {
                lightbox.classList.add('modal-hidden');
            }

            if(lightbox && closeLightboxBtn && lightboxOverlay) {
                closeLightboxBtn.addEventListener('click', hideLightbox);
                lightboxOverlay.addEventListener('click', hideLightbox);
            }

            // --- Settings Modal Logic ---
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsModalBtn = document.getElementById('close-settings-modal-btn');
            const settingsModalOverlay = settingsModal.querySelector('.settings-modal-overlay-bg');
            const settingsForm = document.getElementById('settings-form');
            const settingsStatus = document.getElementById('settings-status');


            async function showSettingsModal() {
                if (settingsModal) {
                    const profilePic = document.getElementById('profile-picture-img');
                    document.getElementById('light-mode-url').value = profilePic.dataset.lightSrc;
                    document.getElementById('dark-mode-url').value = profilePic.dataset.darkSrc;

                    const maintenanceToggle = document.getElementById('maintenance-mode-toggle');
                    try {
                        const statusDoc = await getDoc(siteStatusRef);
                        maintenanceToggle.checked = statusDoc.exists() && statusDoc.data().isMaintenanceMode;
                    } catch (error) {
                        console.error("Could not fetch maintenance status for settings:", error);
                        maintenanceToggle.checked = false;
                    }

                    settingsModal.classList.remove('modal-hidden');
                }
            }

            function hideSettingsModal() {
                if (settingsModal) {
                    settingsModal.classList.add('modal-hidden');
                    settingsStatus.textContent = '';
                }
            }

            if (settingsModal) {
                closeSettingsModalBtn.addEventListener('click', hideSettingsModal);
                settingsModalOverlay.addEventListener('click', hideSettingsModal);

                // Listener for the maintenance toggle for immediate effect
                document.getElementById('maintenance-mode-toggle').addEventListener('change', async (e) => {
                    const isEnabled = e.target.checked;
                    settingsStatus.textContent = 'Updating...';
                    try {
                        await setDoc(siteStatusRef, { isMaintenanceMode: isEnabled }, { merge: true });
                        settingsStatus.textContent = `Maintenance mode ${isEnabled ? 'enabled' : 'disabled'}.`;
                    } catch (error) {
                        console.error("Error updating maintenance mode:", error);
                        settingsStatus.textContent = "Update failed.";
                    }
                    setTimeout(() => settingsStatus.textContent = '', 3000);
                });

                settingsForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const user = auth.currentUser;
                    if (!user) {
                        alert("You must be logged in to update settings.");
                        return;
                    }

                    const lightModeUrl = document.getElementById('light-mode-url').value;
                    const darkModeUrl = document.getElementById('dark-mode-url').value;
                    const settingsData = { lightModeUrl, darkModeUrl };
                    
                    settingsStatus.textContent = 'Saving image settings...';
                    try {
                        const adminRef = doc(db, 'admins', user.uid);
                        const publicSettingsRef = doc(db, 'settings', 'main_profile');

                        // Update both the private admin doc and the public settings doc
                        await updateDoc(adminRef, settingsData);
                        await setDoc(publicSettingsRef, settingsData, { merge: true });

                        const profilePic = document.getElementById('profile-picture-img');
                        profilePic.dataset.lightSrc = lightModeUrl;
                        profilePic.dataset.darkSrc = darkModeUrl;

                        applyTheme(localStorage.getItem('theme') || 'dark');
                        settingsStatus.textContent = 'Image settings saved!';
                        setTimeout(hideSettingsModal, 1500);

                    } catch (error) {
                        console.error("Error saving settings:", error);
                        settingsStatus.textContent = 'Failed to save image settings.';
                    }
                });
            }


            // --- Interactive Timeline Logic ---
            const experienceData = [
                { year: '2019', titleKey: 'exp4Title', metaKey: 'exp4Meta', descKey: 'exp4Desc' },
                { year: '2021-2022', titleKey: 'exp2Title', metaKey: 'exp2Meta', descKey: 'exp2Desc' },
                { year: '2022', titleKey: 'exp3Title', metaKey: 'exp3Meta', descKey: 'exp3Desc' },
                { year: '2024-2025', titleKey: 'exp1Title', metaKey: 'exp1Meta', descKey: 'exp1Desc' }
            ];

            function initInteractiveTimeline() {
                const detailsContainer = document.getElementById('timeline-details-container');
                const track = document.getElementById('timeline-track');
                const prevBtn = document.getElementById('timeline-prev');
                const nextBtn = document.getElementById('timeline-next');
                let currentIndex = experienceData.length - 1; // Start with the most recent

                function updateDetails(index) {
                    const event = experienceData[index];
                    const currentLang = getCookie('selected_language') || 'en';
                    const detailsContent = detailsContainer.querySelector('.timeline-details-content');
                    
                    if (detailsContent) {
                        detailsContent.classList.add('exiting');
                    }

                    setTimeout(() => {
                        detailsContainer.innerHTML = `
                            <div class="timeline-details-content">
                                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-1">
                                    <h4 class="text-xl font-bold text-white">${translations[currentLang][event.titleKey]}</h4>
                                    <p class="text-sm text-gray-400 sm:text-right flex-shrink-0 mt-1 sm:mt-0">${translations[currentLang][event.metaKey]}</p>
                                </div>
                                <p class="text-gray-300 mt-2">${translations[currentLang][event.descKey]}</p>
                            </div>
                        `;
                    }, 300); // Corresponds to CSS transition
                }

                function updateSlider(index) {
                    currentIndex = index;

                    // Update active dot
                    track.querySelectorAll('.timeline-event').forEach((el, i) => {
                        el.classList.toggle('active', i === index);
                    });

                    // Center the active element
                    const activeEl = track.children[index];
                    if (activeEl) {
                        const trackContainer = document.getElementById('timeline-track-container');
                        const containerWidth = trackContainer.offsetWidth;
                        const elementWidth = activeEl.offsetWidth;
                        const elementLeft = activeEl.offsetLeft;
                        
                        let scrollOffset = elementLeft - (containerWidth / 2) + (elementWidth / 2);
                        track.style.transform = `translateX(-${scrollOffset}px)`;
                    }

                    // Update buttons
                    prevBtn.classList.toggle('disabled', currentIndex === 0);
                    nextBtn.classList.toggle('disabled', currentIndex === experienceData.length - 1);

                    // Update details content
                    updateDetails(index);
                }

                function buildTimeline() {
                    track.innerHTML = '';
                    experienceData.forEach((event, index) => {
                        const eventEl = document.createElement('div');
                        eventEl.className = 'timeline-event';
                        eventEl.dataset.index = index;
                        eventEl.innerHTML = `
                            <div class="timeline-event-dot"></div>
                            <p class="timeline-event-year text-gray-400">${event.year}</p>
                        `;
                        eventEl.addEventListener('click', () => updateSlider(index));
                        track.appendChild(eventEl);
                    });
                    // Initial setup
                    updateSlider(currentIndex);
                }

                prevBtn.addEventListener('click', () => {
                    if (currentIndex > 0) {
                        updateSlider(currentIndex - 1);
                    }
                });

                nextBtn.addEventListener('click', () => {
                    if (currentIndex < experienceData.length - 1) {
                        updateSlider(currentIndex + 1);
                    }
                });
                
                // We need to rebuild the timeline if the language changes
                function rebuildAndTranslate() {
                    buildTimeline();
                }

                buildTimeline();
                
                // Return a function that can be called to rebuild the timeline (e.g., on language change)
                return rebuildAndTranslate;
            }

            const rerenderTimeline = initInteractiveTimeline();


            // --- Language Switcher Logic ---
            const langSwitcherBtn = document.getElementById('language-switcher-btn');
            const langDropdown = document.getElementById('language-dropdown');
            const langOptions = document.querySelectorAll('.language-option');
            const htmlEl = document.documentElement;

            function setCookie(name, value, days) {
                let expires = "";
                if (days) {
                    let date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toUTCString();
                }
                document.cookie = name + "=" + (value || "") + expires + "; path=/";
            }

            function getCookie(name) {
                let nameEQ = name + "=";
                let ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            function applyLanguageStyles(lang) {
                if (lang === 'ar') {
                    htmlEl.dir = 'rtl';
                } else {
                    htmlEl.dir = 'ltr';
                }
            }

            function translatePage(lang = 'en') {
                document.querySelectorAll('[data-translate-key]').forEach(el => {
                    const key = el.dataset.translateKey;
                    const translationExists = translations[lang] && translations[lang][key];
                    
                    // Fallback to English if the translation for the selected language doesn't exist.
                    const text = translationExists ? translations[lang][key] : translations['en'][key];
                    if (text !== undefined) {
                      el.innerHTML = text;
                    }
                });
                document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                    const key = el.dataset.translatePlaceholder;
                    const translationExists = translations[lang] && translations[lang][key];
                    const text = translationExists ? translations[lang][key] : translations['en'][key];
                    if (text !== undefined) {
                        el.placeholder = text;
                    }
                });
                document.querySelectorAll('[data-translate-title]').forEach(el => {
                    const key = el.dataset.translateTitle;
                    const translationExists = translations[lang] && translations[lang][key];
                    const text = translationExists ? translations[lang][key] : (translations['en'][key] || '');
                    if (text) {
                        el.title = text;
                    }
                });
                
                // Update CV download link
                const downloadCvBtn = document.getElementById('download-cv-btn');
                if (downloadCvBtn) {
                    if (lang === 'ar') {
                        downloadCvBtn.href = 'https://download947.mediafire.com/7td3gbmqs9ngLquD4JlZHMix8UFC_fxelPqF0_B5Z9COW5yH0YNjeFGfCaL8iyzJbz1yL3xUcaf2VaQSIbVlJickhh4hwEADbkpKXP3Oos20ZskLchksgf8c5A1ZcUNF63zxvd3c9xKlqw0WjKv-njHBX_8yfvlJ_C1w1nLbNQ/cliwrxtfrynub95/arabic.pdf';
                    } else {
                        downloadCvBtn.href = 'https://download848.mediafire.com/6095jg3kplfgm2ECsf8uZ007siImbRgRmEi7lGfW4GcUKB53-lPiL0yFaIDez_fJMr5tP89KkZ-stT-_9w6QuqER-EJpFSVGSQRTKi9xcaErDnxYDm-FPokxpIw2mqc1jpUVB5FUePNaeeUYGi8Lq0lE3x_vvHTzN1KgaiA11w/ezt3y339bjheap0/engish.pdf';
                    }
                }

                // Rerender timeline with new language
                if (typeof rerenderTimeline === 'function') {
                    rerenderTimeline();
                }

                applyLanguageStyles(lang);
                setCookie('selected_language', lang, 365);
            }

            langSwitcherBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                langDropdown.classList.toggle('show');
            });

            document.addEventListener('click', (e) => {
                if (langDropdown && !langSwitcherBtn.contains(e.target) && !langDropdown.contains(e.target)) {
                    langDropdown.classList.remove('show');
                }
                // Close user dropdown
                const userMenu = document.getElementById('user-menu');
                const userDropdown = document.getElementById('user-dropdown');
                if (userMenu && userDropdown && !userMenu.contains(e.target)) {
                    userDropdown.classList.remove('show');
                    document.getElementById('user-menu-btn')?.classList.remove('open');
                }
            });
            
            langOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const lang = e.currentTarget.dataset.lang;
                    translatePage(lang);
                    langDropdown.classList.remove('show');
                });
            });


            // --- GSAP SETUP & ANIMATIONS ---
            gsap.registerPlugin(ScrollTrigger);
            
            function startMainAnimations() {
                gsap.set(".gsap-reveal", { opacity: 0, y: 30 });

                const headerElement = document.querySelector("header");
                const heroElements = {
                    greeting: document.getElementById('hero-greeting'),
                    line1: document.querySelector('[data-translate-key="heroLine1"]'),
                    line2: document.querySelector('[data-translate-key="heroLine2"]'),
                    line3: document.querySelector('[data-translate-key="heroLine3"]'),
                    bio: document.querySelector('[data-translate-key="heroBio"]'),
                    socials: document.getElementById('hero-socials'),
                    ctas: document.getElementById('hero-ctas'),
                    image: document.getElementById('hero-image-container')
                };

                gsap.to('.content-hidden', { opacity: 1, duration: 0.5 });
                
                if (headerElement && Object.values(heroElements).every(el => el)) {
                     const masterTimeline = gsap.timeline({ defaults: { ease: 'power3.out' }});

                    masterTimeline
                        .fromTo(headerElement, { y: -30, opacity: 0 }, { y: 0, opacity: 1, duration: 1 }, 0.2)
                        .fromTo(heroElements.image, { scale: 0.9, opacity: 0 }, { scale: 1, opacity: 1, duration: 1.2 }, 0.4)
                        .fromTo([
                            heroElements.greeting, 
                            heroElements.line1, 
                            heroElements.line2, 
                            heroElements.line3, 
                            heroElements.bio
                        ], { y: 30, opacity: 0 }, {
                            y: 0,
                            opacity: 1,
                            stagger: 0.15,
                            duration: 1
                        }, 0.6)
                        .fromTo(heroElements.socials, { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: 0.8 }, 1.0)
                        .fromTo(heroElements.ctas, { y: 20, opacity: 0 }, { y: 0, opacity: 1, duration: 0.8 }, 1.2);
                }

                // Initialize Typed.js after the hero animation starts
                if (document.getElementById('typing-effect')) {
                    const typed = new Typed('#typing-effect', {
                        strings: [
                            'Digital Experience Designer',
                            'Creative Graphic Designer',
                            'Front-End Developer'
                        ],
                        typeSpeed: 50,
                        backSpeed: 25,
                        backDelay: 2000,
                        loop: true
                    });
                }

                const sections = document.querySelectorAll('main > section');
                sections.forEach(section => {
                    if (section.id === 'hero') return;

                    const elementsToReveal = section.querySelectorAll('.gsap-reveal');
                    if (elementsToReveal.length > 0) {
                        gsap.to(elementsToReveal, {
                            scrollTrigger: { trigger: section, start: "top 85%", toggleActions: "play none none none" },
                            opacity: 1, y: 0, duration: 1.2, ease: "power3.out", stagger: 0.15,
                        });
                    }
                });

                const skillItems = document.querySelectorAll('.skill-item');
                skillItems.forEach(item => {
                    const bar = item.querySelector('.skill-bar');
                    const level = bar.dataset.level;
                    
                    ScrollTrigger.create({
                        trigger: item,
                        start: "top 90%",
                        once: true,
                        onEnter: () => { bar.style.width = level; }
                    });
                });
                
            }

            // --- Preloader Logic ---
            const preloader = document.getElementById('preloader');
            window.addEventListener('load', () => {
                 setTimeout(() => {
                    preloader.classList.add('hidden');
                    setTimeout(startMainAnimations, 50);
                }, 1000);
            });


            // --- Mobile Menu ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuCloseButton = document.getElementById('mobile-menu-close-button');
            const mobileMenuLinks = document.querySelectorAll('#mobile-menu .mobile-menu-link');
            const contactModalTriggers = document.querySelectorAll('.contact-modal-trigger');

            function openMobileMenu() {
                mobileMenu.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closeMobileMenu() {
                mobileMenu.classList.remove('active');
                document.body.style.overflow = '';
            }

            mobileMenuButton.addEventListener('click', openMobileMenu);
            mobileMenuCloseButton.addEventListener('click', closeMobileMenu);
            
            mobileMenuLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // Check if it's a contact trigger before closing
                    if (!e.currentTarget.classList.contains('contact-modal-trigger')) {
                        closeMobileMenu();
                    }
                });
            });

            contactModalTriggers.forEach(trigger => {
                trigger.addEventListener('click', (e) => {
                    e.preventDefault();
                    showModal();
                    // Close the mobile menu if it's open
                    if (mobileMenu.classList.contains('active')) {
                        closeMobileMenu();
                    }
                });
            });
            
            // --- Initial Data Fetch & Page Setup ---
            loadThemeAndSettings();
            listenForProjects();
            // fetchComments(); // This call is now handled by the Intersection Observer below
            listenForArticles();
            listenForCertificates();
            listenForProducts();

            // Lazy load comments when the testimonials section is visible
            const testimonialsSection = document.getElementById('testimonials');
            if (testimonialsSection) {
                const commentObserver = new IntersectionObserver((entries, observer) => {
                    // Trigger if the section is intersecting and comments haven't been loaded yet
                    if (entries[0].isIntersecting && !commentsLoaded) {
                        fetchComments();
                        observer.unobserve(testimonialsSection); // Disconnect the observer once triggered
                    }
                }, { rootMargin: '200px', threshold: 0.01 }); // Start loading when it's 200px away from viewport

                commentObserver.observe(testimonialsSection);
            }
            
            // On page load, check for saved language preference
            const savedLang = getCookie('selected_language') || 'en';
            applyLanguageStyles(savedLang); // Apply RTL/LTR before translating
            translatePage(savedLang);

            // --- Active Nav Link on Scroll ---
            const sections = document.querySelectorAll('main > section[id]');
            const navLinks = document.querySelectorAll('.nav-link');

            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.5 
            };

            const observer = new IntersectionObserver((entries) => {
                let activeSectionId = null;
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        activeSectionId = entry.target.id;
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.navLink === activeSectionId) {
                        link.classList.add('active');
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });

            // Add mouse move listener for service cards
            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('mousemove', e => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    card.style.setProperty('--x', `${x}px`);
                    card.style.setProperty('--y', `${y}px`);
                });
            });

            // --- Interactive Skills Logic ---
            document.querySelectorAll('.skill-item[data-filter-target]').forEach(skillItem => {
                skillItem.addEventListener('click', () => {
                    const filter = skillItem.dataset.filterTarget;
                    const filterButton = document.querySelector(`#project-filters .filter-btn[data-filter="${filter}"]`);
                    
                    if (filterButton) {
                        // Programmatically click the button to trigger filtering
                        filterButton.click();
                        
                        // Scroll to the projects section
                        const projectsSection = document.getElementById('projects');
                        projectsSection.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        console.warn(`No project filter button found for skill: ${filter}`);
                    }
                });
            });

            // Handle URL search parameter on load
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('s');
            if (searchQuery) {
                // We need to wait for projects/articles to load before searching
                const checkDataLoaded = setInterval(() => {
                    if ((myProjects && myProjects.length > 0) || (articlesData && articlesData.length > 0)) {
                        clearInterval(checkDataLoaded);
                        searchInput.value = searchQuery;
                        performSearch(searchQuery);
                    }
                }, 100);
                // Timeout to prevent infinite loop if data fails to load
                setTimeout(() => clearInterval(checkDataLoaded), 5000);
            }

            // --- CV View Logic ---
            const storeNavBtn = document.querySelector('.nav-link[data-nav-link="store"]');
            if (storeNavBtn) {
                storeNavBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderPage({ view: 'store' });
                });
            }
            const cvNavBtn = document.getElementById('cv-nav-btn');
            const closeCvBtn = document.getElementById('close-cv-btn');
            
            if (cvNavBtn) {
                cvNavBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderPage({ view: 'cv' });
                });
            }
            if (closeCvBtn) {
                closeCvBtn.addEventListener('click', () => {
                    renderPage({ view: 'home' });
                });
            }


            // --- Search Event Listeners ---
            searchBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                showSearchUI();
            });

            searchOverlay.addEventListener('click', hideSearchUI);
            closeSearchBtn.addEventListener('click', () => {
                renderPage({ view: 'home' });
            });
            closeStoreBtn.addEventListener('click', () => {
                renderPage({ view: 'home' });
            });

            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    renderPage({ view: 'search', query: query });
                }
            });

            // --- Add Copyright on Copy ---
            document.addEventListener('copy', (event) => {
                const selection = document.getSelection();
                const copyrightNotice = `\n\n© 2025 Badr Ibraheem. All rights reserved`;
                const textToCopy = selection.toString() + copyrightNotice;
                
                event.clipboardData.setData('text/plain', textToCopy);
                event.preventDefault();
            });

            // --- Router Logic ---
            async function renderPage(state = { view: 'home' }) {
                // Cleanup from any previous view
                window.removeEventListener('scroll', updateReadingProgress, { passive: true });
                readingProgressBar.style.display = 'none';
                if (galleryKeydownListener) {
                    document.removeEventListener('keydown', galleryKeydownListener);
                    galleryKeydownListener = null;
                }
                const schemaScript = document.getElementById('article-schema');
                if (schemaScript) schemaScript.remove();
                
                const isLeavingHome = !mainContent.classList.contains('hidden');
                if (isLeavingHome && state.view !== 'home') {
                    lastScrollPosition = window.scrollY;
                }

                // Hide all views before showing the correct one
                mainContent.classList.add('hidden');
                projectDetailView.classList.add('hidden');
                articleDetailView.classList.add('hidden');
                searchResultsView.classList.add('hidden');
                storeView.classList.add('hidden');
                cvView.classList.remove('visible');
                productDetailView.classList.add('hidden');

                if (state.view === 'project') {
                    const projectId = state.id;
                    await waitForData(myProjects);
                    const project = myProjects.find(p => p.id === projectId);
                    if (project) {
                        showProjectDetailView(project);
                    } else {
                        showNotFound();
                    }
                } else if (state.view === 'article') {
                    const articleId = state.id;
                    await waitForData(articlesData);
                    const article = articlesData.find(a => a.id === articleId);
                    if (article) {
                        showArticleDetailView(article);
                    } else {
                        showNotFound();
                    }
                } else if (state.view === 'search') {
                    const query = state.query;
                    searchResultsView.classList.remove('hidden');
                    performSearch(query);
                    showSearchResultsView(query);
                } else if (state.view === 'store') {
                    document.title = "Store | Badr Ibraheem";
                    storeView.classList.remove('hidden');
                    window.scrollTo(0, 0);

                    // Animate the entire store view container first
                    gsap.fromTo(storeView, 
                        { opacity: 0 }, 
                        { opacity: 1, duration: 0.4, ease: 'power2.inOut' }
                    );

                    // Set initial state for product card animation
                    gsap.set(".store-product-card", { opacity: 0, y: 30 });

                    // Animate the store product cards with a staggered fade-in after a short delay
                    gsap.to(".store-product-card", {
                        opacity: 1,
                        y: 0,
                        duration: 0.6,
                        ease: "power3.out",
                        stagger: 0.1,
                        delay: 0.2 // Delay to let the container appear first
                    });
                } else if (state.view === 'product') {
                    const productId = state.id;
                    const product = productsData.find(p => p.id == productId);
                    if (product) {
                        showProductDetailView(product);
                    } else {
                        showNotFound();
                    }
                } else if (state.view === 'cv') {
                    mainContent.classList.remove('hidden'); // Show main content behind the modal
                    cvView.classList.add('visible');
                } else { // Home view
                    document.title = originalTitle;
                    mainContent.classList.remove('hidden');
                    hideSearchResultsView(); // Ensure search is hidden
                    setTimeout(() => {
                        window.scrollTo({ top: lastScrollPosition, behavior: 'auto' });
                    }, 0);
                }
            }

            function showNotFound() {
                mainContent.classList.remove('hidden');
                mainContent.innerHTML = `<div class="min-h-screen flex items-center justify-center text-center p-4"><div><h1 class="text-5xl font-bold gradient-text mb-4">404</h1><p class="text-xl text-gray-300">The page you're looking for could not be found.</p><a href="#" class="submit-btn mt-8" onclick="window.location.hash=''; return false;">Return Home</a></div></div>`;
                window.scrollTo(0,0);
            }
            
            async function waitForData(dataArray) {
                if (dataArray.length > 0) return;
                return new Promise(resolve => {
                    const interval = setInterval(() => {
                        if (dataArray.length > 0) {
                            clearInterval(interval);
                            resolve();
                        }
                    }, 100);
                     setTimeout(() => { // Timeout to prevent infinite loops
                        clearInterval(interval);
                        resolve(); 
                    }, 5000);
                });
            }

            // window.addEventListener('hashchange', router); // Removed hash change listener
            renderPage(); // Handle initial page load
        });
    </script>
</body>

</html>

